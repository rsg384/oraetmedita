<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Sincroniza√ß√£o Admin - Supabase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-danger {
            background: #dc3545;
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
        }
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 20px 0;
        }
        .data-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste Sincroniza√ß√£o Admin - Supabase</h1>
    
    <div class="test-section">
        <h2>üìã Status do Sistema</h2>
        <button class="btn" onclick="checkSystemStatus()">Verificar Status</button>
        <div id="systemStatus"></div>
    </div>

    <div class="test-section">
        <h2>üîÑ Sincroniza√ß√£o Manual</h2>
        <button class="btn" onclick="forceSync()">For√ßar Sincroniza√ß√£o</button>
        <button class="btn btn-success" onclick="syncFromSupabase()">Sincronizar do Supabase</button>
        <button class="btn btn-warning" onclick="syncToSupabase()">Sincronizar para Supabase</button>
        <div id="syncStatus"></div>
    </div>

    <div class="test-section">
        <h2>üìä Dados Locais</h2>
        <button class="btn" onclick="checkLocalData()">Verificar Dados Locais</button>
        <div id="localData"></div>
    </div>

    <div class="test-section">
        <h2>üåê Dados do Supabase</h2>
        <button class="btn" onclick="checkSupabaseData()">Verificar Dados Supabase</button>
        <div id="supabaseData"></div>
    </div>

    <div class="test-section">
        <h2>üß™ Testes de Sincroniza√ß√£o</h2>
        <button class="btn btn-success" onclick="testCreateCategory()">Testar Criar Categoria</button>
        <button class="btn btn-warning" onclick="testUpdateCategory()">Testar Atualizar Categoria</button>
        <button class="btn btn-danger" onclick="testDeleteCategory()">Testar Excluir Categoria</button>
        <button class="btn btn-success" onclick="testCreateMeditation()">Testar Criar Medita√ß√£o</button>
        <button class="btn btn-warning" onclick="testUpdateMeditation()">Testar Atualizar Medita√ß√£o</button>
        <button class="btn btn-danger" onclick="testDeleteMeditation()">Testar Excluir Medita√ß√£o</button>
        <div id="testResults"></div>
    </div>

    <div class="test-section">
        <h2>üìù Logs</h2>
        <button class="btn" onclick="clearLogs()">Limpar Logs</button>
        <div id="logs"></div>
    </div>

    <!-- Scripts necess√°rios -->
    <script src="session-manager.js"></script>
    <script src="api-config.js"></script>
    <script src="chatgpt-api.js"></script>
    <script src="supabase-config.js"></script>
    <script src="sync-categories-supabase.js"></script>
    <script src="admin-supabase-sync.js"></script>

    <script>
        function addLog(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(logDiv);
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '';
            
            const systems = [
                { name: 'sessionManager', obj: window.sessionManager },
                { name: 'supabaseManager', obj: window.supabaseManager },
                { name: 'adminSupabaseSync', obj: window.adminSupabaseSync }
            ];

            systems.forEach(({ name, obj }) => {
                const div = document.createElement('div');
                div.className = obj ? 'log success' : 'log error';
                div.textContent = `${obj ? '‚úÖ' : '‚ùå'} ${name}: ${obj ? 'dispon√≠vel' : 'n√£o encontrado'}`;
                statusDiv.appendChild(div);
            });

            addLog('üîç Status do sistema verificado');
        }

        async function forceSync() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '';
            
            addLog('üîÑ For√ßando sincroniza√ß√£o manual...');
            
            if (window.adminSupabaseSync) {
                try {
                    await window.adminSupabaseSync.forceSync();
                    statusDiv.innerHTML = '<div class="log success">‚úÖ Sincroniza√ß√£o for√ßada executada com sucesso</div>';
                    addLog('‚úÖ Sincroniza√ß√£o for√ßada conclu√≠da', 'success');
                } catch (error) {
                    statusDiv.innerHTML = `<div class="log error">‚ùå Erro na sincroniza√ß√£o: ${error.message}</div>`;
                    addLog(`‚ùå Erro na sincroniza√ß√£o: ${error.message}`, 'error');
                }
            } else {
                statusDiv.innerHTML = '<div class="log error">‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                addLog('‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'error');
            }
        }

        async function syncFromSupabase() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '';
            
            addLog('üîÑ Sincronizando dados do Supabase...');
            
            if (window.adminSupabaseSync) {
                try {
                    await window.adminSupabaseSync.syncCategoriesFromSupabase();
                    await window.adminSupabaseSync.syncMeditationsFromSupabase();
                    statusDiv.innerHTML = '<div class="log success">‚úÖ Dados sincronizados do Supabase</div>';
                    addLog('‚úÖ Dados sincronizados do Supabase', 'success');
                } catch (error) {
                    statusDiv.innerHTML = `<div class="log error">‚ùå Erro ao sincronizar do Supabase: ${error.message}</div>`;
                    addLog(`‚ùå Erro ao sincronizar do Supabase: ${error.message}`, 'error');
                }
            } else {
                statusDiv.innerHTML = '<div class="log error">‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                addLog('‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'error');
            }
        }

        async function syncToSupabase() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '';
            
            addLog('üîÑ Sincronizando dados para Supabase...');
            
            if (window.adminSupabaseSync) {
                try {
                    await window.adminSupabaseSync.checkAndSyncLocalChanges();
                    statusDiv.innerHTML = '<div class="log success">‚úÖ Dados sincronizados para Supabase</div>';
                    addLog('‚úÖ Dados sincronizados para Supabase', 'success');
                } catch (error) {
                    statusDiv.innerHTML = `<div class="log error">‚ùå Erro ao sincronizar para Supabase: ${error.message}</div>`;
                    addLog(`‚ùå Erro ao sincronizar para Supabase: ${error.message}`, 'error');
                }
            } else {
                statusDiv.innerHTML = '<div class="log error">‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                addLog('‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'error');
            }
        }

        function checkLocalData() {
            const dataDiv = document.getElementById('localData');
            dataDiv.innerHTML = '';
            
            const keys = ['categories', 'meditations'];
            
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                const div = document.createElement('div');
                div.className = 'log';
                
                if (value) {
                    try {
                        const parsed = JSON.parse(value);
                        const count = Array.isArray(parsed) ? parsed.length : Object.keys(parsed).length;
                        div.textContent = `‚úÖ ${key}: ${count} itens`;
                    } catch (e) {
                        div.textContent = `‚ö†Ô∏è ${key}: valor n√£o √© JSON v√°lido`;
                        div.className = 'log error';
                    }
                } else {
                    div.textContent = `‚ùå ${key}: n√£o encontrado`;
                    div.className = 'log error';
                }
                
                dataDiv.appendChild(div);
            });

            addLog('üìä Dados locais verificados');
        }

        async function checkSupabaseData() {
            const dataDiv = document.getElementById('supabaseData');
            dataDiv.innerHTML = '';
            
            if (window.supabaseManager) {
                try {
                    const categories = await window.supabaseManager.getCategories();
                    const meditations = await window.supabaseManager.getMeditations();
                    
                    const categoriesDiv = document.createElement('div');
                    categoriesDiv.className = 'log success';
                    categoriesDiv.textContent = `‚úÖ Categorias no Supabase: ${categories.length} itens`;
                    dataDiv.appendChild(categoriesDiv);
                    
                    const meditationsDiv = document.createElement('div');
                    meditationsDiv.className = 'log success';
                    meditationsDiv.textContent = `‚úÖ Medita√ß√µes no Supabase: ${meditations.length} itens`;
                    dataDiv.appendChild(meditationsDiv);
                    
                    addLog('üåê Dados do Supabase verificados', 'success');
                } catch (error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'log error';
                    errorDiv.textContent = `‚ùå Erro ao verificar dados do Supabase: ${error.message}`;
                    dataDiv.appendChild(errorDiv);
                    
                    addLog(`‚ùå Erro ao verificar dados do Supabase: ${error.message}`, 'error');
                }
            } else {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'log error';
                errorDiv.textContent = '‚ùå Supabase Manager n√£o dispon√≠vel';
                dataDiv.appendChild(errorDiv);
                
                addLog('‚ùå Supabase Manager n√£o dispon√≠vel', 'error');
            }
        }

        async function testCreateCategory() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '';
            
            addLog('üß™ Testando cria√ß√£o de categoria...');
            
            if (window.adminSupabaseSync) {
                try {
                    const testCategory = {
                        name: 'Categoria Teste ' + Date.now(),
                        description: 'Categoria criada para teste',
                        icon: 'üß™',
                        color: '#ff6b6b',
                        is_active: true,
                        sort_order: 999
                    };
                    
                    await window.adminSupabaseSync.syncCategory(testCategory, 'create');
                    
                    resultsDiv.innerHTML = '<div class="log success">‚úÖ Categoria criada com sucesso</div>';
                    addLog('‚úÖ Categoria criada com sucesso', 'success');
                } catch (error) {
                    resultsDiv.innerHTML = `<div class="log error">‚ùå Erro ao criar categoria: ${error.message}</div>`;
                    addLog(`‚ùå Erro ao criar categoria: ${error.message}`, 'error');
                }
            } else {
                resultsDiv.innerHTML = '<div class="log error">‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                addLog('‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'error');
            }
        }

        async function testCreateMeditation() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '';
            
            addLog('üß™ Testando cria√ß√£o de medita√ß√£o...');
            
            if (window.adminSupabaseSync) {
                try {
                    const testMeditation = {
                        title: 'Medita√ß√£o Teste ' + Date.now(),
                        content: 'Conte√∫do da medita√ß√£o de teste',
                        categoryId: 'test-category',
                        duration: 15,
                        status: 'available',
                        type: 'free',
                        icon: 'üß™',
                        lectio: 'Lectio de teste',
                        meditatio: 'Meditatio de teste',
                        oratio: 'Oratio de teste',
                        contemplatio: 'Contemplatio de teste'
                    };
                    
                    await window.adminSupabaseSync.syncMeditation(testMeditation, 'create');
                    
                    resultsDiv.innerHTML = '<div class="log success">‚úÖ Medita√ß√£o criada com sucesso</div>';
                    addLog('‚úÖ Medita√ß√£o criada com sucesso', 'success');
                } catch (error) {
                    resultsDiv.innerHTML = `<div class="log error">‚ùå Erro ao criar medita√ß√£o: ${error.message}</div>`;
                    addLog(`‚ùå Erro ao criar medita√ß√£o: ${error.message}`, 'error');
                }
            } else {
                resultsDiv.innerHTML = '<div class="log error">‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                addLog('‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'error');
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ P√°gina de teste carregada');
            checkSystemStatus();
        });
    </script>
</body>
</html> 