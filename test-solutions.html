<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das Solu√ß√µes - Ora et Medita</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { background: #2a2a3e; padding: 20px; margin: 20px 0; border-radius: 8px; }
        button { padding: 12px 24px; margin: 10px; background: #8B5CF6; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #7C3AED; }
        .success { background: #10B981; }
        .warning { background: #F59E0B; }
        .error { background: #EF4444; }
        .log { background: #0F0F23; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
        input { padding: 12px; width: 100%; margin: 10px 0; border-radius: 4px; border: 1px solid #374151; background: #1A1A2E; color: white; font-size: 16px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; font-weight: bold; }
        .status.success { background: #10B981; color: white; }
        .status.error { background: #EF4444; color: white; }
        .status.warning { background: #F59E0B; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste das Solu√ß√µes Implementadas</h1>
        
        <div class="test-section">
            <h2>1. Teste de Gera√ß√£o e Redirecionamento Inteligente</h2>
            <p>Este teste verifica se as medita√ß√µes s√£o geradas e salvas antes do redirecionamento.</p>
            
            <input type="text" id="test-topic" placeholder="Digite um tema (ex: Amor de Deus, F√©, Humildade)" value="Amor de Deus">
            
            <button onclick="testIntelligentRedirect()" class="success">üöÄ Testar Gera√ß√£o + Redirecionamento</button>
            <button onclick="clearTestData()" class="warning">üßπ Limpar Dados de Teste</button>
            
            <div id="test-status"></div>
            <div id="test-log" class="log"></div>
        </div>

        <div class="test-section">
            <h2>2. Verificar Dados Salvos</h2>
            <p>Verifica se os dados est√£o sendo salvos corretamente no localStorage.</p>
            
            <button onclick="checkSavedData()">üìä Verificar Dados Salvos</button>
            <button onclick="showDataStructure()">üîç Mostrar Estrutura dos Dados</button>
            
            <div id="data-status"></div>
            <div id="data-log" class="log"></div>
        </div>

        <div class="test-section">
            <h2>3. Simular Fluxo Completo</h2>
            <p>Simula o fluxo completo: gera√ß√£o ‚Üí salvamento ‚Üí verifica√ß√£o ‚Üí redirecionamento.</p>
            
            <button onclick="simulateCompleteFlow()" class="success">üé≠ Simular Fluxo Completo</button>
            <button onclick="testWithTimeout()" class="warning">‚è∞ Testar com Timeout</button>
            
            <div id="flow-status"></div>
            <div id="flow-log" class="log"></div>
        </div>

        <div class="test-section">
            <h2>4. Navegar para Minhas Medita√ß√µes</h2>
            <p>Navega diretamente para a p√°gina de medita√ß√µes para verificar se os dados aparecem.</p>
            
            <button onclick="goToMeditations()" class="success">üì± Ir para Minhas Medita√ß√µes</button>
            <button onclick="goToMainPage()" class="warning">üè† Ir para P√°gina Principal</button>
        </div>
    </div>

    <script src="api-config.js"></script>
    <script src="chatgpt-api.js"></script>
    <script>
        function log(elementId, message, type = 'info') {
            const logElement = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? '#10B981' : type === 'error' ? '#EF4444' : type === 'warning' ? '#F59E0B' : '#3B82F6';
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function showStatus(elementId, message, type = 'info') {
            const statusElement = document.getElementById(elementId);
            statusElement.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // 1. Teste de Gera√ß√£o e Redirecionamento Inteligente
        async function testIntelligentRedirect() {
            const topic = document.getElementById('test-topic').value || 'Amor de Deus';
            const logId = 'test-log';
            
            showStatus('test-status', 'üöÄ Iniciando teste de gera√ß√£o e redirecionamento...', 'warning');
            log(logId, `üéØ Testando com tema: "${topic}"`, 'info');
            
            try {
                // Limpar dados anteriores
                localStorage.removeItem('personalized_meditations');
                log(logId, 'üßπ Dados anteriores removidos', 'info');
                
                // Gerar medita√ß√µes
                log(logId, 'ü§ñ Chamando API do ChatGPT...', 'info');
                const startTime = Date.now();
                const result = await chatGPTAPI.generateMeditations(topic);
                const endTime = Date.now();
                
                log(logId, `‚úÖ Gera√ß√£o conclu√≠da em ${endTime - startTime}ms`, 'success');
                log(logId, `üìä ${result.meditations.length} medita√ß√µes geradas`, 'success');
                
                // Salvar no localStorage
                log(logId, 'üíæ Salvando no localStorage...', 'info');
                localStorage.setItem('personalized_meditations', JSON.stringify(result));
                
                // Verificar salvamento
                const savedData = localStorage.getItem('personalized_meditations');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    log(logId, `‚úÖ Dados salvos: ${parsed.meditations.length} medita√ß√µes`, 'success');
                    showStatus('test-status', '‚úÖ Teste conclu√≠do com sucesso! Dados salvos e prontos para redirecionamento.', 'success');
                } else {
                    throw new Error('Falha ao salvar dados');
                }
                
            } catch (error) {
                log(logId, `‚ùå Erro no teste: ${error.message}`, 'error');
                showStatus('test-status', `‚ùå Erro: ${error.message}`, 'error');
            }
        }

        function clearTestData() {
            localStorage.removeItem('personalized_meditations');
            localStorage.removeItem('current_topic');
            localStorage.removeItem('generation_date');
            showStatus('test-status', 'üßπ Dados de teste removidos', 'warning');
            log('test-log', 'üßπ Dados de teste removidos', 'warning');
        }

        // 2. Verificar Dados Salvos
        function checkSavedData() {
            const logId = 'data-log';
            log(logId, 'üìä Verificando dados salvos...', 'info');
            
            const keys = ['personalized_meditations', 'current_topic', 'generation_date'];
            let hasData = false;
            
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    log(logId, `‚úÖ ${key}: encontrado`, 'success');
                    hasData = true;
                } else {
                    log(logId, `‚ö†Ô∏è ${key}: n√£o encontrado`, 'warning');
                }
            });
            
            if (hasData) {
                showStatus('data-status', '‚úÖ Dados encontrados no localStorage', 'success');
            } else {
                showStatus('data-status', '‚ö†Ô∏è Nenhum dado encontrado', 'warning');
            }
        }

        function showDataStructure() {
            const logId = 'data-log';
            const data = localStorage.getItem('personalized_meditations');
            
            if (!data) {
                log(logId, '‚ùå Nenhum dado encontrado', 'error');
                return;
            }
            
            try {
                const parsed = JSON.parse(data);
                log(logId, 'üìã Estrutura dos dados:', 'info');
                log(logId, `   Categoria: ${parsed.category}`, 'info');
                log(logId, `   Total: ${parsed.total} medita√ß√µes`, 'info');
                log(logId, `   Criado em: ${parsed.createdAt}`, 'info');
                
                parsed.meditations.forEach((med, index) => {
                    log(logId, `   ${index + 1}. ${med.title}`, 'info');
                });
                
            } catch (error) {
                log(logId, `‚ùå Erro ao analisar dados: ${error.message}`, 'error');
            }
        }

        // 3. Simular Fluxo Completo
        async function simulateCompleteFlow() {
            const logId = 'flow-log';
            const topic = document.getElementById('test-topic').value || 'Amor de Deus';
            
            showStatus('flow-status', 'üé≠ Simulando fluxo completo...', 'warning');
            log(logId, 'üé≠ Iniciando simula√ß√£o do fluxo completo', 'info');
            
            try {
                // Etapa 1: Gera√ß√£o
                log(logId, '1Ô∏è‚É£ Gerando medita√ß√µes...', 'info');
                const result = await chatGPTAPI.generateMeditations(topic);
                log(logId, `‚úÖ ${result.meditations.length} medita√ß√µes geradas`, 'success');
                
                // Etapa 2: Salvamento
                log(logId, '2Ô∏è‚É£ Salvando no localStorage...', 'info');
                localStorage.setItem('personalized_meditations', JSON.stringify(result));
                log(logId, '‚úÖ Dados salvos', 'success');
                
                // Etapa 3: Verifica√ß√£o
                log(logId, '3Ô∏è‚É£ Verificando salvamento...', 'info');
                const savedData = localStorage.getItem('personalized_meditations');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    log(logId, `‚úÖ Verifica√ß√£o OK: ${parsed.meditations.length} medita√ß√µes`, 'success');
                } else {
                    throw new Error('Falha na verifica√ß√£o');
                }
                
                // Etapa 4: Preparar redirecionamento
                log(logId, '4Ô∏è‚É£ Preparando redirecionamento...', 'info');
                showStatus('flow-status', '‚úÖ Fluxo simulado com sucesso! Pronto para redirecionamento.', 'success');
                
                // Aguardar 2 segundos antes de redirecionar
                setTimeout(() => {
                    log(logId, 'üöÄ Redirecionando para minhas-meditacoes.html...', 'info');
                    window.location.href = 'minhas-meditacoes.html';
                }, 2000);
                
            } catch (error) {
                log(logId, `‚ùå Erro na simula√ß√£o: ${error.message}`, 'error');
                showStatus('flow-status', `‚ùå Erro: ${error.message}`, 'error');
            }
        }

        function testWithTimeout() {
            const logId = 'flow-log';
            log(logId, '‚è∞ Testando timeout de seguran√ßa...', 'info');
            
            // Simular dados de teste
            const testData = {
                category: 'Teste Timeout',
                total: 1,
                meditations: [{
                    id: 1,
                    title: 'Medita√ß√£o de Teste',
                    duration: '20 min',
                    status: 'completed',
                    reading: 'Leitura de teste',
                    meditation: 'Medita√ß√£o de teste',
                    prayer: 'Ora√ß√£o de teste',
                    contemplation: 'Contempla√ß√£o de teste',
                    references: 'Refer√™ncias de teste',
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString()
                }],
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('personalized_meditations', JSON.stringify(testData));
            log(logId, 'üíæ Dados de teste salvos', 'success');
            
            // Simular timeout de 5 segundos
            setTimeout(() => {
                log(logId, '‚è∞ Timeout atingido - redirecionando...', 'warning');
                window.location.href = 'minhas-meditacoes.html';
            }, 5000);
        }

        // 4. Navega√ß√£o
        function goToMeditations() {
            window.location.href = 'minhas-meditacoes.html';
        }

        function goToMainPage() {
            window.location.href = 'index.html';
        }

        // Auto-inicializa√ß√£o
        window.addEventListener('load', () => {
            log('test-log', 'üöÄ P√°gina de teste carregada', 'success');
            checkSavedData();
        });
    </script>
</body>
</html> 