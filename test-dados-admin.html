<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Dados Admin</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 8px; }
        .success { color: #10B981; }
        .error { color: #EF4444; }
        .warning { color: #F59E0B; }
        pre { background: #2a2a2a; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { background: #3B82F6; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563EB; }
    </style>
</head>
<body>
    <h1>üîç Teste de Dados Admin</h1>
    
    <div class="test-section">
        <h2>1. Verificar localStorage</h2>
        <button onclick="checkLocalStorage()">Verificar Dados</button>
        <div id="localStorage-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Testar getCategoriesData()</h2>
        <button onclick="testGetCategoriesData()">Testar Fun√ß√£o</button>
        <div id="categories-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Adicionar Dados de Teste</h2>
        <button onclick="addTestData()">Adicionar Categoria de Teste</button>
        <button onclick="clearTestData()">Limpar Dados</button>
        <div id="test-data-results"></div>
    </div>

    <script>
        function checkLocalStorage() {
            const results = document.getElementById('localStorage-results');
            let html = '<h3>Dados no localStorage:</h3>';
            
            const categories = localStorage.getItem('categories');
            const meditations = localStorage.getItem('meditations');
            
            html += `<p><strong>categories:</strong> ${categories ? '‚úÖ Existe' : '‚ùå N√£o existe'}</p>`;
            html += `<p><strong>meditations:</strong> ${meditations ? '‚úÖ Existe' : '‚ùå N√£o existe'}</p>`;
            
            if (categories) {
                try {
                    const parsedCategories = JSON.parse(categories);
                    html += `<p class="success">Categorias encontradas: ${parsedCategories.length}</p>`;
                    html += '<pre>' + JSON.stringify(parsedCategories, null, 2) + '</pre>';
                } catch (e) {
                    html += `<p class="error">Erro ao analisar categorias: ${e.message}</p>`;
                }
            }
            
            if (meditations) {
                try {
                    const parsedMeditations = JSON.parse(meditations);
                    html += `<p class="success">Medita√ß√µes encontradas: ${parsedMeditations.length}</p>`;
                    html += '<pre>' + JSON.stringify(parsedMeditations, null, 2) + '</pre>';
                } catch (e) {
                    html += `<p class="error">Erro ao analisar medita√ß√µes: ${e.message}</p>`;
                }
            }
            
            results.innerHTML = html;
        }
        
        function getCategoriesData() {
            try {
                const adminCategories = JSON.parse(localStorage.getItem('categories') || '[]');
                const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
                
                console.log('üîç VERIFICANDO DADOS ADMIN:');
                console.log('- adminCategories:', adminCategories);
                console.log('- adminMeditations:', adminMeditations);
                
                if (adminCategories.length > 0) {
                    console.log('‚úÖ USANDO CATEGORIAS DO PAINEL ADMIN:', adminCategories.length);
                    
                    return adminCategories.map(category => {
                        const categoryMeditations = adminMeditations.filter(med => 
                            med.categoryId === category.id
                        );
                        
                        const total = categoryMeditations.length;
                        const completed = categoryMeditations.filter(m => m.status === 'completed').length;
                        const inProgress = categoryMeditations.filter(m => m.status === 'pending' || m.status === 'in_progress').length;
                        const locked = categoryMeditations.filter(m => m.status === 'locked').length;
                        
                        const sampleMeditations = categoryMeditations.slice(0, 3).map(med => ({
                            title: med.title,
                            count: parseInt(med.duration) || 15
                        }));
                        
                        if (sampleMeditations.length === 0) {
                            sampleMeditations.push({ title: 'Aguardando medita√ß√µes...', count: 0 });
                        }
                        
                        return {
                            id: category.id,
                            name: category.name,
                            description: category.description || 'Categoria criada pelo administrador',
                            icon: category.icon || 'üìñ',
                            color: category.color || '#6B7280',
                            total: total,
                            completed: completed,
                            inProgress: inProgress,
                            locked: locked,
                            sampleMeditations: sampleMeditations
                        };
                    });
                }
                
                console.log('üìä Usando categorias padr√£o (fallback)');
                return [
                    {
                        id: 'principios',
                        name: 'Princ√≠pios da Vida Sobrenatural',
                        description: 'Fundamentos da espiritualidade crist√£ e vida interior',
                        icon: '‚ú®',
                        color: '#8B5CF6',
                        total: 24,
                        completed: 19,
                        inProgress: 3,
                        locked: 2,
                        sampleMeditations: [
                            { title: 'A Vida Interior', count: 15 },
                            { title: 'A Gra√ßa Santificante', count: 18 },
                            { title: 'A Ora√ß√£o Mental', count: 20 }
                        ]
                    }
                ];
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar dados das categorias:', error);
                return [];
            }
        }
        
        function testGetCategoriesData() {
            const results = document.getElementById('categories-results');
            
            try {
                const categories = getCategoriesData();
                let html = `<h3>Resultado de getCategoriesData():</h3>`;
                html += `<p class="success">Categorias retornadas: ${categories.length}</p>`;
                
                categories.forEach((cat, index) => {
                    html += `<p><strong>${index + 1}. ${cat.name}</strong> (${cat.total} medita√ß√µes)</p>`;
                });
                
                html += '<pre>' + JSON.stringify(categories, null, 2) + '</pre>';
                results.innerHTML = html;
            } catch (error) {
                results.innerHTML = `<p class="error">Erro: ${error.message}</p>`;
            }
        }
        
        function addTestData() {
            const testCategory = {
                id: 'test_' + Date.now(),
                name: 'Categoria de Teste',
                description: 'Esta √© uma categoria criada para teste',
                icon: 'üß™',
                color: '#10B981',
                status: 'available',
                createdAt: new Date().toISOString()
            };
            
            const testMeditation = {
                id: 'med_' + Date.now(),
                title: 'Medita√ß√£o de Teste',
                categoryId: testCategory.id,
                duration: '15',
                status: 'available',
                type: 'free',
                icon: 'üß™',
                reading: 'Texto de leitura de teste',
                meditation: 'Texto de medita√ß√£o de teste',
                prayer: 'Texto de ora√ß√£o de teste',
                contemplation: 'Texto de contempla√ß√£o de teste',
                createdAt: new Date().toISOString()
            };
            
            // Salvar no localStorage
            const categories = JSON.parse(localStorage.getItem('categories') || '[]');
            const meditations = JSON.parse(localStorage.getItem('meditations') || '[]');
            
            categories.push(testCategory);
            meditations.push(testMeditation);
            
            localStorage.setItem('categories', JSON.stringify(categories));
            localStorage.setItem('meditations', JSON.stringify(meditations));
            
            document.getElementById('test-data-results').innerHTML = 
                `<p class="success">‚úÖ Dados de teste adicionados!</p>
                 <p>Categoria: ${testCategory.name}</p>
                 <p>Medita√ß√£o: ${testMeditation.title}</p>`;
        }
        
        function clearTestData() {
            localStorage.removeItem('categories');
            localStorage.removeItem('meditations');
            document.getElementById('test-data-results').innerHTML = 
                `<p class="warning">‚ö†Ô∏è Todos os dados foram limpos!</p>`;
        }
        
        // Verificar automaticamente ao carregar
        window.addEventListener('DOMContentLoaded', () => {
            checkLocalStorage();
            testGetCategoriesData();
        });
    </script>
</body>
</html> 