<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Painel Administrativo - Ora et Medita v2.0</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #101223;
      color: #f5f6fa;
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
      padding-bottom: 16px;
      border-bottom: 1px solid #2a2d3e;
    }

    .header h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #7ee787;
    }

    .admin-info {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .admin-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-right: 16px;
    }

    .admin-actions .btn {
      font-size: 0.9rem;
      padding: 8px 16px;
      white-space: nowrap;
    }

    .admin-avatar {
      width: 40px;
      height: 40px;
      background: #7ee787;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #101223;
    }

    .admin-details {
      text-align: right;
    }

    .admin-name {
      font-weight: 600;
      color: #f5f6fa;
    }

    .admin-email {
      font-size: 0.9rem;
      color: #a3a8c9;
    }

    .logout-btn {
      background: #dc2626;
      color: #fef2f2;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: #b91c1c;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 1px solid #2a2d3e;
    }

    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      color: #a3a8c9;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      border-bottom: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .tab.active {
      color: #7ee787;
      border-bottom-color: #7ee787;
    }

    .tab:hover {
      color: #f5f6fa;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .content-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .content-header h2 {
      color: #7ee787;
      font-size: 1.5rem;
    }

    .add-btn {
      background: #7ee787;
      color: #101223;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .add-btn:hover {
      background: #4ade80;
      transform: translateY(-1px);
    }

    .data-grid {
      display: grid;
      gap: 16px;
    }

    .data-card {
      background: #181a2a;
      border: 1px solid #2a2d3e;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .data-card:hover {
      border-color: #7ee787;
      transform: translateY(-2px);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #f5f6fa;
    }

    .card-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }

    .edit-btn {
      background: #3b82f6;
      color: #fef2f2;
    }

    .edit-btn:hover {
      background: #2563eb;
    }

    .delete-btn {
      background: #dc2626;
      color: #fef2f2;
    }

    .delete-btn:hover {
      background: #b91c1c;
    }

    .card-content {
      color: #a3a8c9;
      font-size: 0.9rem;
      margin-bottom: 12px;
    }

    .card-stats {
      display: flex;
      gap: 16px;
      font-size: 0.8rem;
    }

    .stat {
      color: #7ee787;
    }

    /* Badges para status de plano */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-success {
      background: #10B981;
      color: white;
    }

    .badge-warning {
      background: #F59E0B;
      color: white;
    }

    .badge-secondary {
      background: #6B7280;
      color: white;
    }

    .badge-danger {
      background: #EF4444;
      color: white;
    }

    /* Badges para status de plano */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge-success {
      background: #10B981;
      color: white;
    }

    .badge-warning {
      background: #F59E0B;
      color: white;
    }

    .badge-secondary {
      background: #6B7280;
      color: white;
    }

    .badge-danger {
      background: #EF4444;
      color: white;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #181a2a;
      border: 1px solid #2a2d3e;
      border-radius: 16px;
      padding: 32px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }

    /* Modal em tela cheia */
    .fullscreen-modal {
      background: #101223;
    }

    .fullscreen-content {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      max-width: none;
      max-height: none;
      border-radius: 0;
      transform: none;
      display: flex;
      flex-direction: column;
      padding: 0;
    }

    .fullscreen-header {
      background: #181a2a;
      padding: 20px 32px;
      border-bottom: 1px solid #2a2d3e;
      margin-bottom: 0;
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .fullscreen-header .modal-title {
      flex: 1;
      text-align: center;
      margin: 0 16px;
    }

    .back-btn {
      background: #23243a;
      color: #f5f6fa;
      border: 1px solid #3a3b5a;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .back-btn:hover {
      background: #3a3b5a;
      color: #7ee787;
    }

    .back-btn span {
      font-size: 1.2rem;
      font-weight: bold;
    }

    .fullscreen-form {
      flex: 1;
      padding: 32px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .fullscreen-form .form-group {
      margin-bottom: 0;
    }

    .fullscreen-form .text-editor-container textarea {
      min-height: 120px;
      resize: vertical;
    }

    .fullscreen-form .form-actions {
      margin-top: auto;
      padding-top: 24px;
      border-top: 1px solid #2a2d3e;
      background: #181a2a;
      position: sticky;
      bottom: 0;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #7ee787;
    }

    .close-btn {
      background: none;
      border: none;
      color: #a3a8c9;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 4px;
    }

    .close-btn:hover {
      color: #f5f6fa;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #f5f6fa;
      font-weight: 500;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      background: #23243a;
      border: 1px solid #3a3b5a;
      border-radius: 8px;
      color: #f5f6fa;
      font-family: inherit;
      font-size: 0.9rem;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #7ee787;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .form-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #7ee787;
      color: #101223;
    }

    .btn-primary:hover {
      background: #4ade80;
    }

    .btn-secondary {
      background: #23243a;
      color: #f5f6fa;
      border: 1px solid #3a3b5a;
    }

    .btn-secondary:hover {
      background: #3a3b5a;
    }

    .btn-danger {
      background: #dc2626;
      color: #fef2f2;
    }

    .btn-danger:hover {
      background: #b91c1c;
    }

    .modal-body {
      margin-bottom: 24px;
    }

    .modal-body p {
      color: #a3a8c9;
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .import-options {
      display: flex;
      flex-direction: column;
      gap: 24px;
      margin: 20px 0;
    }

    .import-option {
      background: #181a2a;
      border: 1px solid #2a2d3e;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .import-option:hover {
      border-color: #7ee787;
      background: #1a1c2e;
    }

    .import-option h4 {
      color: #f5f6fa;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .import-option p {
      color: #a3a8c9;
      font-size: 0.9rem;
      margin-bottom: 16px;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: #a3a8c9;
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 16px;
    }

    .empty-state h3 {
      color: #f5f6fa;
      margin-bottom: 8px;
    }

    .meditation-details {
      background: #23243a;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .meditation-details p {
      margin: 8px 0;
    }

    .meditation-content h4 {
      color: #7ee787;
      margin-bottom: 12px;
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }
      
      .admin-info {
        width: 100%;
        justify-content: space-between;
      }

      .admin-actions {
        flex-direction: column;
        width: 100%;
        gap: 8px;
      }

      .admin-actions .btn {
        width: 100%;
        margin-right: 0 !important;
      }
    }

    /* Estilos para o Editor de Texto */
    .text-editor-container {
      border: 1px solid #2a2d3e;
      border-radius: 8px;
      overflow: hidden;
      background: #181a2a;
    }

    .editor-toolbar {
      display: flex;
      gap: 4px;
      padding: 8px;
      background: #2a2d3e;
      border-bottom: 1px solid #2a2d3e;
    }

    .toolbar-btn {
      background: #3a3d4e;
      color: #f5f6fa;
      border: 1px solid #4a4d5e;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 32px;
      text-align: center;
    }

    .toolbar-btn:hover {
      background: #4a4d5e;
      border-color: #7ee787;
    }

    .toolbar-btn:active {
      background: #5a5d6e;
      transform: translateY(1px);
    }

    .toolbar-separator {
      width: 1px;
      background: #3a3b5a;
      margin: 0 4px;
    }

    .font-selector {
      background: #2a2d3e;
      border: 1px solid #3a3b5a;
      border-radius: 4px;
      color: #e6e6e6;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      min-width: 120px;
    }

    .font-selector:hover {
      background: #3a3b5a;
      border-color: #5a5d6e;
    }

    .font-selector:focus {
      outline: none;
      border-color: #7ee787;
      box-shadow: 0 0 0 2px rgba(126, 231, 135, 0.2);
    }

    .font-size-selector {
      background: #2a2d3e;
      border: 1px solid #3a3b5a;
      border-radius: 4px;
      color: #e6e6e6;
      padding: 4px 8px;
      font-size: 12px;
      cursor: pointer;
      min-width: 80px;
    }
    .font-size-selector:hover {
      background: #3a3b5a;
      border-color: #5a5d6e;
    }
    .font-size-selector:focus {
      outline: none;
      border-color: #7ee787;
      box-shadow: 0 0 0 2px rgba(126, 231, 135, 0.2);
    }

    .text-editor-container textarea {
      border: none;
      background: #181a2a;
      color: #f5f6fa;
      padding: 12px;
      font-family: 'Inter', sans-serif;
      font-size: 0.9rem;
      line-height: 1.5;
      resize: vertical;
      min-height: 120px;
    }

    .text-editor-container textarea:focus {
      outline: none;
      background: #1a1c2a;
    }

    .text-editor-container textarea::placeholder {
      color: #6a6d7e;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîß Painel Administrativo</h1>
      <div class="admin-info">
        <div class="admin-actions">
          <button class="btn btn-success" onclick="exportCompleteData()" style="margin-right: 8px; background: #10B981; color: white; border: none;">
            üì§ Backup Completo
          </button>
          <button class="btn btn-info" onclick="importCompleteData()" style="margin-right: 8px; background: #06B6D4; color: white; border: none;">
            üì• Restaurar Backup
          </button>
          <button class="btn btn-warning" onclick="autoBackup()" style="margin-right: 8px; background: #F59E0B; color: white; border: none;">
            üîÑ Backup Auto
          </button>
          <button class="btn btn-secondary" onclick="exportData()" style="margin-right: 8px;">
            üì§ Exportar Dados
          </button>
          <button class="btn btn-secondary" onclick="importData()" style="margin-right: 8px;">
            üì• Importar Dados
          </button>
          <button class="btn btn-primary" onclick="openModal('meditation')" style="margin-right: 16px;">
            ‚úèÔ∏è Nova Medita√ß√£o
          </button>
        </div>
        <div class="admin-details">
          <div class="admin-name" id="admin-name">Administrador</div>
          <div class="admin-email" id="admin-email">admin@oraetmedita.com</div>
        </div>
        <div class="admin-avatar" id="admin-avatar">A</div>
        <button class="logout-btn" onclick="logout()">Sair</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="showTab('categories')">üìö Categorias</button>
      <button class="tab" onclick="showTab('meditations')">üìñ Medita√ß√µes</button>
      <button class="tab" onclick="showTab('personalized')">‚ú® Personalizadas</button>
      <button class="tab" onclick="showTab('schedules')">üìÖ Agendamentos</button>
                                                  <button class="tab" onclick="showTab('users')">üìä Estat√≠sticas</button>
                      <button class="tab" onclick="showTab('user-management')">üë• Usu√°rios</button>
                      <button class="tab" onclick="showTab('content')">‚úèÔ∏è Conte√∫do</button>
    </div>

    <!-- Tab Categorias -->
    <div id="categories-tab" class="tab-content active">
      <div class="content-header">
        <h2>Gerenciar Categorias</h2>
        <button class="add-btn" onclick="openModal('category')">+ Nova Categoria</button>
      </div>
      <div class="data-grid" id="categories-grid">
        <!-- Categorias ser√£o carregadas aqui -->
      </div>
    </div>

    <!-- Tab Medita√ß√µes -->
    <div id="meditations-tab" class="tab-content">
      <div class="content-header">
        <h2>Gerenciar Medita√ß√µes</h2>
        <button class="add-btn" onclick="openModal('meditation')">+ Nova Medita√ß√£o</button>
      </div>
      <div class="data-grid" id="meditations-grid">
        <!-- Medita√ß√µes ser√£o carregadas aqui -->
      </div>
    </div>

    <!-- Tab Medita√ß√µes Personalizadas -->
    <div id="personalized-tab" class="tab-content">
      <div class="content-header">
        <h2>Medita√ß√µes Personalizadas (ChatGPT)</h2>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="exportPersonalizedData()" style="margin-right: 8px;">
            üì§ Exportar Personalizadas
          </button>
          <button class="btn btn-info" onclick="importPersonalizedData()" style="margin-right: 8px;">
            üì• Importar Personalizadas
          </button>
          <button class="btn btn-danger" onclick="clearPersonalizedData()" style="margin-right: 8px;">
            üóëÔ∏è Limpar Todas
          </button>
        </div>
      </div>
      <div class="data-grid" id="personalized-grid">
        <!-- Medita√ß√µes personalizadas ser√£o carregadas aqui -->
      </div>
    </div>

    <!-- Tab Agendamentos -->
    <div id="schedules-tab" class="tab-content">
      <div class="content-header">
        <h2>Gerenciar Agendamentos</h2>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="exportSchedulesData()" style="margin-right: 8px;">
            üì§ Exportar Agendamentos
          </button>
          <button class="btn btn-info" onclick="importSchedulesData()" style="margin-right: 8px;">
            üì• Importar Agendamentos
          </button>
          <button class="btn btn-danger" onclick="clearSchedulesData()" style="margin-right: 8px;">
            üóëÔ∏è Limpar Todos
          </button>
        </div>
      </div>
      <div class="data-grid" id="schedules-grid">
        <!-- Agendamentos ser√£o carregados aqui -->
      </div>
    </div>

                        <!-- Tab Estat√≠sticas -->
                    <div id="users-tab" class="tab-content">
                      <div class="content-header">
                        <h2>Estat√≠sticas do Dashboard</h2>
                                <div class="header-actions">
                          <button class="btn btn-secondary" onclick="exportUsersData()" style="margin-right: 8px;">
                            üì§ Exportar Estat√≠sticas
                          </button>
                          <button class="btn btn-info" onclick="importUsersData()" style="margin-right: 8px;">
                            üì• Importar Estat√≠sticas
                          </button>
                          <button class="btn btn-primary" onclick="refreshStats()" style="margin-right: 8px;">
                            üîÑ Atualizar
                          </button>
                        </div>
      </div>
      <div class="data-grid" id="users-grid">
        <!-- Estat√≠sticas de usu√°rios ser√£o carregadas aqui -->
      </div>
    </div>

    <!-- Tab Gerenciamento de Usu√°rios -->
    <div id="user-management-tab" class="tab-content">
      <div class="content-header">
        <h2>Gerenciamento de Usu√°rios</h2>
        <div class="header-actions">
          <button class="btn btn-secondary" onclick="exportUsersManagementData()" style="margin-right: 8px;">
            üì§ Exportar Usu√°rios
          </button>
          <button class="btn btn-info" onclick="importUsersManagementData()" style="margin-right: 8px;">
            üì• Importar Usu√°rios
          </button>
          <button class="btn btn-primary" onclick="refreshUsersList()" style="margin-right: 8px;">
            üîÑ Atualizar
          </button>
          <button class="btn btn-success" onclick="showAddUserModal()" style="margin-right: 8px;">
            ‚ûï Adicionar Usu√°rio
          </button>
        </div>
      </div>
      <div class="data-grid" id="users-management-grid">
        <!-- Lista de usu√°rios ser√° carregada aqui -->
      </div>
    </div>

    <!-- Tab Conte√∫do -->
    <div id="content-tab" class="tab-content">
      <div class="content-header">
        <h2>Editar Conte√∫do das Medita√ß√µes</h2>
      </div>
      <div class="data-grid" id="content-grid">
        <!-- Conte√∫do ser√° carregado aqui -->
      </div>
    </div>
  </div>

  <!-- Modal para Categoria -->
  <div id="category-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="category-modal-title">Nova Categoria</h3>
        <button class="close-btn" onclick="closeModal('category')">&times;</button>
      </div>
      <form id="category-form">
        <div class="form-row">
          <div class="form-group">
            <label for="category-name">Nome da Categoria</label>
            <input type="text" id="category-name" name="name" required>
          </div>
          <div class="form-group">
            <label for="category-icon">√çcone</label>
            <input type="text" id="category-icon" name="icon" placeholder="üåü">
          </div>
        </div>
        <div class="form-group">
          <label for="category-description">Descri√ß√£o</label>
          <textarea id="category-description" name="description" rows="3" required></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="category-color">Cor</label>
            <input type="color" id="category-color" name="color" value="#7ee787">
          </div>
          <div class="form-group">
            <label for="category-status">Status</label>
            <select id="category-status" name="status">
              <option value="active">Ativa</option>
              <option value="inactive">Inativa</option>
              <option value="preview">Pr√©via</option>
            </select>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('category')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para Editar Estat√≠sticas do Usu√°rio -->
  <div id="user-stats-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="user-stats-modal-title">Editar Estat√≠sticas do Usu√°rio</h3>
        <button class="close-btn" onclick="closeModal('user-stats')">&times;</button>
      </div>
      <form id="user-stats-form">
        <div class="form-row">
          <div class="form-group">
            <label for="user-name">Nome do Usu√°rio</label>
            <input type="text" id="user-name" name="name" readonly>
          </div>
          <div class="form-group">
            <label for="user-email">Email</label>
            <input type="email" id="user-email" name="email" readonly>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="user-consecutive-days">Dias Consecutivos</label>
            <input type="number" id="user-consecutive-days" name="consecutiveDays" min="0">
          </div>
          <div class="form-group">
            <label for="user-completed-meditations">Medita√ß√µes Completadas</label>
            <input type="number" id="user-completed-meditations" name="completedMeditations" min="0">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="user-total-time">Tempo Total (ex: 8h 30min)</label>
            <input type="text" id="user-total-time" name="totalTime" placeholder="0h 0min">
          </div>
          <div class="form-group">
            <label for="user-total-meditations">Total de Medita√ß√µes</label>
            <input type="number" id="user-total-meditations" name="totalMeditations" min="0">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="user-in-progress">Medita√ß√µes em Andamento</label>
            <input type="number" id="user-in-progress" name="inProgressMeditations" min="0">
          </div>
          <div class="form-group">
            <label for="user-last-login">√öltimo Login</label>
            <input type="text" id="user-last-login" name="lastLogin" readonly>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('user-stats')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar Estat√≠sticas</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal para Medita√ß√£o -->
  <div id="meditation-modal" class="modal fullscreen-modal">
    <div class="modal-content fullscreen-content">
      <div class="modal-header fullscreen-header">
        <button class="back-btn" onclick="closeModal('meditation')" title="Voltar ao painel">
          <span>‚Üê</span> Voltar
        </button>
        <h3 class="modal-title" id="meditation-modal-title">Nova Medita√ß√£o</h3>
        <button class="close-btn" onclick="closeModal('meditation')" title="Fechar">&times;</button>
      </div>
      <form id="meditation-form" class="fullscreen-form">
        <div class="form-row">
          <div class="form-group">
            <label for="meditation-title">T√≠tulo</label>
            <input type="text" id="meditation-title" name="title" required>
          </div>
          <div class="form-group">
            <label for="meditation-category">Categoria</label>
            <select id="meditation-category" name="categoryId" required>
              <!-- Op√ß√µes ser√£o carregadas dinamicamente -->
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="meditation-duration">Dura√ß√£o (minutos)</label>
            <input type="number" id="meditation-duration" name="duration" min="1" max="60" value="12">
          </div>
          <div class="form-group">
            <label for="meditation-status">Status</label>
            <select id="meditation-status" name="status">
              <option value="available">Dispon√≠vel</option>
              <option value="locked">Bloqueada</option>
              <option value="preview">Pr√©via</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="meditation-type">Tipo de Acesso</label>
            <select id="meditation-type" name="type" required>
              <option value="free">Free (7 dias de acesso)</option>
              <option value="premium">Premium (Acesso ilimitado)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="meditation-icon">√çcone</label>
            <input type="text" id="meditation-icon" name="icon" placeholder="üìñ" value="üìñ">
          </div>
        </div>
        
        <!-- Campos da Lectio Divina -->
        <div class="form-group">
          <label for="meditation-reading">üìñ Leitura (Lectio)</label>
          <div class="text-editor-container">
            <div class="editor-toolbar">
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-reading', 'bold')" title="Negrito (Ctrl+B)">B</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-reading', 'italic')" title="It√°lico (Ctrl+I)">I</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-reading', 'underline')" title="Sublinhado (Ctrl+U)">U</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-reading', 'strikethrough')" title="Tachado">~~</button>
              <div class="toolbar-separator"></div>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-reading', 'left')" title="Alinhar √† esquerda">‚´∑</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-reading', 'center')" title="Centralizar">‚´∏</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-reading', 'right')" title="Alinhar √† direita">‚´π</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-reading', 'justify')" title="Justificar texto">‚´∫</button>
              <div class="toolbar-separator"></div>
              <select class="font-selector" onchange="setFontFamily('meditation-reading', this.value)" title="Selecionar fonte">
                <option value="Arial, sans-serif">Arial</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="'Courier New', monospace">Courier New</option>
                <option value="Georgia, serif">Georgia</option>
                <option value="Verdana, sans-serif">Verdana</option>
                <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                <option value="'Lucida Sans Unicode', sans-serif">Lucida Sans</option>
                <option value="'Palatino Linotype', serif">Palatino</option>
                <option value="'Garamond', serif">Garamond</option>
                <option value="'Bookman Old Style', serif">Bookman</option>
              </select>
              <div class="toolbar-separator"></div>
              <select class="font-size-selector" onchange="setFontSize('meditation-reading', this.value)" title="Tamanho da fonte">
                <option value="12px">12px</option>
                <option value="14px">14px</option>
                <option value="16px">16px</option>
                <option value="18px">18px</option>
                <option value="20px">20px</option>
                <option value="24px">24px</option>
                <option value="28px">28px</option>
                <option value="32px">32px</option>
              </select>
              <div class="toolbar-separator"></div>
              <button type="button" class="toolbar-btn" onclick="insertLineBreak('meditation-reading')" title="Quebra de linha (Ctrl+Enter)">‚Üµ</button>
              <button type="button" class="toolbar-btn" onclick="insertParagraph('meditation-reading')" title="Novo par√°grafo (Enter)">¬∂</button>
              <button type="button" class="toolbar-btn" onclick="insertList('meditation-reading', 'bullet')" title="Lista com marcadores">‚Ä¢</button>
              <button type="button" class="toolbar-btn" onclick="insertList('meditation-reading', 'number')" title="Lista numerada">1.</button>
            </div>
            <textarea id="meditation-reading" name="reading" rows="6" placeholder="Insira o texto b√≠blico ou passagem para leitura...&#10;&#10;Use Ctrl+Enter para quebra de linha&#10;Use Enter para novo par√°grafo"></textarea>
          </div>
        </div>
        
        <div class="form-group">
          <label for="meditation-meditation">ü§î Medita√ß√£o (Meditatio)</label>
          <div class="text-editor-container">
            <div class="editor-toolbar">
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-meditation', 'bold')" title="Negrito (Ctrl+B)">B</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-meditation', 'italic')" title="It√°lico (Ctrl+I)">I</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-meditation', 'underline')" title="Sublinhado (Ctrl+U)">U</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-meditation', 'strikethrough')" title="Tachado">~~</button>
              <div class="toolbar-separator"></div>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-meditation', 'left')" title="Alinhar √† esquerda">‚´∑</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-meditation', 'center')" title="Centralizar">‚´∏</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-meditation', 'right')" title="Alinhar √† direita">‚´π</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-meditation', 'justify')" title="Justificar texto">‚´∫</button>
              <div class="toolbar-separator"></div>
              <select class="font-selector" onchange="setFontFamily('meditation-meditation', this.value)" title="Selecionar fonte">
                <option value="Arial, sans-serif">Arial</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="'Courier New', monospace">Courier New</option>
                <option value="Georgia, serif">Georgia</option>
                <option value="Verdana, sans-serif">Verdana</option>
                <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                <option value="'Lucida Sans Unicode', sans-serif">Lucida Sans</option>
                <option value="'Palatino Linotype', serif">Palatino</option>
                <option value="'Garamond', serif">Garamond</option>
                <option value="'Bookman Old Style', serif">Bookman</option>
              </select>
              <div class="toolbar-separator"></div>
              <select class="font-size-selector" onchange="setFontSize('meditation-meditation', this.value)" title="Tamanho da fonte">
                <option value="12px">12px</option>
                <option value="14px">14px</option>
                <option value="16px">16px</option>
                <option value="18px">18px</option>
                <option value="20px">20px</option>
                <option value="24px">24px</option>
                <option value="28px">28px</option>
                <option value="32px">32px</option>
              </select>
              <div class="toolbar-separator"></div>
              <button type="button" class="toolbar-btn" onclick="insertLineBreak('meditation-meditation')" title="Quebra de linha (Ctrl+Enter)">‚Üµ</button>
              <button type="button" class="toolbar-btn" onclick="insertParagraph('meditation-meditation')" title="Novo par√°grafo (Enter)">¬∂</button>
              <button type="button" class="toolbar-btn" onclick="insertList('meditation-meditation', 'bullet')" title="Lista com marcadores">‚Ä¢</button>
              <button type="button" class="toolbar-btn" onclick="insertList('meditation-meditation', 'number')" title="Lista numerada">1.</button>
            </div>
            <textarea id="meditation-meditation" name="meditation" rows="6" placeholder="Insira as reflex√µes e perguntas para medita√ß√£o...&#10;&#10;Use Ctrl+Enter para quebra de linha&#10;Use Enter para novo par√°grafo"></textarea>
          </div>
        </div>
        
        <div class="form-group">
          <label for="meditation-prayer">üôè Ora√ß√£o (Oratio)</label>
          <div class="text-editor-container">
            <div class="editor-toolbar">
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-prayer', 'bold')" title="Negrito (Ctrl+B)">B</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-prayer', 'italic')" title="It√°lico (Ctrl+I)">I</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-prayer', 'underline')" title="Sublinhado (Ctrl+U)">U</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-prayer', 'strikethrough')" title="Tachado">~~</button>
              <div class="toolbar-separator"></div>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-prayer', 'left')" title="Alinhar √† esquerda">‚´∑</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-prayer', 'center')" title="Centralizar">‚´∏</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-prayer', 'right')" title="Alinhar √† direita">‚´π</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-prayer', 'justify')" title="Justificar texto">‚´∫</button>
              <div class="toolbar-separator"></div>
              <select class="font-selector" onchange="setFontFamily('meditation-prayer', this.value)" title="Selecionar fonte">
                <option value="Arial, sans-serif">Arial</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="'Courier New', monospace">Courier New</option>
                <option value="Georgia, serif">Georgia</option>
                <option value="Verdana, sans-serif">Verdana</option>
                <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                <option value="'Lucida Sans Unicode', sans-serif">Lucida Sans</option>
                <option value="'Palatino Linotype', serif">Palatino</option>
                <option value="'Garamond', serif">Garamond</option>
                <option value="'Bookman Old Style', serif">Bookman</option>
              </select>
              <div class="toolbar-separator"></div>
              <select class="font-size-selector" onchange="setFontSize('meditation-prayer', this.value)" title="Tamanho da fonte">
                <option value="12px">12px</option>
                <option value="14px">14px</option>
                <option value="16px">16px</option>
                <option value="18px">18px</option>
                <option value="20px">20px</option>
                <option value="24px">24px</option>
                <option value="28px">28px</option>
                <option value="32px">32px</option>
              </select>
              <div class="toolbar-separator"></div>
              <button type="button" class="toolbar-btn" onclick="insertLineBreak('meditation-prayer')" title="Quebra de linha (Ctrl+Enter)">‚Üµ</button>
              <button type="button" class="toolbar-btn" onclick="insertParagraph('meditation-prayer')" title="Novo par√°grafo (Enter)">¬∂</button>
              <button type="button" class="toolbar-btn" onclick="insertList('meditation-prayer', 'bullet')" title="Lista com marcadores">‚Ä¢</button>
              <button type="button" class="toolbar-btn" onclick="insertList('meditation-prayer', 'number')" title="Lista numerada">1.</button>
            </div>
            <textarea id="meditation-prayer" name="prayer" rows="6" placeholder="Insira as orienta√ß√µes para ora√ß√£o...&#10;&#10;Use Ctrl+Enter para quebra de linha&#10;Use Enter para novo par√°grafo"></textarea>
          </div>
        </div>
        
        <div class="form-group">
          <label for="meditation-contemplation">‚ú® Contempla√ß√£o (Contemplatio)</label>
          <div class="text-editor-container">
            <div class="editor-toolbar">
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-contemplation', 'bold')" title="Negrito (Ctrl+B)">B</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-contemplation', 'italic')" title="It√°lico (Ctrl+I)">I</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-contemplation', 'underline')" title="Sublinhado (Ctrl+U)">U</button>
              <button type="button" class="toolbar-btn" onclick="formatText('meditation-contemplation', 'strikethrough')" title="Tachado">~~</button>
              <div class="toolbar-separator"></div>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-contemplation', 'left')" title="Alinhar √† esquerda">‚´∑</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-contemplation', 'center')" title="Centralizar">‚´∏</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-contemplation', 'right')" title="Alinhar √† direita">‚´π</button>
              <button type="button" class="toolbar-btn" onclick="setTextAlign('meditation-contemplation', 'justify')" title="Justificar texto">‚´∫</button>
              <div class="toolbar-separator"></div>
              <select class="font-selector" onchange="setFontFamily('meditation-contemplation', this.value)" title="Selecionar fonte">
                <option value="Arial, sans-serif">Arial</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="'Courier New', monospace">Courier New</option>
                <option value="Georgia, serif">Georgia</option>
                <option value="Verdana, sans-serif">Verdana</option>
                <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                <option value="'Lucida Sans Unicode', sans-serif">Lucida Sans</option>
                <option value="'Palatino Linotype', serif">Palatino</option>
                <option value="'Garamond', serif">Garamond</option>
                <option value="'Bookman Old Style', serif">Bookman</option>
              </select>
              <div class="toolbar-separator"></div>
              <select class="font-size-selector" onchange="setFontSize('meditation-contemplation', this.value)" title="Tamanho da fonte">
                <option value="12px">12px</option>
                <option value="14px">14px</option>
                <option value="16px">16px</option>
                <option value="18px">18px</option>
                <option value="20px">20px</option>
                <option value="24px">24px</option>
                <option value="28px">28px</option>
                <option value="32px">32px</option>
              </select>
              <div class="toolbar-separator"></div>
              <button type="button" class="toolbar-btn" onclick="insertLineBreak('meditation-contemplation')" title="Quebra de linha (Ctrl+Enter)">‚Üµ</button>
              <button type="button" class="toolbar-btn" onclick="insertParagraph('meditation-contemplation')" title="Novo par√°grafo (Enter)">¬∂</button>
              <button type="button" class="toolbar-btn" onclick="insertList('meditation-contemplation', 'bullet')" title="Lista com marcadores">‚Ä¢</button>
              <button type="button" class="toolbar-btn" onclick="insertList('meditation-contemplation', 'number')" title="Lista numerada">1.</button>
            </div>
            <textarea id="meditation-contemplation" name="contemplation" rows="6" placeholder="Insira as orienta√ß√µes para contempla√ß√£o...&#10;&#10;Use Ctrl+Enter para quebra de linha&#10;Use Enter para novo par√°grafo"></textarea>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('meditation')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Confirma√ß√£o de Exclus√£o -->
  <div id="delete-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Confirmar Exclus√£o</h3>
        <button class="close-btn" onclick="closeModal('delete')">&times;</button>
      </div>
      <div class="modal-body">
        <p>Tem certeza que deseja excluir este item? Esta a√ß√£o n√£o pode ser desfeita.</p>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('delete')">Cancelar</button>
          <button type="button" class="btn btn-danger" id="confirm-delete-btn">Excluir</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Importar Dados -->
  <div id="import-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">üì• Importar Dados</h3>
        <button class="close-btn" onclick="closeImportModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p><strong>‚ö†Ô∏è Aten√ß√£o:</strong> Importar dados ir√° substituir todos os dados atuais. Fa√ßa backup antes de continuar.</p>
        
        <div class="import-options">
          <div class="import-option">
            <h4>üìÅ Importar Arquivo JSON</h4>
            <div class="form-group">
              <label for="import-file">Selecione o arquivo JSON:</label>
              <input type="file" id="import-file" accept=".json" onchange="handleFileSelect(event)">
            </div>
          </div>
          
          <div class="import-option">
            <h4>üìã Importar Dados de Exemplo</h4>
            <p>Carregar categorias e medita√ß√µes pr√©-definidas para teste.</p>
            <button type="button" class="btn btn-secondary" onclick="importExampleData()">
              üìã Carregar Dados de Exemplo
            </button>
          </div>
        </div>
        
        <div id="import-preview" style="display: none;">
          <h4>üìã Pr√©via dos Dados:</h4>
          <div id="import-summary"></div>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="closeImportModal()">Cancelar</button>
        <button type="button" class="btn btn-primary" id="confirm-import-btn" onclick="confirmImport()" disabled>Confirmar Importa√ß√£o</button>
      </div>
    </div>
  </div>

  <script>
    // Fun√ß√µes do Editor de Texto
    function formatText(textareaId, format) {
      const textarea = document.getElementById(textareaId);
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      
      let formattedText = '';
      switch(format) {
        case 'bold':
          formattedText = `**${selectedText}**`;
          break;
        case 'italic':
          formattedText = `*${selectedText}*`;
          break;
        case 'underline':
          formattedText = `__${selectedText}__`;
          break;
        case 'strikethrough':
          formattedText = `~~${selectedText}~~`;
          break;
        default:
          formattedText = selectedText;
      }
      
      textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
      textarea.focus();
      textarea.setSelectionRange(start + 2, start + 2 + selectedText.length);
    }

    function insertLineBreak(textareaId) {
      const textarea = document.getElementById(textareaId);
      const cursorPos = textarea.selectionStart;
      const textBefore = textarea.value.substring(0, cursorPos);
      const textAfter = textarea.value.substring(cursorPos);
      
      textarea.value = textBefore + '\n' + textAfter;
      textarea.focus();
      textarea.setSelectionRange(cursorPos + 1, cursorPos + 1);
    }

    function insertParagraph(textareaId) {
      const textarea = document.getElementById(textareaId);
      const cursorPos = textarea.selectionStart;
      const textBefore = textarea.value.substring(0, cursorPos);
      const textAfter = textarea.value.substring(cursorPos);
      
      textarea.value = textBefore + '\n\n' + textAfter;
      textarea.focus();
      textarea.setSelectionRange(cursorPos + 2, cursorPos + 2);
    }

    function insertList(textareaId, type) {
      const textarea = document.getElementById(textareaId);
      const cursorPos = textarea.selectionStart;
      const textBefore = textarea.value.substring(0, cursorPos);
      const textAfter = textarea.value.substring(cursorPos);
      
      let listItem = '';
      if (type === 'bullet') {
        listItem = '\n‚Ä¢ Item da lista';
      } else if (type === 'number') {
        listItem = '\n1. Item da lista';
      }
      
      textarea.value = textBefore + listItem + textAfter;
      textarea.focus();
      textarea.setSelectionRange(cursorPos + listItem.length - 12, cursorPos + listItem.length - 1);
    }

    function setTextAlign(textareaId, align) {
      const textarea = document.getElementById(textareaId);
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      
      let alignTag = '';
      switch(align) {
        case 'left':
          alignTag = `[align=left]${selectedText}[/align]`;
          break;
        case 'center':
          alignTag = `[align=center]${selectedText}[/align]`;
          break;
        case 'right':
          alignTag = `[align=right]${selectedText}[/align]`;
          break;
        case 'justify':
          alignTag = `[align=justify]${selectedText}[/align]`;
          break;
        default:
          alignTag = selectedText;
      }
      
      textarea.value = textarea.value.substring(0, start) + alignTag + textarea.value.substring(end);
      textarea.focus();
      textarea.setSelectionRange(start + 2, start + 2 + selectedText.length);
    }

    function setFontFamily(textareaId, fontFamily) {
      const textarea = document.getElementById(textareaId);
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      
      const fontTag = `[font=${fontFamily}]${selectedText}[/font]`;
      
      textarea.value = textarea.value.substring(0, start) + fontTag + textarea.value.substring(end);
      textarea.focus();
      textarea.setSelectionRange(start + 2, start + 2 + selectedText.length);
    }

    function setFontSize(textareaId, fontSize) {
      const textarea = document.getElementById(textareaId);
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      
      const sizeTag = `[size=${fontSize}]${selectedText}[/size]`;
      
      textarea.value = textarea.value.substring(0, start) + sizeTag + textarea.value.substring(end);
      textarea.focus();
      textarea.setSelectionRange(start + 2, start + 2 + selectedText.length);
    }

    // Fun√ß√£o para converter texto com formata√ß√£o para HTML
    function formatTextToHTML(text) {
      if (!text) return '';
      
      return text
        .replace(/\n\n/g, '</p><p>') // Quebras de par√°grafo
        .replace(/\n/g, '<br>') // Quebras de linha
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Negrito
        .replace(/\*(.*?)\*/g, '<em>$1</em>') // It√°lico
        .replace(/__(.*?)__/g, '<u>$1</u>') // Sublinhado
        .replace(/~~(.*?)~~/g, '<del>$1</del>') // Tachado
        .replace(/\[align=left\](.*?)\[\/align\]/g, '<div style="text-align: left;">$1</div>') // Alinhamento √† esquerda
        .replace(/\[align=center\](.*?)\[\/align\]/g, '<div style="text-align: center;">$1</div>') // Alinhamento centralizado
        .replace(/\[align=right\](.*?)\[\/align\]/g, '<div style="text-align: right;">$1</div>') // Alinhamento √† direita
        .replace(/\[align=justify\](.*?)\[\/align\]/g, '<div style="text-align: justify;">$1</div>') // Alinhamento justificado
        .replace(/\[font=(.*?)\](.*?)\[\/font\]/g, '<span style="font-family: $1;">$2</span>') // Fam√≠lia da fonte
        .replace(/\[size=(.*?)\](.*?)\[\/size\]/g, '<span style="font-size: $1;">$2</span>') // Tamanho da fonte
        .replace(/^/, '<p>') // In√≠cio do primeiro par√°grafo
        .replace(/$/, '</p>') // Fim do √∫ltimo par√°grafo
        .replace(/<p><\/p>/g, '<br>'); // Par√°grafos vazios viram quebras
    }

    // Fun√ß√£o para converter HTML de volta para texto simples
    function formatHTMLToText(html) {
      if (!html) return '';
      
      return html
        .replace(/<p>/g, '') // Remove tags de par√°grafo
        .replace(/<\/p>/g, '\n\n') // Converte fechamento de par√°grafo em quebra dupla
        .replace(/<br\s*\/?>/g, '\n') // Converte <br> em quebra de linha
        .replace(/<strong>(.*?)<\/strong>/g, '**$1**') // Converte <strong> em **
        .replace(/<em>(.*?)<\/em>/g, '*$1*') // Converte <em> em *
        .replace(/<u>(.*?)<\/u>/g, '__$1__') // Converte <u> em __
        .replace(/<del>(.*?)<\/del>/g, '~~$1~~') // Converte <del> em ~~
        .replace(/<div[^>]*style="[^"]*text-align:\s*left[^"]*"[^>]*>(.*?)<\/div>/g, '[align=left]$1[/align]') // Converte alinhamento √† esquerda
        .replace(/<div[^>]*style="[^"]*text-align:\s*center[^"]*"[^>]*>(.*?)<\/div>/g, '[align=center]$1[/align]') // Converte alinhamento centralizado
        .replace(/<div[^>]*style="[^"]*text-align:\s*right[^"]*"[^>]*>(.*?)<\/div>/g, '[align=right]$1[/align]') // Converte alinhamento √† direita
        .replace(/<div[^>]*style="[^"]*text-align:\s*justify[^"]*"[^>]*>(.*?)<\/div>/g, '[align=justify]$1[/align]') // Converte alinhamento justificado
        .replace(/<span[^>]*style="[^"]*font-family:\s*([^;"]*)[^"]*"[^>]*>(.*?)<\/span>/g, '[font=$1]$2[/font]') // Converte fam√≠lia da fonte
        .replace(/<span[^>]*style="[^"]*font-size:\s*([^;"]*)[^"]*"[^>]*>(.*?)<\/span>/g, '[size=$1]$2[/size]') // Converte tamanho da fonte
        .replace(/&nbsp;/g, ' ') // Converte espa√ßos n√£o-quebr√°veis
        .trim(); // Remove espa√ßos extras
    }

    // Adicionar event listeners para atalhos de teclado
    function setupTextEditorShortcuts() {
      const textareas = ['meditation-reading', 'meditation-meditation', 'meditation-prayer', 'meditation-contemplation'];
      
      textareas.forEach(id => {
        const textarea = document.getElementById(id);
        if (textarea) {
          textarea.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
              e.preventDefault();
              insertLineBreak(id);
            } else if (e.ctrlKey && e.key === 'b') {
              e.preventDefault();
              formatText(id, 'bold');
            } else if (e.ctrlKey && e.key === 'i') {
              e.preventDefault();
              formatText(id, 'italic');
            } else if (e.ctrlKey && e.key === 'u') {
              e.preventDefault();
              formatText(id, 'underline');
            }
          });
        }
      });
    }

    // Verificar se √© admin
    function checkAdminAccess() {
      const isAdmin = localStorage.getItem('isAdmin') === 'true';
      if (!isAdmin) {
        alert('Acesso negado. Fa√ßa login como administrador.');
        window.location.href = 'admin-login.html';
        return false;
      }
      return true;
    }

    // Carregar dados do admin
    function loadAdminData() {
      const adminEmail = localStorage.getItem('adminEmail') || 'admin@oraetmedita.com';
      const adminName = adminEmail.split('@')[0];
      
      document.getElementById('admin-name').textContent = adminName.charAt(0).toUpperCase() + adminName.slice(1);
      document.getElementById('admin-email').textContent = adminEmail;
      document.getElementById('admin-avatar').textContent = adminName.charAt(0).toUpperCase();
    }

    // Logout
    function logout() {
      localStorage.removeItem('isAdmin');
      localStorage.removeItem('adminEmail');
      localStorage.removeItem('adminLoginTime');
      window.location.href = 'admin-login.html';
    }

    // Navega√ß√£o entre tabs
    function showTab(tabName) {
      // Esconder todas as tabs
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => content.classList.remove('active'));
      
      // Remover classe active de todos os tabs
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      // Mostrar aba selecionada
      document.getElementById(tabName + '-tab').classList.add('active');
      
      // Adicionar classe active ao tab clicado
      event.target.classList.add('active');
      
      // Carregar dados espec√≠ficos da aba
      if (tabName === 'personalized') {
        loadPersonalizedMeditations();
      } else if (tabName === 'schedules') {
        loadSchedulesData();
      } else if (tabName === 'users') {
        loadUsersData();
      } else if (tabName === 'user-management') {
        loadUsersManagementData();
      }
    }

    // Carregar dados da tab
    function loadTabData(tabName) {
      switch(tabName) {
        case 'categories':
          loadCategories();
          break;
        case 'meditations':
          loadMeditations();
          break;
        case 'content':
          loadContent();
          break;
      }
    }

    // Carregar categorias
    function loadCategories() {
      const categories = JSON.parse(localStorage.getItem('categories')) || [];
      const grid = document.getElementById('categories-grid');
      
      grid.innerHTML = categories.map(category => `
        <div class="data-card">
          <div class="card-header">
            <div class="card-title">${category.icon} ${category.name}</div>
            <div class="card-actions">
              <button class="action-btn edit-btn" onclick="editCategory('${category.id}')">Editar</button>
              <button class="action-btn delete-btn" onclick="deleteCategory('${category.id}')">Excluir</button>
            </div>
          </div>
          <div class="card-content">${category.description}</div>
          <div class="card-stats">
            <span class="stat">Total: ${category.total || 0}</span>
            <span class="stat">Conclu√≠das: ${category.completed || 0}</span>
            <span class="stat">Status: ${category.status}</span>
          </div>
        </div>
      `).join('');
    }

    // Carregar medita√ß√µes
    function loadMeditations() {
      const meditations = JSON.parse(localStorage.getItem('meditations')) || [];
      const categories = JSON.parse(localStorage.getItem('categories')) || [];
      const grid = document.getElementById('meditations-grid');
      
      grid.innerHTML = meditations.map(meditation => {
        // Encontrar o nome da categoria
        const category = categories.find(c => c.id === meditation.categoryId);
        const categoryName = category ? category.name : 'Categoria n√£o encontrada';
        
        return `
          <div class="data-card">
            <div class="card-header">
              <div class="card-title">üìñ ${meditation.title}</div>
              <div class="card-actions">
                <button class="action-btn edit-btn" onclick="editMeditation('${meditation.id}')">Editar</button>
                <button class="action-btn delete-btn" onclick="deleteMeditation('${meditation.id}')">Excluir</button>
              </div>
            </div>

            <div class="card-stats">
              <span class="stat">Categoria: ${categoryName}</span>
              <span class="stat">Dura√ß√£o: ${meditation.duration || 0} min</span>
              <span class="stat">Status: ${meditation.status || 'available'}</span>
              <span class="stat">Tipo: ${meditation.type === 'premium' ? 'üíé Premium' : 'üÜì Free'}</span>
              <span class="stat">Lectio: ${meditation.reading ? '‚úÖ' : '‚ùå'} | ${meditation.meditation ? '‚úÖ' : '‚ùå'} | ${meditation.prayer ? '‚úÖ' : '‚ùå'} | ${meditation.contemplation ? '‚úÖ' : '‚ùå'}</span>
            </div>
          </div>
        `;
      }).join('');
    }

    // Carregar conte√∫do
    function loadContent() {
      const grid = document.getElementById('content-grid');
      
      grid.innerHTML = `
        <div class="data-card">
          <div class="card-header">
            <div class="card-title">üìù Editor de Conte√∫do</div>
          </div>
          <div class="card-content">
            Selecione uma medita√ß√£o para editar seu conte√∫do da Lectio Divina.
          </div>
          <div class="card-actions">
            <button class="action-btn edit-btn" onclick="openContentEditor()">Abrir Editor</button>
          </div>
        </div>
      `;
    }

    // Abrir modal
    function openModal(type) {
      document.getElementById(type + '-modal').style.display = 'block';
      
      if (type === 'meditation') {
        loadCategoryOptions();
        
        // Limpar formul√°rio se n√£o estiver editando
        const form = document.getElementById('meditation-form');
        if (!form.dataset.editing) {
          form.reset();
          document.getElementById('meditation-modal-title').textContent = 'Nova Medita√ß√£o';
        }
      }
    }

    // Fechar modal
    function closeModal(type) {
      document.getElementById(type + '-modal').style.display = 'none';
      const form = document.getElementById(type + '-form');
      form.reset();
      
      // Limpar dados de edi√ß√£o
      if (type === 'meditation') {
        form.removeAttribute('data-editing');
        document.getElementById('meditation-modal-title').textContent = 'Nova Medita√ß√£o';
      } else if (type === 'category') {
        form.removeAttribute('data-editing');
        document.getElementById('category-modal-title').textContent = 'Nova Categoria';
      }
    }

    // Carregar op√ß√µes de categoria
    function loadCategoryOptions() {
      const categories = JSON.parse(localStorage.getItem('categories')) || [];
      const select = document.getElementById('meditation-category');
      
      if (categories.length === 0) {
        select.innerHTML = '<option value="">Nenhuma categoria dispon√≠vel</option>';
        showNotification('Crie uma categoria primeiro!', 'warning');
        return;
      }
      
      select.innerHTML = '<option value="">Selecione uma categoria</option>' + 
        categories.map(category => 
          `<option value="${category.id}">${category.icon} ${category.name}</option>`
        ).join('');
    }

    // Editar categoria
    function editCategory(id) {
      const categories = JSON.parse(localStorage.getItem('categories')) || [];
      const category = categories.find(c => c.id === id);
      
      if (category) {
        document.getElementById('category-modal-title').textContent = 'Editar Categoria';
        document.getElementById('category-name').value = category.name;
        document.getElementById('category-icon').value = category.icon;
        document.getElementById('category-description').value = category.description;
        document.getElementById('category-color').value = category.color;
        document.getElementById('category-status').value = category.status;
        
        document.getElementById('category-form').dataset.editing = id;
        openModal('category');
      }
    }

    // Editar medita√ß√£o
    function editMeditation(id) {
      const meditations = JSON.parse(localStorage.getItem('meditations')) || [];
      const meditation = meditations.find(m => m.id === id);
      
      if (meditation) {
        console.log('üîç Medita√ß√£o encontrada para edi√ß√£o:', meditation);
        
        // Carregar op√ß√µes de categoria primeiro
        loadCategoryOptions();
        
        // Aguardar um momento para garantir que as op√ß√µes foram carregadas
        setTimeout(() => {
          document.getElementById('meditation-modal-title').textContent = 'Editar Medita√ß√£o';
          document.getElementById('meditation-title').value = meditation.title || '';
          document.getElementById('meditation-category').value = meditation.categoryId || '';
          document.getElementById('meditation-duration').value = meditation.duration || '12';
          document.getElementById('meditation-status').value = meditation.status || 'available';
          document.getElementById('meditation-type').value = meditation.type || 'free';
          document.getElementById('meditation-icon').value = meditation.icon || 'üìñ';
          
          // Usar campos corretos (lectio, meditatio, oratio, contemplatio)
          document.getElementById('meditation-reading').value = formatHTMLToText(meditation.lectio || meditation.reading || '');
          document.getElementById('meditation-meditation').value = formatHTMLToText(meditation.meditatio || meditation.meditation || '');
          document.getElementById('meditation-prayer').value = formatHTMLToText(meditation.oratio || meditation.prayer || '');
          document.getElementById('meditation-contemplation').value = formatHTMLToText(meditation.contemplatio || meditation.contemplation || '');
          
          document.getElementById('meditation-form').dataset.editing = id;
          openModal('meditation');
          
          console.log('‚úÖ Modal de edi√ß√£o aberto com sucesso');
        }, 100);
      } else {
        console.error('‚ùå Medita√ß√£o n√£o encontrada com ID:', id);
        showNotification('Medita√ß√£o n√£o encontrada!', 'error');
      }
    }

    // Excluir categoria
    async function deleteCategory(id) {
      const categories = JSON.parse(localStorage.getItem('categories')) || [];
      const categoryToDelete = categories.find(c => c.id === id);
      
      if (!categoryToDelete) {
        showNotification('Categoria n√£o encontrada!', 'error');
        return;
      }
      
      // Confirmar exclus√£o
      if (!confirm(`Tem certeza que deseja excluir a categoria "${categoryToDelete.name}"?`)) {
        return;
      }
      
      try {
        // Sincronizar com Supabase se dispon√≠vel
        if (window.supabaseManager) {
          try {
            console.log('üîÑ Sincronizando exclus√£o de categoria com Supabase...');
            console.log('üìù Categoria a ser exclu√≠da:', categoryToDelete);
            
            // Se o ID √© um UUID do Supabase, deletar diretamente
            if (id.includes('-') && id.length === 36) {
              // √â um UUID do Supabase
              await window.supabaseManager.deleteCategory(id);
              console.log('‚úÖ Categoria exclu√≠da do Supabase com sucesso');
            } else {
              // √â um ID local, tentar encontrar no Supabase pelo nome
              console.log('üîç Buscando categoria no Supabase pelo nome...');
              const supabaseCategories = await window.supabaseManager.getCategories();
              const supabaseCategory = supabaseCategories.find(cat => 
                cat.name === categoryToDelete.name
              );
              
              if (supabaseCategory) {
                await window.supabaseManager.deleteCategory(supabaseCategory.id);
                console.log('‚úÖ Categoria encontrada e exclu√≠da do Supabase');
              } else {
                console.log('‚ö†Ô∏è Categoria n√£o encontrada no Supabase, excluindo apenas localmente');
              }
            }
          } catch (supabaseError) {
            console.error('‚ö†Ô∏è Erro ao sincronizar exclus√£o com Supabase:', supabaseError);
            console.log('‚ÑπÔ∏è Categoria exclu√≠da apenas localmente');
          }
        } else {
          console.log('‚ÑπÔ∏è Supabase Manager n√£o dispon√≠vel - categoria exclu√≠da apenas localmente');
        }
        
        // Excluir localmente
        const filtered = categories.filter(c => c.id !== id);
        localStorage.setItem('categories', JSON.stringify(filtered));
        
        // Recarregar lista
        loadCategories();
        
        // Mostrar notifica√ß√£o de sucesso
        showNotification('Categoria exclu√≠da com sucesso!', 'success');
        
      } catch (error) {
        console.error('‚ùå Erro ao excluir categoria:', error);
        showNotification('Erro ao excluir categoria!', 'error');
      }
    }

    // Excluir medita√ß√£o
    async function deleteMeditation(id) {
      const meditations = JSON.parse(localStorage.getItem('meditations')) || [];
      const meditationToDelete = meditations.find(m => m.id === id);
      
      if (!meditationToDelete) {
        showNotification('Medita√ß√£o n√£o encontrada!', 'error');
        return;
      }
      
      // Confirmar exclus√£o
      if (!confirm(`Tem certeza que deseja excluir a medita√ß√£o "${meditationToDelete.title}"?`)) {
        return;
      }
      
      try {
        // Sincronizar com Supabase se dispon√≠vel
        if (window.supabaseManager) {
          try {
            console.log('üîÑ Sincronizando exclus√£o de medita√ß√£o com Supabase...');
            console.log('üìù Medita√ß√£o a ser exclu√≠da:', meditationToDelete);
            
            // Se o ID √© um UUID do Supabase, deletar diretamente
            if (id.includes('-') && id.length === 36) {
              // √â um UUID do Supabase
              await window.supabaseManager.deleteMeditation(id);
              console.log('‚úÖ Medita√ß√£o exclu√≠da do Supabase com sucesso');
            } else {
              // √â um ID local, tentar encontrar no Supabase pelo t√≠tulo
              console.log('üîç Buscando medita√ß√£o no Supabase pelo t√≠tulo...');
              const supabaseMeditations = await window.supabaseManager.getMeditations();
              const supabaseMeditation = supabaseMeditations.find(med => 
                med.title === meditationToDelete.title
              );
              
              if (supabaseMeditation) {
                await window.supabaseManager.deleteMeditation(supabaseMeditation.id);
                console.log('‚úÖ Medita√ß√£o encontrada e exclu√≠da do Supabase');
              } else {
                console.log('‚ö†Ô∏è Medita√ß√£o n√£o encontrada no Supabase, excluindo apenas localmente');
              }
            }
          } catch (supabaseError) {
            console.error('‚ö†Ô∏è Erro ao sincronizar exclus√£o com Supabase:', supabaseError);
            console.log('‚ÑπÔ∏è Medita√ß√£o exclu√≠da apenas localmente');
          }
        } else {
          console.log('‚ÑπÔ∏è Supabase Manager n√£o dispon√≠vel - medita√ß√£o exclu√≠da apenas localmente');
        }
        
        // Excluir localmente
        const filtered = meditations.filter(m => m.id !== id);
        localStorage.setItem('meditations', JSON.stringify(filtered));
        
        // Recarregar lista
        loadMeditations();
        
        // Mostrar notifica√ß√£o de sucesso
        showNotification('Medita√ß√£o exclu√≠da com sucesso!', 'success');
        
      } catch (error) {
        console.error('‚ùå Erro ao excluir medita√ß√£o:', error);
        showNotification('Erro ao excluir medita√ß√£o!', 'error');
      }
    }

    // Abrir editor de conte√∫do
    function openContentEditor() {
      alert('Editor de conte√∫do ser√° implementado em breve!');
    }



    // Fun√ß√£o para mostrar notifica√ß√µes
    function showNotification(message, type = 'info') {
      // Criar elemento de notifica√ß√£o
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      
      // Estilos da notifica√ß√£o
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 10000;
        animation: slideIn 0.3s ease;
        max-width: 300px;
      `;
      
      // Cores baseadas no tipo
      switch(type) {
        case 'success':
          notification.style.background = '#10B981';
          break;
        case 'error':
          notification.style.background = '#EF4444';
          break;
        case 'warning':
          notification.style.background = '#F59E0B';
          break;
        default:
          notification.style.background = '#3B82F6';
      }
      
      // Adicionar ao DOM
      document.body.appendChild(notification);
      
      // Remover ap√≥s 3 segundos
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Adicionar estilos CSS para anima√ß√µes
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
        // Event listener para formul√°rio de estat√≠sticas do usu√°rio
        const userStatsForm = document.getElementById('user-stats-form');
        if (userStatsForm) {
            userStatsForm.addEventListener('submit', saveUserStats);
        }
      if (!checkAdminAccess()) return;
      
      loadAdminData();
      loadCategories();
      loadMeditations(); // Carregar medita√ß√µes tamb√©m na inicializa√ß√£o
      setupTextEditorShortcuts(); // Configurar atalhos do editor de texto

      // Form submit handlers
      document.getElementById('category-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        console.log('üîÑ Formul√°rio de categoria submetido');
        
        const formData = new FormData(this);
        const editingId = this.dataset.editing;
        
        console.log('üìù Editing ID:', editingId);
        console.log('üìù FormData entries:');
        for (let [key, value] of formData.entries()) {
          console.log(`  ${key}: ${value}`);
        }
        
        const categoryData = {
          name: formData.get('name'),
          icon: formData.get('icon'),
          description: formData.get('description'),
          color: formData.get('color'),
          status: formData.get('status')
        };
        
        console.log('üìù Category Data:', categoryData);

        const categories = JSON.parse(localStorage.getItem('categories')) || [];
        
        if (editingId) {
          console.log('‚úèÔ∏è Modo de edi√ß√£o detectado');
          // Atualizar
          const index = categories.findIndex(c => c.id === editingId);
          console.log('üìù √çndice encontrado:', index);
          if (index !== -1) {
            const originalCategory = categories[index];
            categories[index] = { ...categories[index], ...categoryData };
            
            // Sincronizar com Supabase se dispon√≠vel
                    console.log('üîç Verificando Supabase Manager...');
        console.log('üìù window.supabaseManager:', window.supabaseManager);
        console.log('üìù typeof window.supabaseManager:', typeof window.supabaseManager);
        console.log('üìù window.supabaseManager.updateCategory:', typeof window.supabaseManager?.updateCategory);
        if (window.supabaseManager) {
              try {
                console.log('üîÑ Sincronizando edi√ß√£o de categoria com Supabase...');
                console.log('üìù Categoria original:', originalCategory);
                console.log('üìù Categoria atualizada:', categories[index]);
                
                // Se o ID √© um UUID do Supabase, atualizar diretamente
                if (editingId.includes('-') && editingId.length === 36) {
                  // √â um UUID do Supabase
                  const supabaseCategoryData = {
                    name: categoryData.name,
                    description: categoryData.description,
                    icon: categoryData.icon || '',
                    color: categoryData.color || '#7ee787',
                    is_active: categoryData.status === 'active',
                    sort_order: index
                  };
                  
                  await window.supabaseManager.updateCategory(editingId, supabaseCategoryData);
                  console.log('‚úÖ Categoria atualizada no Supabase com sucesso');
                } else {
                  // √â um ID local, tentar encontrar no Supabase pelo nome original
                  console.log('üîç Buscando categoria no Supabase pelo nome original...');
                  const supabaseCategories = await window.supabaseManager.getCategories();
                  const supabaseCategory = supabaseCategories.find(cat => 
                    cat.name === originalCategory.name
                  );
                  
                  if (supabaseCategory) {
                    const supabaseCategoryData = {
                      name: categoryData.name,
                      description: categoryData.description,
                      icon: categoryData.icon || '',
                      color: categoryData.color || '#7ee787',
                      is_active: categoryData.status === 'active',
                      sort_order: index
                    };
                    
                    await window.supabaseManager.updateCategory(supabaseCategory.id, supabaseCategoryData);
                    console.log('‚úÖ Categoria encontrada e atualizada no Supabase');
                  } else {
                    console.log('‚ö†Ô∏è Categoria n√£o encontrada no Supabase, atualizando apenas localmente');
                  }
                }
              } catch (supabaseError) {
                console.error('‚ö†Ô∏è Erro ao sincronizar edi√ß√£o com Supabase:', supabaseError);
                console.log('‚ÑπÔ∏è Categoria atualizada apenas localmente');
              }
            } else {
              console.log('‚ÑπÔ∏è Supabase Manager n√£o dispon√≠vel - categoria atualizada apenas localmente');
            }
          }
        } else {
          // Criar nova
          const newCategory = {
            id: 'cat_' + Date.now(),
            ...categoryData,
            total: 0,
            completed: 0,
            inProgress: 0,
            locked: 0
          };
          categories.push(newCategory);
          
          // Sincronizar com Supabase se dispon√≠vel
          if (window.supabaseManager) {
            try {
              console.log('üîÑ Sincronizando categoria com Supabase...');
              const supabaseCategory = {
                name: newCategory.name,
                description: newCategory.description,
                icon: newCategory.icon || '',
                color: newCategory.color || '#7ee787',
                is_active: true,
                sort_order: categories.length
              };
              
              const createdCategory = await window.supabaseManager.createCategory(supabaseCategory);
              console.log('‚úÖ Categoria criada no Supabase:', createdCategory);
              
              // Atualizar o ID local com o ID do Supabase
              if (createdCategory && createdCategory[0]) {
                newCategory.id = createdCategory[0].id;
                localStorage.setItem('categories', JSON.stringify(categories));
                console.log('üîÑ ID da categoria atualizado com ID do Supabase:', newCategory.id);
              }
            } catch (supabaseError) {
              console.error('‚ö†Ô∏è Erro ao sincronizar categoria com Supabase:', supabaseError);
              console.log('‚ÑπÔ∏è Categoria salva apenas localmente');
            }
          } else {
            console.log('‚ÑπÔ∏è Supabase Manager n√£o dispon√≠vel - categoria salva apenas localmente');
          }
        }

        localStorage.setItem('categories', JSON.stringify(categories));
        
        // Notificar dashboard para atualiza√ß√£o imediata
        if (window.refreshDashboardData) {
            window.refreshDashboardData();
        }
        
        loadCategories();
        closeModal('category');
        this.removeAttribute('data-editing');
        document.getElementById('category-modal-title').textContent = 'Nova Categoria';
      });

      document.getElementById('meditation-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        console.log('üîÑ Formul√°rio de medita√ß√£o submetido');
        
        const formData = new FormData(this);
        const editingId = this.dataset.editing;
        
        console.log('üìù Editing ID:', editingId);
        console.log('üìù FormData entries:');
        for (let [key, value] of formData.entries()) {
          console.log(`  ${key}: ${value}`);
        }
        

        
        // Valida√ß√£o dos campos obrigat√≥rios
        const title = formData.get('title').trim();
        const categoryId = formData.get('categoryId');
        
        if (!title) {
          showNotification('O t√≠tulo √© obrigat√≥rio!', 'error');
          return;
        }
        
        if (!categoryId) {
          showNotification('Selecione uma categoria!', 'error');
          return;
        }
        
        // Capturar todos os campos do formul√°rio e processar formata√ß√£o
        const meditationData = {
          title: formData.get('title') || '',
          categoryId: formData.get('categoryId') || '',
          duration: formData.get('duration') || '12',
          status: formData.get('status') || 'available',
          type: formData.get('type') || 'free',
          icon: formData.get('icon') || 'üìñ',
          // Usar nomes corretos dos campos (lectio, meditatio, oratio, contemplatio)
          lectio: formatTextToHTML(formData.get('reading') || ''),
          meditatio: formatTextToHTML(formData.get('meditation') || ''),
          oratio: formatTextToHTML(formData.get('prayer') || ''),
          contemplatio: formatTextToHTML(formData.get('contemplation') || ''),
          // Manter compatibilidade com nomes antigos
          reading: formatTextToHTML(formData.get('reading') || ''),
          meditation: formatTextToHTML(formData.get('meditation') || ''),
          prayer: formatTextToHTML(formData.get('prayer') || ''),
          contemplation: formatTextToHTML(formData.get('contemplation') || '')
        };
        


        const meditations = JSON.parse(localStorage.getItem('meditations')) || [];
        
        if (editingId) {
          console.log('‚úèÔ∏è Modo de edi√ß√£o de medita√ß√£o detectado');
          // Atualizar
          const index = meditations.findIndex(m => m.id === editingId);
          console.log('üìù √çndice da medita√ß√£o encontrado:', index);
          if (index !== -1) {
            const originalMeditation = meditations[index];
            meditations[index] = { 
              ...meditations[index], 
              ...meditationData,
              updatedAt: new Date().toISOString()
            };
            
            // Sincronizar com Supabase se dispon√≠vel
            console.log('üîç Verificando Supabase Manager para medita√ß√£o...');
            console.log('üìù window.supabaseManager:', window.supabaseManager);
            console.log('üìù typeof window.supabaseManager:', typeof window.supabaseManager);
            console.log('üìù window.supabaseManager.updateMeditation:', typeof window.supabaseManager?.updateMeditation);
            if (window.supabaseManager) {
              try {
                console.log('üîÑ Sincronizando edi√ß√£o de medita√ß√£o com Supabase...');
                console.log('üìù Medita√ß√£o original:', originalMeditation);
                console.log('üìù Medita√ß√£o atualizada:', meditations[index]);
                
                // Se o ID √© um UUID do Supabase, atualizar diretamente
                if (editingId.includes('-') && editingId.length === 36) {
                  // √â um UUID do Supabase
                  const supabaseMeditationData = {
                    title: meditationData.title,
                    content: meditationData.meditation || meditationData.meditatio || '',
                    duration_minutes: parseInt(meditationData.duration) || 12,
                    difficulty_level: 'beginner',
                    status: meditationData.status || 'active'
                  };
                  
                  await window.supabaseManager.updateMeditation(editingId, supabaseMeditationData);
                  console.log('‚úÖ Medita√ß√£o atualizada no Supabase com sucesso');
                } else {
                  // √â um ID local, tentar encontrar no Supabase pelo t√≠tulo original
                  console.log('üîç Buscando medita√ß√£o no Supabase pelo t√≠tulo original...');
                  const supabaseMeditations = await window.supabaseManager.getMeditations();
                  const supabaseMeditation = supabaseMeditations.find(med => 
                    med.title === originalMeditation.title
                  );
                  
                  if (supabaseMeditation) {
                    const supabaseMeditationData = {
                      title: meditationData.title,
                      content: meditationData.meditation || meditationData.meditatio || '',
                      duration_minutes: parseInt(meditationData.duration) || 12,
                      difficulty_level: 'beginner',
                      status: meditationData.status || 'active'
                    };
                    
                    await window.supabaseManager.updateMeditation(supabaseMeditation.id, supabaseMeditationData);
                    console.log('‚úÖ Medita√ß√£o encontrada e atualizada no Supabase');
                  } else {
                    console.log('‚ö†Ô∏è Medita√ß√£o n√£o encontrada no Supabase, atualizando apenas localmente');
                  }
                }
              } catch (supabaseError) {
                console.error('‚ö†Ô∏è Erro ao sincronizar edi√ß√£o com Supabase:', supabaseError);
                console.log('‚ÑπÔ∏è Medita√ß√£o atualizada apenas localmente');
              }
            } else {
              console.log('‚ÑπÔ∏è Supabase Manager n√£o dispon√≠vel - medita√ß√£o atualizada apenas localmente');
            }
          }
        } else {
          // Criar nova
          const newMeditation = {
            id: 'med_' + Date.now(),
            ...meditationData,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            total: 0,
            completed: 0,
            inProgress: 0,
            locked: 0
          };
          meditations.push(newMeditation);
          
          // Sincronizar com Supabase se dispon√≠vel
          if (window.supabaseManager) {
            try {
              console.log('üîÑ Sincronizando medita√ß√£o com Supabase...');
              
              // Buscar o UUID da categoria no Supabase baseado no nome
              let supabaseCategoryId = null;
              try {
                const categories = await window.supabaseManager.getCategories();
                const localCategory = categories.find(cat => cat.id === newMeditation.categoryId || cat.name === newMeditation.categoryId);
                if (localCategory) {
                  supabaseCategoryId = localCategory.id;
                  console.log('‚úÖ Categoria encontrada no Supabase:', localCategory.name, 'ID:', supabaseCategoryId);
                } else {
                  console.log('‚ö†Ô∏è Categoria n√£o encontrada no Supabase, usando null');
                }
              } catch (categoryError) {
                console.error('‚ö†Ô∏è Erro ao buscar categoria:', categoryError);
              }
              
              const supabaseMeditation = {
                title: newMeditation.title,
                content: newMeditation.meditation || newMeditation.meditatio || '',
                category_id: supabaseCategoryId,
                duration_minutes: parseInt(newMeditation.duration) || 12,
                difficulty_level: 'beginner',
                status: newMeditation.status || 'active',
                created_by: null // Ser√° preenchido quando tivermos autentica√ß√£o
              };
              
              console.log('üìù Dados da medita√ß√£o para Supabase:', supabaseMeditation);
              
              const createdMeditation = await window.supabaseManager.createMeditation(supabaseMeditation);
              console.log('‚úÖ Medita√ß√£o criada no Supabase:', createdMeditation);
              
              // Atualizar o ID local com o ID do Supabase
              if (createdMeditation && createdMeditation[0]) {
                newMeditation.id = createdMeditation[0].id;
                localStorage.setItem('meditations', JSON.stringify(meditations));
                console.log('üîÑ ID da medita√ß√£o atualizado com ID do Supabase:', newMeditation.id);
              }
            } catch (supabaseError) {
              console.error('‚ö†Ô∏è Erro ao sincronizar medita√ß√£o com Supabase:', supabaseError);
              console.log('‚ÑπÔ∏è Medita√ß√£o salva apenas localmente');
            }
          } else {
            console.log('‚ÑπÔ∏è Supabase Manager n√£o dispon√≠vel - medita√ß√£o salva apenas localmente');
          }
        }

        // Salvar no localStorage
        localStorage.setItem('meditations', JSON.stringify(meditations));
        
        // Limpar cache para for√ßar atualiza√ß√£o no dashboard
        localStorage.removeItem('meditations_cache');
        localStorage.removeItem('categories_cache');
        
        // Notificar dashboard para atualiza√ß√£o imediata
        if (window.refreshDashboardData) {
            window.refreshDashboardData();
        }
        
        // Recarregar a lista de medita√ß√µes
        loadMeditations();
        
        // Fechar modal e limpar formul√°rio
        closeModal('meditation');
        this.removeAttribute('data-editing');
        document.getElementById('meditation-modal-title').textContent = 'Nova Medita√ß√£o';
        
        // Mostrar notifica√ß√£o de sucesso
        showNotification(editingId ? 'Medita√ß√£o atualizada com sucesso!' : 'Medita√ß√£o criada com sucesso!', 'success');
      });
    });

    // Fechar modal ao clicar fora
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    };

    // ===== FUN√á√ïES DE EXPORTAR/IMPORTAR =====

    // Exportar dados
    function exportData() {
      try {
        const data = {
          exportDate: new Date().toISOString(),
          version: '1.0',
          categories: JSON.parse(localStorage.getItem('categories')) || [],
          meditations: JSON.parse(localStorage.getItem('meditations')) || [],
          personalized_meditations: JSON.parse(localStorage.getItem('personalized_meditations')) || [],
          personalized_meditations_history: JSON.parse(localStorage.getItem('personalized_meditations_history')) || [],
          userProgress: JSON.parse(localStorage.getItem('userProgress')) || {},
          settings: JSON.parse(localStorage.getItem('settings')) || {},
          // NOVOS CAMPOS: Agendamentos e Estat√≠sticas de Usu√°rios
          user_schedules: JSON.parse(localStorage.getItem('user_schedules')) || [],
          user_meditation_stats: JSON.parse(localStorage.getItem('user_meditation_stats')) || {},
          current_user: JSON.parse(localStorage.getItem('current_user')) || null
        };

        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `oraetmedita_backup_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showNotification('‚úÖ Dados exportados com sucesso! Incluindo medita√ß√µes personalizadas, agendamentos e estat√≠sticas do dashboard.', 'success');
      } catch (error) {
        console.error('Erro ao exportar dados:', error);
        showNotification('‚ùå Erro ao exportar dados!', 'error');
      }
    }

    // Abrir modal de importa√ß√£o
    function importData() {
      document.getElementById('import-modal').style.display = 'block';
      document.getElementById('import-file').value = '';
      document.getElementById('import-preview').style.display = 'none';
      document.getElementById('confirm-import-btn').disabled = true;
    }

    // Importar dados de exemplo
    function importExampleData() {
      const exampleData = {
        "principios": {
          name: "Princ√≠pios da Vida Sobrenatural",
          icon: "üìñ",
          description: "Medita√ß√µes sobre os fundamentos da vida espiritual",
          color: "linear-gradient(135deg, #7ee787, #4ade80)",
          total: 1,
          completed: 0,
          inProgress: 0,
          locked: 0,
          meditations: [{
            id: "1",
            title: "Princ√≠pios da Vida Sobrenatural",
            duration: "12 min",
            status: "available",
            reading: "Neste texto, Jesus se apresenta como a videira verdadeira e nos convida a permanecer nele. A palavra 'permanecer' aparece v√°rias vezes, indicando a import√¢ncia de uma rela√ß√£o cont√≠nua e profunda com Cristo. Observe como Jesus enfatiza que sem ele nada podemos fazer, mostrando nossa depend√™ncia total de sua gra√ßa.",
            meditation: "Reflita sobre o que significa 'permanecer em Cristo' na sua vida di√°ria. Como voc√™ pode cultivar essa rela√ß√£o mais profunda? Que frutos voc√™ tem produzido? H√° √°reas da sua vida onde voc√™ sente que n√£o est√° 'permanecendo' em Cristo? O que isso significa para sua ora√ß√£o, seus relacionamentos, seu trabalho?",
            prayer: "Senhor Jesus, videira verdadeira, eu quero permanecer em ti. Ajuda-me a reconhecer minha depend√™ncia total de tua gra√ßa. Que eu possa dar frutos que glorifiquem o Pai. Purifica-me, como o agricultor limpa os ramos, para que eu possa produzir mais frutos ainda. Ensina-me a permanecer em tua palavra e em tua presen√ßa.",
            contemplation: "Permane√ßa em sil√™ncio na presen√ßa de Jesus, a videira verdadeira. Sinta-se como um ramo conectado √† fonte da vida. Deixe que o amor de Deus flua atrav√©s de voc√™. Simplesmente esteja na presen√ßa de quem √© a vida, a verdade e o caminho."
          }]
        },
        "mariologia": {
          name: "A Humildade de Maria",
          icon: "üíù",
          description: "Medita√ß√µes sobre a vida e virtudes de Maria",
          color: "linear-gradient(135deg, #fbbf24, #f59e0b)",
          total: 1,
          completed: 0,
          inProgress: 0,
          locked: 0,
          meditations: [{
            id: "2",
            title: "A Humildade de Maria",
            duration: "15 min",
            status: "available",
            reading: "Maria recebe a visita do anjo Gabriel com uma mensagem extraordin√°ria. Observe sua rea√ß√£o inicial de perturba√ß√£o e reflex√£o. Ela faz uma pergunta honesta sobre como isso acontecer√°, mas sua resposta final √© de total disponibilidade: 'Eis aqui a serva do Senhor. Fa√ßa-se em mim segundo a tua palavra.'",
            meditation: "Como voc√™ reage quando Deus te chama para algo que parece imposs√≠vel ou que vai mudar completamente sua vida? Voc√™ tem a humildade de Maria para se colocar como 'serva do Senhor'? Que significa para voc√™ 'fa√ßa-se em mim segundo a tua palavra'? Como voc√™ pode cultivar essa disponibilidade total a Deus?",
            prayer: "Maria, M√£e de Deus, ensina-me a humildade. Ajuda-me a dizer 'sim' a Deus como tu disseste. Que eu possa ser uma serva fiel do Senhor, dispon√≠vel para sua vontade. Intercede por mim para que eu tenha a coragem de aceitar os planos de Deus para minha vida, mesmo quando n√£o os entendo completamente.",
            contemplation: "Contemple Maria em sua humildade e disponibilidade. Veja como ela se coloca totalmente nas m√£os de Deus. Deixe que seu exemplo inspire voc√™ a confiar mais profundamente na provid√™ncia divina. Permane√ßa em sil√™ncio, permitindo que Deus fale ao seu cora√ß√£o."
          }]
        }
      };
      
      // Salvar categorias no localStorage
      localStorage.setItem('categories', JSON.stringify(exampleData));
      
      // Incluir medita√ß√µes personalizadas geradas pelo ChatGPT
      const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
      if (personalizedMeditations.length > 0) {
        // Criar categoria para medita√ß√µes personalizadas
        const personalizedCategory = {
          name: "Medita√ß√µes Personalizadas",
          icon: "‚ú®",
          description: "Medita√ß√µes geradas personalizadamente para voc√™",
          color: "linear-gradient(135deg, #8b5cf6, #3b82f6)",
          total: personalizedMeditations.length,
          completed: 0,
          inProgress: 0,
          locked: 0,
          meditations: personalizedMeditations.map(med => ({
            id: med.id,
            title: med.title,
            duration: med.duration || '15 min',
            status: 'available',
            reading: med.content,
            meditation: med.content,
            prayer: med.content,
            contemplation: med.content,
            createdAt: med.createdAt,
            source: 'chatgpt',
            type: 'personalized'
          }))
        };
        
        // Adicionar √† estrutura de dados
        exampleData.personalized = personalizedCategory;
        
        // Atualizar localStorage com dados completos
        localStorage.setItem('categories', JSON.stringify(exampleData));
        
        // Salvar tamb√©m as medita√ß√µes personalizadas separadamente
        localStorage.setItem('personalized_meditations', JSON.stringify(personalizedMeditations));
        
        // Salvar hist√≥rico se existir
        const personalizedHistory = JSON.parse(localStorage.getItem('personalized_meditations_history') || '[]');
        if (personalizedHistory.length > 0) {
          localStorage.setItem('personalized_meditations_history', JSON.stringify(personalizedHistory));
        }
      }
      
      // Recarregar os dados
      loadCategories();
      loadMeditations();
      
      // Fechar o modal de importa√ß√£o
      closeImportModal();
      
      showNotification('‚úÖ Dados de exemplo importados com sucesso! Incluindo medita√ß√µes personalizadas.', 'success');
    }

    // Fechar modal de importa√ß√£o
    function closeImportModal() {
      document.getElementById('import-modal').style.display = 'none';
    }

    // Lidar com sele√ß√£o de arquivo
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          // Validar estrutura do arquivo
          if (!data.categories || !data.meditations) {
            showNotification('‚ùå Arquivo inv√°lido! Estrutura incorreta.', 'error');
            return;
          }

          // Mostrar pr√©via
          showImportPreview(data);
          document.getElementById('confirm-import-btn').disabled = false;
          
        } catch (error) {
          console.error('Erro ao ler arquivo:', error);
          showNotification('‚ùå Erro ao ler arquivo! Verifique se √© um JSON v√°lido.', 'error');
        }
      };
      reader.readAsText(file);
    }

    // Mostrar pr√©via dos dados
    function showImportPreview(data) {
      const preview = document.getElementById('import-preview');
      const summary = document.getElementById('import-summary');
      
      const categoriesCount = data.categories.length;
      const meditationsCount = data.meditations.length;
      const personalizedCount = data.personalized_meditations ? data.personalized_meditations.length : 0;
      const historyCount = data.personalized_meditations_history ? data.personalized_meditations_history.length : 0;
      const schedulesCount = data.user_schedules ? data.user_schedules.length : 0;
      const userStatsCount = data.user_meditation_stats ? Object.keys(data.user_meditation_stats).length : 0;
      const currentUser = data.current_user ? 'Sim' : 'N√£o';
      const exportDate = data.exportDate ? new Date(data.exportDate).toLocaleString('pt-BR') : 'Data desconhecida';
      
      summary.innerHTML = `
        <div style="background: #23243a; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
          <p><strong>üìÖ Data de Exporta√ß√£o:</strong> ${exportDate}</p>
          <p><strong>üìö Categorias:</strong> ${categoriesCount}</p>
          <p><strong>üìñ Medita√ß√µes:</strong> ${meditationsCount}</p>
          <p><strong>‚ú® Medita√ß√µes Personalizadas:</strong> ${personalizedCount}</p>
          <p><strong>üìã Hist√≥rico de Gera√ß√µes:</strong> ${historyCount}</p>
          <p><strong>üìÖ Agendamentos:</strong> ${schedulesCount}</p>
          <p><strong>üìä Estat√≠sticas do Dashboard:</strong> Dispon√≠vel</p>
          <p><strong>üë§ Usu√°rio Atual:</strong> ${currentUser}</p>
          <p><strong>‚öôÔ∏è Configura√ß√µes:</strong> ${Object.keys(data.settings || {}).length}</p>
          <p><strong>üìä Progresso:</strong> ${Object.keys(data.userProgress || {}).length} usu√°rios</p>
        </div>
        <p style="color: #f59e0b;"><strong>‚ö†Ô∏è Importar ir√° substituir todos os dados atuais!</strong></p>
      `;
      
      preview.style.display = 'block';
    }

    // Confirmar importa√ß√£o
    function confirmImport() {
      const file = document.getElementById('import-file').files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          // Importar dados b√°sicos
          localStorage.setItem('categories', JSON.stringify(data.categories || []));
          localStorage.setItem('meditations', JSON.stringify(data.meditations || []));
          localStorage.setItem('userProgress', JSON.stringify(data.userProgress || {}));
          localStorage.setItem('settings', JSON.stringify(data.settings || {}));
          
          // Importar agendamentos se existirem no arquivo
          if (data.user_schedules) {
            localStorage.setItem('user_schedules', JSON.stringify(data.user_schedules));
            console.log('‚úÖ Agendamentos importados:', data.user_schedules.length);
          }
          
          // Importar estat√≠sticas de usu√°rios se existirem no arquivo
                  if (data.user_meditation_stats) {
          localStorage.setItem('user_meditation_stats', JSON.stringify(data.user_meditation_stats));
          console.log('‚úÖ Estat√≠sticas de usu√°rios importadas (legado)');
        }
          
          // Importar usu√°rio atual se existir no arquivo
          if (data.current_user) {
            localStorage.setItem('current_user', JSON.stringify(data.current_user));
            console.log('‚úÖ Usu√°rio atual importado');
          }
          
          // Importar medita√ß√µes personalizadas se existirem no arquivo
          if (data.personalized_meditations) {
            localStorage.setItem('personalized_meditations', JSON.stringify(data.personalized_meditations));
            console.log('‚úÖ Medita√ß√µes personalizadas importadas:', data.personalized_meditations.length);
          }
          
          // Importar hist√≥rico de medita√ß√µes personalizadas se existir
          if (data.personalized_meditations_history) {
            localStorage.setItem('personalized_meditations_history', JSON.stringify(data.personalized_meditations_history));
            console.log('‚úÖ Hist√≥rico de medita√ß√µes personalizadas importado');
          }
          
          // Limpar cache
          localStorage.removeItem('meditations_cache');
          localStorage.removeItem('categories_cache');
          
          // Recarregar dados
          loadCategories();
          loadMeditations();
          
          // Fechar modal
          closeImportModal();
          
          showNotification('‚úÖ Dados importados com sucesso! Incluindo medita√ß√µes personalizadas, agendamentos e estat√≠sticas do dashboard.', 'success');
          
        } catch (error) {
          console.error('Erro ao importar dados:', error);
          showNotification('‚ùå Erro ao importar dados!', 'error');
        }
      };
      reader.readAsText(file);
    }

    // ===== FUN√á√ïES PARA MEDITA√á√ïES PERSONALIZADAS =====

    // Carregar medita√ß√µes personalizadas
    function loadPersonalizedMeditations() {
      const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
      const grid = document.getElementById('personalized-grid');
      
      // Obter usu√°rio atual logado
      const currentUser = window.sessionManager ? window.sessionManager.getCurrentUser() : null;
      const currentUserId = currentUser ? currentUser.id : null;
      const currentUserName = currentUser ? currentUser.name : 'Usu√°rio Desconhecido';
      
      console.log('üë§ Usu√°rio atual:', currentUserName, 'ID:', currentUserId);
      
      // Filtrar medita√ß√µes do usu√°rio atual
      const userMeditations = personalizedMeditations.filter(meditation => {
        // Se n√£o h√° userId na medita√ß√£o, mostrar apenas se n√£o h√° usu√°rio logado (admin)
        if (!meditation.userId) {
          return !currentUserId;
        }
        // Mostrar apenas medita√ß√µes do usu√°rio atual
        return meditation.userId === currentUserId;
      });
      
      console.log('üìä Medita√ß√µes encontradas:', userMeditations.length, 'de', personalizedMeditations.length, 'total');
      
      if (userMeditations.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ú®</div>
            <h3>Nenhuma medita√ß√£o personalizada encontrada</h3>
            <p>${currentUserId ? `Voc√™ ainda n√£o criou medita√ß√µes personalizadas.` : 'As medita√ß√µes geradas pelo ChatGPT aparecer√£o aqui quando forem criadas pelos usu√°rios.'}</p>
          </div>
        `;
        return;
      }

      const html = userMeditations.map(meditation => `
        <div class="data-card">
          <div class="card-header">
            <h3>${meditation.title}</h3>
            <div class="card-actions">
              <button class="btn btn-sm btn-secondary" onclick="viewPersonalizedMeditation('${meditation.id}')">
                üëÅÔ∏è Ver
              </button>
              <button class="btn btn-sm btn-danger" onclick="deletePersonalizedMeditation('${meditation.id}')">
                üóëÔ∏è
              </button>
            </div>
          </div>
          <div class="card-content">
            <p><strong>T√≥pico:</strong> ${meditation.topic || 'N/A'}</p>
            <p><strong>Dura√ß√£o:</strong> ${meditation.duration || '15 min'}</p>
            <p><strong>Status:</strong> ${meditation.status || 'pending'}</p>
            <p><strong>Criada em:</strong> ${meditation.createdAt ? new Date(meditation.createdAt).toLocaleString('pt-BR') : 'N/A'}</p>
            <p><strong>Fonte:</strong> ${meditation.source || 'chatgpt'}</p>
            <p><strong>Tipo:</strong> ${meditation.type || 'simple'}</p>
            <p><strong>Usu√°rio:</strong> <span style="color: var(--accent-blue); font-weight: 600;">${meditation.userName || currentUserName}</span></p>
            <p><strong>ID do Usu√°rio:</strong> <code style="background: #23243a; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;">${meditation.userId || 'N/A'}</code></p>
          </div>
        </div>
      `).join('');

      grid.innerHTML = html;
    }

    // Visualizar medita√ß√£o personalizada
    function viewPersonalizedMeditation(id) {
      const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
      const meditation = personalizedMeditations.find(m => m.id === id);
      
      if (!meditation) {
        showNotification('‚ùå Medita√ß√£o n√£o encontrada!', 'error');
        return;
      }

      // Obter usu√°rio atual para compara√ß√£o
      const currentUser = window.sessionManager ? window.sessionManager.getCurrentUser() : null;
      const currentUserId = currentUser ? currentUser.id : null;
      const currentUserName = currentUser ? currentUser.name : 'Usu√°rio Desconhecido';

      // Criar modal para visualizar
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'block';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
          <div class="modal-header">
            <h3 class="modal-title">${meditation.title}</h3>
            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
          </div>
          <div class="modal-body">
            <div class="meditation-details">
              <p><strong>T√≥pico:</strong> ${meditation.topic || 'N/A'}</p>
              <p><strong>Dura√ß√£o:</strong> ${meditation.duration || '15 min'}</p>
              <p><strong>Status:</strong> ${meditation.status || 'pending'}</p>
              <p><strong>Criada em:</strong> ${meditation.createdAt ? new Date(meditation.createdAt).toLocaleString('pt-BR') : 'N/A'}</p>
              <p><strong>Fonte:</strong> ${meditation.source || 'chatgpt'}</p>
              <p><strong>Tipo:</strong> ${meditation.type || 'simple'}</p>
              <p><strong>Usu√°rio:</strong> <span style="color: var(--accent-blue); font-weight: 600;">${meditation.userName || currentUserName}</span></p>
              <p><strong>ID do Usu√°rio:</strong> <code style="background: #23243a; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;">${meditation.userId || 'N/A'}</code></p>
              ${meditation.userId === currentUserId ? '<p style="color: var(--accent-green); font-weight: 600;">‚úÖ Esta √© sua medita√ß√£o</p>' : ''}
            </div>
            <div class="meditation-content">
              <h4>Conte√∫do da Medita√ß√£o:</h4>
              <div style="background: #23243a; padding: 16px; border-radius: 8px; margin: 16px 0; white-space: pre-wrap;">
                ${meditation.content || 'Conte√∫do n√£o dispon√≠vel'}
              </div>
            </div>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    // Deletar medita√ß√£o personalizada
    function deletePersonalizedMeditation(id) {
      const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
      const meditation = personalizedMeditations.find(m => m.id === id);
      
      if (!meditation) {
        showNotification('‚ùå Medita√ß√£o n√£o encontrada!', 'error');
        return;
      }

      // Obter usu√°rio atual
      const currentUser = window.sessionManager ? window.sessionManager.getCurrentUser() : null;
      const currentUserId = currentUser ? currentUser.id : null;

      // Verificar se o usu√°rio pode deletar esta medita√ß√£o
      if (meditation.userId && meditation.userId !== currentUserId) {
        showNotification('‚ùå Voc√™ s√≥ pode deletar suas pr√≥prias medita√ß√µes!', 'error');
        return;
      }

      if (!confirm('Tem certeza que deseja deletar esta medita√ß√£o personalizada?')) {
        return;
      }

      const updatedMeditations = personalizedMeditations.filter(m => m.id !== id);
      
      localStorage.setItem('personalized_meditations', JSON.stringify(updatedMeditations));
      loadPersonalizedMeditations();
      
      showNotification('‚úÖ Medita√ß√£o personalizada deletada com sucesso!', 'success');
    }

    // Exportar apenas medita√ß√µes personalizadas
    function exportPersonalizedData() {
      try {
        const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
        const personalizedHistory = JSON.parse(localStorage.getItem('personalized_meditations_history') || '[]');
        
        const data = {
          exportDate: new Date().toISOString(),
          version: '1.0',
          personalized_meditations: personalizedMeditations,
          personalized_meditations_history: personalizedHistory
        };

        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `oraetmedita_personalized_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showNotification('‚úÖ Medita√ß√µes personalizadas exportadas com sucesso!', 'success');
      } catch (error) {
        console.error('Erro ao exportar medita√ß√µes personalizadas:', error);
        showNotification('‚ùå Erro ao exportar medita√ß√µes personalizadas!', 'error');
      }
    }

    // Importar medita√ß√µes personalizadas
    function importPersonalizedData() {
      try {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.style.display = 'none';
        
        input.addEventListener('change', async (event) => {
          const file = event.target.files[0];
          if (!file) return;
          
          try {
            const text = await file.text();
            const data = JSON.parse(text);
            
            // Validar estrutura do arquivo
            if (!data.personalized_meditations) {
              throw new Error('Arquivo inv√°lido: n√£o cont√©m medita√ß√µes personalizadas');
            }
            
            if (!confirm(`Importar ${data.personalized_meditations.length} medita√ß√µes personalizadas? Esta a√ß√£o ir√° substituir os dados atuais.`)) {
              return;
            }
            
            // Importar dados
            localStorage.setItem('personalized_meditations', JSON.stringify(data.personalized_meditations));
            
            if (data.personalized_meditations_history) {
              localStorage.setItem('personalized_meditations_history', JSON.stringify(data.personalized_meditations_history));
            }
            
            // Recarregar dados
            loadPersonalizedMeditations();
            
            showNotification(`‚úÖ ${data.personalized_meditations.length} medita√ß√µes personalizadas importadas com sucesso!`, 'success');
            
          } catch (error) {
            console.error('Erro ao importar medita√ß√µes personalizadas:', error);
            showNotification('‚ùå Erro ao importar medita√ß√µes personalizadas: ' + error.message, 'error');
          }
          
          // Limpar input
          document.body.removeChild(input);
        });
        
        document.body.appendChild(input);
        input.click();
        
      } catch (error) {
        console.error('Erro ao preparar importa√ß√£o:', error);
        showNotification('‚ùå Erro ao preparar importa√ß√£o', 'error');
      }
    }

    // Limpar todas as medita√ß√µes personalizadas
    function clearPersonalizedData() {
      if (!confirm('Tem certeza que deseja limpar TODAS as medita√ß√µes personalizadas? Esta a√ß√£o n√£o pode ser desfeita!')) {
        return;
      }

      localStorage.removeItem('personalized_meditations');
      localStorage.removeItem('personalized_meditations_history');
      
      loadPersonalizedMeditations();
      
      showNotification('‚úÖ Todas as medita√ß√µes personalizadas foram removidas!', 'success');
    }

    // ===== FUN√á√ïES PARA AGENDAMENTOS =====

    // Carregar agendamentos
    function loadSchedulesData() {
      const schedules = JSON.parse(localStorage.getItem('user_schedules') || '[]');
      const grid = document.getElementById('schedules-grid');
      
      if (schedules.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìÖ</div>
            <h3>Nenhum agendamento encontrado</h3>
            <p>Os agendamentos criados pelos usu√°rios aparecer√£o aqui.</p>
          </div>
        `;
        return;
      }

      const html = schedules.map(schedule => `
        <div class="data-card">
          <div class="card-header">
            <h3>${schedule.title}</h3>
            <div class="card-actions">
              <button class="btn btn-sm btn-secondary" onclick="viewSchedule('${schedule.id}')">
                üëÅÔ∏è Ver
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteSchedule('${schedule.id}')">
                üóëÔ∏è
              </button>
            </div>
          </div>
          <div class="card-content">
            <p><strong>Data:</strong> ${schedule.date}</p>
            <p><strong>Hora:</strong> ${schedule.time}</p>
            <p><strong>Categoria:</strong> ${schedule.category}</p>
            <p><strong>Dura√ß√£o:</strong> ${schedule.duration} min</p>
            <p><strong>Status:</strong> ${schedule.status || 'agendado'}</p>
            <p><strong>Criado em:</strong> ${schedule.createdAt ? new Date(schedule.createdAt).toLocaleString('pt-BR') : 'N/A'}</p>
          </div>
        </div>
      `).join('');

      grid.innerHTML = html;
    }

    // Visualizar agendamento
    function viewSchedule(id) {
      const schedules = JSON.parse(localStorage.getItem('user_schedules') || '[]');
      const schedule = schedules.find(s => s.id === parseInt(id));
      
      if (!schedule) {
        showNotification('‚ùå Agendamento n√£o encontrado!', 'error');
        return;
      }

      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'block';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-header">
            <h3>Detalhes do Agendamento</h3>
            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
          </div>
          <div class="modal-body">
            <div style="background: #23243a; padding: 16px; border-radius: 8px;">
              <p><strong>T√≠tulo:</strong> ${schedule.title}</p>
              <p><strong>Data:</strong> ${schedule.date}</p>
              <p><strong>Hora:</strong> ${schedule.time}</p>
              <p><strong>Categoria:</strong> ${schedule.category}</p>
              <p><strong>Dura√ß√£o:</strong> ${schedule.duration} min</p>
              <p><strong>Status:</strong> ${schedule.status || 'agendado'}</p>
              <p><strong>Descri√ß√£o:</strong> ${schedule.description || 'N/A'}</p>
              <p><strong>Criado em:</strong> ${schedule.createdAt ? new Date(schedule.createdAt).toLocaleString('pt-BR') : 'N/A'}</p>
            </div>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    // Deletar agendamento
    function deleteSchedule(id) {
      if (!confirm('Tem certeza que deseja deletar este agendamento?')) {
        return;
      }

      const schedules = JSON.parse(localStorage.getItem('user_schedules') || '[]');
      const updatedSchedules = schedules.filter(s => s.id !== parseInt(id));
      
      localStorage.setItem('user_schedules', JSON.stringify(updatedSchedules));
      loadSchedulesData();
      
      showNotification('‚úÖ Agendamento deletado com sucesso!', 'success');
    }

    // Exportar apenas agendamentos
    function exportSchedulesData() {
      try {
        const schedules = JSON.parse(localStorage.getItem('user_schedules') || '[]');
        
        const data = {
          exportDate: new Date().toISOString(),
          version: '1.0',
          user_schedules: schedules
        };

        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `oraetmedita_schedules_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showNotification('‚úÖ Agendamentos exportados com sucesso!', 'success');
      } catch (error) {
        console.error('Erro ao exportar agendamentos:', error);
        showNotification('‚ùå Erro ao exportar agendamentos!', 'error');
      }
    }

    // Importar agendamentos
    function importSchedulesData() {
      try {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.style.display = 'none';
        
        input.addEventListener('change', async (event) => {
          const file = event.target.files[0];
          if (!file) return;
          
          try {
            const text = await file.text();
            const data = JSON.parse(text);
            
            // Validar estrutura do arquivo
            if (!data.user_schedules) {
              throw new Error('Arquivo inv√°lido: n√£o cont√©m agendamentos');
            }
            
            if (!confirm(`Importar ${data.user_schedules.length} agendamentos? Esta a√ß√£o ir√° substituir os dados atuais.`)) {
              return;
            }
            
            // Importar dados
            localStorage.setItem('user_schedules', JSON.stringify(data.user_schedules));
            
            // Recarregar dados
            loadSchedulesData();
            
            showNotification(`‚úÖ ${data.user_schedules.length} agendamentos importados com sucesso!`, 'success');
            
          } catch (error) {
            console.error('Erro ao importar agendamentos:', error);
            showNotification('‚ùå Erro ao importar agendamentos: ' + error.message, 'error');
          }
          
          // Limpar input
          document.body.removeChild(input);
        });
        
        document.body.appendChild(input);
        input.click();
        
      } catch (error) {
        console.error('Erro ao preparar importa√ß√£o:', error);
        showNotification('‚ùå Erro ao preparar importa√ß√£o', 'error');
      }
    }

    // Limpar todos os agendamentos
    function clearSchedulesData() {
      if (!confirm('Tem certeza que deseja limpar TODOS os agendamentos? Esta a√ß√£o n√£o pode ser desfeita!')) {
        return;
      }

      localStorage.removeItem('user_schedules');
      loadSchedulesData();
      
      showNotification('‚úÖ Todos os agendamentos foram removidos!', 'success');
    }

    // ===== FUN√á√ïES PARA ESTAT√çSTICAS =====

    // Carregar estat√≠sticas do dashboard
    function loadUsersData() {
      const grid = document.getElementById('users-grid');
      
      try {
        // Carregar dados do dashboard
        const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
        const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
        const currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
        
        // Calcular estat√≠sticas reais (personalizadas + admin)
        const personalizedCompleted = personalizedMeditations.filter(m => m.status === 'completed').length;
        const adminCompleted = adminMeditations.filter(m => m.status === 'completed').length;
        const totalCompleted = personalizedCompleted + adminCompleted;
        
        const personalizedInProgress = personalizedMeditations.filter(m => 
          m.status !== 'completed' && m.lastViewed
        ).length;
        const adminInProgress = adminMeditations.filter(m => 
          m.status !== 'completed' && m.lastViewed
        ).length;
        const totalInProgress = personalizedInProgress + adminInProgress;
        
        // Calcular tempo total (estimativa: 15 min por medita√ß√£o)
        const totalMinutes = totalCompleted * 15;
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        const timeText = hours > 0 ? `${hours}h ${minutes}min` : `${minutes}min`;
        
        // Calcular dias consecutivos (simplificado)
        const consecutiveDays = Math.min(totalCompleted, 30); // M√°ximo 30 dias
        
        let html = '';

        // Mostrar usu√°rio atual se existir
        if (currentUser) {
          html += `
            <div class="data-card">
              <div class="card-header">
                <h3>üë§ Usu√°rio Atual</h3>
              </div>
              <div class="card-content">
                <p><strong>Nome:</strong> ${currentUser.name || 'N/A'}</p>
                <p><strong>Email:</strong> ${currentUser.email || 'N/A'}</p>
                <p><strong>Plano:</strong> ${currentUser.plan || 'free'}</p>
                <p><strong>Registrado em:</strong> ${currentUser.createdAt ? new Date(currentUser.createdAt).toLocaleString('pt-BR') : 'N/A'}</p>
              </div>
            </div>
          `;
        }

        // Mostrar estat√≠sticas do dashboard
        html += `
          <div class="data-card">
            <div class="card-header">
              <h3>üìä Estat√≠sticas do Dashboard</h3>
            </div>
            <div class="card-content">
              <p><strong>Medita√ß√µes Conclu√≠das (Total):</strong> ${totalCompleted}</p>
              <p><strong>‚Ä¢ Personalizadas Conclu√≠das:</strong> ${personalizedCompleted}</p>
              <p><strong>‚Ä¢ Admin Conclu√≠das:</strong> ${adminCompleted}</p>
              <p><strong>Medita√ß√µes em Andamento (Total):</strong> ${totalInProgress}</p>
              <p><strong>‚Ä¢ Personalizadas em Andamento:</strong> ${personalizedInProgress}</p>
              <p><strong>‚Ä¢ Admin em Andamento:</strong> ${adminInProgress}</p>
              <p><strong>Tempo Total Estimado:</strong> ${timeText}</p>
              <p><strong>Dias Consecutivos:</strong> ${consecutiveDays}</p>
              <p><strong>√öltima Atualiza√ß√£o:</strong> ${new Date().toLocaleString('pt-BR')}</p>
            </div>
          </div>
        `;

        // Mostrar detalhes por categoria
        const categories = JSON.parse(localStorage.getItem('categories') || '[]');
        if (categories.length > 0) {
          html += `
            <div class="data-card">
              <div class="card-header">
                <h3>üìà Progresso por Categoria</h3>
              </div>
              <div class="card-content">
          `;
          
          categories.forEach(category => {
            const categoryMeditations = adminMeditations.filter(m => m.categoryId === category.id);
            const categoryCompleted = categoryMeditations.filter(m => m.status === 'completed').length;
            const categoryInProgress = categoryMeditations.filter(m => 
              m.status !== 'completed' && m.lastViewed
            ).length;
            const categoryTotal = categoryMeditations.length;
            
            html += `
              <p><strong>${category.name}:</strong> ${categoryCompleted} conclu√≠das, ${categoryInProgress} em andamento (${categoryTotal} total)</p>
            `;
          });
          
          html += `
              </div>
            </div>
          `;
        }

        grid.innerHTML = html;
        
        console.log('‚úÖ Estat√≠sticas do dashboard carregadas no painel admin:', {
          totalCompleted,
          totalInProgress,
          timeText,
          consecutiveDays
        });
        
      } catch (error) {
        console.error('‚ùå Erro ao carregar estat√≠sticas:', error);
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üìä</div>
            <h3>Erro ao carregar estat√≠sticas</h3>
            <p>N√£o foi poss√≠vel carregar as estat√≠sticas do dashboard.</p>
          </div>
        `;
      }
    }

    // Exportar estat√≠sticas do dashboard
    function exportUsersData() {
      try {
        const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
        const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
        const currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
        const categories = JSON.parse(localStorage.getItem('categories') || '[]');
        
        // Calcular estat√≠sticas
        const personalizedCompleted = personalizedMeditations.filter(m => m.status === 'completed').length;
        const adminCompleted = adminMeditations.filter(m => m.status === 'completed').length;
        const totalCompleted = personalizedCompleted + adminCompleted;
        
        const personalizedInProgress = personalizedMeditations.filter(m => 
          m.status !== 'completed' && m.lastViewed
        ).length;
        const adminInProgress = adminMeditations.filter(m => 
          m.status !== 'completed' && m.lastViewed
        ).length;
        const totalInProgress = personalizedInProgress + adminInProgress;
        
        const totalMinutes = totalCompleted * 15;
        const consecutiveDays = Math.min(totalCompleted, 30);
        
        const statsData = {
          exportDate: new Date().toISOString(),
          version: '1.0',
          dashboardStats: {
            totalCompleted,
            personalizedCompleted,
            adminCompleted,
            totalInProgress,
            personalizedInProgress,
            adminInProgress,
            totalMinutes,
            consecutiveDays,
            lastUpdated: new Date().toISOString()
          },
          current_user: currentUser,
          categories: categories,
          personalized_meditations: personalizedMeditations,
          admin_meditations: adminMeditations
        };

        const dataStr = JSON.stringify(statsData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `oraetmedita_stats_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showNotification('‚úÖ Estat√≠sticas do dashboard exportadas com sucesso!', 'success');
      } catch (error) {
        console.error('Erro ao exportar estat√≠sticas:', error);
        showNotification('‚ùå Erro ao exportar estat√≠sticas!', 'error');
      }
    }

    // Importar estat√≠sticas do dashboard
    function importUsersData() {
      try {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.style.display = 'none';
        
        input.addEventListener('change', async (event) => {
          const file = event.target.files[0];
          if (!file) return;
          
          try {
            const text = await file.text();
            const data = JSON.parse(text);
            
            // Validar estrutura do arquivo
            if (!data.dashboardStats) {
              throw new Error('Arquivo inv√°lido: n√£o cont√©m estat√≠sticas do dashboard');
            }
            
            if (!confirm('Importar estat√≠sticas do dashboard? Esta a√ß√£o ir√° substituir os dados atuais.')) {
              return;
            }
            
            // Importar dados
            if (data.personalized_meditations) {
              localStorage.setItem('personalized_meditations', JSON.stringify(data.personalized_meditations));
            }
            
            if (data.admin_meditations) {
              localStorage.setItem('meditations', JSON.stringify(data.admin_meditations));
            }
            
            if (data.categories) {
              localStorage.setItem('categories', JSON.stringify(data.categories));
            }
            
            if (data.current_user) {
              localStorage.setItem('current_user', JSON.stringify(data.current_user));
            }
            
            // Recarregar dados
            loadUsersData();
            
            showNotification('‚úÖ Estat√≠sticas do dashboard importadas com sucesso!', 'success');
            
          } catch (error) {
            console.error('Erro ao importar estat√≠sticas:', error);
            showNotification('‚ùå Erro ao importar estat√≠sticas: ' + error.message, 'error');
          }
          
          // Limpar input
          document.body.removeChild(input);
        });
        
        document.body.appendChild(input);
        input.click();
        
      } catch (error) {
        console.error('Erro ao preparar importa√ß√£o:', error);
        showNotification('‚ùå Erro ao preparar importa√ß√£o', 'error');
      }
    }

    // Atualizar estat√≠sticas
    function refreshStats() {
      loadUsersData();
      showNotification('‚úÖ Estat√≠sticas atualizadas!', 'success');
    }

    // ===== FUN√á√ïES PARA GERENCIAMENTO DE USU√ÅRIOS =====

    // Fun√ß√£o para gerenciar usu√°rios (mesma do index.html)
    async function manageUsers(newUserData) {
      console.log('üîÑ Fun√ß√£o manageUsers chamada com:', newUserData);
      
      // Carregar usu√°rios existentes
      let existingUsers = [];
      try {
        const usersData = localStorage.getItem('users');
        if (usersData) {
          existingUsers = JSON.parse(usersData);
          console.log('üìã Usu√°rios carregados do localStorage:', existingUsers.length);
        }
      } catch (error) {
        console.error('‚ùå Erro ao carregar usu√°rios:', error);
        existingUsers = [];
      }
      
      // Verificar se o email j√° existe (case-insensitive)
      const emailExists = existingUsers.some(user => 
        user.email.toLowerCase() === newUserData.email.toLowerCase()
      );
      
      if (emailExists) {
        console.log('‚ùå Email j√° existe:', newUserData.email);
        return { 
          success: false, 
          error: 'Este email j√° est√° cadastrado! Use um email diferente.',
          emailExists: true 
        };
      }
      
      // SEMPRE criar um novo usu√°rio com ID √∫nico
      const timestamp = Date.now();
      const randomId = Math.random().toString(36).substr(2, 9);
      const uniqueId = `user_${timestamp}_${randomId}`;
      
      const newUser = {
        ...newUserData,
        id: uniqueId,
        createdAt: new Date().toISOString(),
        lastActivity: new Date().toISOString(),
        userNumber: existingUsers.length + 1 // N√∫mero sequencial do usu√°rio
      };
      
      console.log('üÜî Criando novo usu√°rio com ID:', uniqueId);
      console.log('üìä N√∫mero do usu√°rio:', newUser.userNumber);
      
      // Adicionar √† lista de usu√°rios
      existingUsers.push(newUser);
      
      // Salvar array atualizado
      try {
        localStorage.setItem('users', JSON.stringify(existingUsers));
        console.log('‚úÖ Novo usu√°rio adicionado com sucesso. Total:', existingUsers.length);
        
        // Sincronizar com Supabase se dispon√≠vel
        if (window.supabaseManager) {
          try {
            console.log('üîÑ Sincronizando com Supabase...');
            const supabaseUser = {
              email: newUser.email,
              name: newUser.name,
              password_hash: 'admin-created', // Hash tempor√°rio
              is_active: true
            };
            
            const createdUser = await window.supabaseManager.createUser(supabaseUser);
            console.log('‚úÖ Usu√°rio criado no Supabase:', createdUser);
            
            // Atualizar o ID local com o ID do Supabase
            if (createdUser && createdUser[0]) {
              newUser.id = createdUser[0].id;
              localStorage.setItem('users', JSON.stringify(existingUsers));
              console.log('üîÑ ID atualizado com ID do Supabase:', newUser.id);
            }
          } catch (supabaseError) {
            console.error('‚ö†Ô∏è Erro ao sincronizar com Supabase:', supabaseError);
            console.log('‚ÑπÔ∏è Usu√°rio salvo apenas localmente');
          }
        } else {
          console.log('‚ÑπÔ∏è Supabase Manager n√£o dispon√≠vel - usu√°rio salvo apenas localmente');
        }
        
        // Verificar se foi salvo corretamente
        const savedUsers = JSON.parse(localStorage.getItem('users') || '[]');
        console.log('üîç Verifica√ß√£o: usu√°rios salvos:', savedUsers.length);
        
        return { success: true, userId: uniqueId, totalUsers: existingUsers.length };
      } catch (error) {
        console.error('‚ùå Erro ao salvar usu√°rios:', error);
        return { success: false, error: error.message };
      }
    }

    // Migrar dados antigos de usu√°rios para o novo formato
    function migrateOldUserData() {
      try {
        console.log('üîÑ Iniciando migra√ß√£o de dados antigos...');
        
        const userData = JSON.parse(localStorage.getItem('userData') || 'null');
        const currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
        let allUsers = JSON.parse(localStorage.getItem('users') || '[]');
        
        console.log('üìã Dados encontrados:', {
          userData: userData ? 'Presente' : 'Ausente',
          currentUser: currentUser ? 'Presente' : 'Ausente',
          allUsersCount: allUsers.length
        });
        
        // Sempre verificar se h√° dados antigos que n√£o est√£o no array
        const migratedUsers = [...allUsers]; // Copiar usu√°rios existentes
        
        // Adicionar userData se n√£o estiver no array
        if (userData && !migratedUsers.some(u => u.email === userData.email)) {
          console.log('‚ûï Migrando userData:', userData.email);
          migratedUsers.push({
            id: 'user_' + Date.now(),
            name: userData.name || 'Usu√°rio',
            email: userData.email || 'N/A',
            planType: userData.planType || 'trial',
            registrationDate: userData.registrationDate,
            trialExpiry: userData.trialExpiry,
            lastActivity: new Date().toISOString()
          });
        }
        
        // Adicionar currentUser se n√£o estiver no array
        if (currentUser && !migratedUsers.some(u => u.email === currentUser.email)) {
          console.log('‚ûï Migrando currentUser:', currentUser.email);
          migratedUsers.push({
            id: 'user_' + (Date.now() + 1),
            name: currentUser.name || 'Usu√°rio Atual',
            email: currentUser.email || 'N/A',
            planType: currentUser.plan || 'free',
            registrationDate: currentUser.createdAt,
            lastActivity: new Date().toISOString()
          });
        }
        
        // Salvar apenas se houve mudan√ßas
        if (migratedUsers.length !== allUsers.length) {
          localStorage.setItem('users', JSON.stringify(migratedUsers));
          console.log('‚úÖ Dados de usu√°rios migrados:', migratedUsers.length, 'usu√°rios');
          return true;
        } else {
          console.log('‚ÑπÔ∏è Nenhuma migra√ß√£o necess√°ria');
          return false;
        }
      } catch (error) {
        console.error('‚ùå Erro ao migrar dados de usu√°rios:', error);
        return false;
      }
    }

    // Carregar dados de gerenciamento de usu√°rios
    function loadUsersManagementData() {
      const grid = document.getElementById('users-management-grid');
      
      try {
        console.log('üîÑ Carregando dados de gerenciamento de usu√°rios...');
        
        // Migrar dados antigos para o novo formato se necess√°rio
        const migrationResult = migrateOldUserData();
        if (migrationResult) {
          console.log('‚úÖ Migra√ß√£o realizada com sucesso');
        }
        
        // Coletar todos os dados de usu√°rios do sistema
        const allUsers = JSON.parse(localStorage.getItem('users') || '[]');
        const userData = JSON.parse(localStorage.getItem('userData') || 'null');
        const currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
        const userStats = JSON.parse(localStorage.getItem('user_meditation_stats') || '{}');
        const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
        const userSchedules = JSON.parse(localStorage.getItem('user_schedules') || '[]');
        
        console.log('üìä Dados coletados:', {
          allUsersCount: allUsers.length,
          userData: userData ? 'Presente' : 'Ausente',
          currentUser: currentUser ? 'Presente' : 'Ausente',
          personalizedMeditationsCount: personalizedMeditations.length,
          userSchedulesCount: userSchedules.length
        });
        
        // Criar lista de usu√°rios
        const users = [];
        
        // Adicionar todos os usu√°rios do array 'users'
        allUsers.forEach((user, index) => {
          console.log(`üë§ Processando usu√°rio ${index + 1}:`, user.email);
          users.push({
            id: user.id || 'user_' + Date.now(),
            name: user.name || 'Usu√°rio',
            email: user.email || 'N/A',
            planType: user.planType || 'trial',
            registrationDate: user.registrationDate,
            trialExpiry: user.trialExpiry,
            source: 'users_array',
            lastActivity: user.lastActivity || new Date().toISOString()
          });
        });
        
        // Adicionar usu√°rio do userData se n√£o estiver no array (compatibilidade)
        if (userData && !users.some(u => u.email === userData.email)) {
          console.log('‚ûï Adicionando userData:', userData.email);
          users.push({
            id: 'user_data',
            name: userData.name || 'Usu√°rio',
            email: userData.email || 'N/A',
            planType: userData.planType || 'trial',
            registrationDate: userData.registrationDate,
            trialExpiry: userData.trialExpiry,
            source: 'userData',
            lastActivity: new Date().toISOString()
          });
        }
        
        // Adicionar usu√°rio do current_user se n√£o estiver no array (compatibilidade)
        if (currentUser && !users.some(u => u.email === currentUser.email)) {
          console.log('‚ûï Adicionando currentUser:', currentUser.email);
          users.push({
            id: 'current_user',
            name: currentUser.name || 'Usu√°rio Atual',
            email: currentUser.email || 'N/A',
            planType: currentUser.plan || 'free',
            registrationDate: currentUser.createdAt,
            source: 'current_user',
            lastActivity: new Date().toISOString()
          });
        }
        
        console.log(`üìã Total de usu√°rios processados: ${users.length}`);
        
        if (users.length === 0) {
          grid.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üë•</div>
              <h3>Nenhum usu√°rio encontrado</h3>
              <p>Os usu√°rios registrados aparecer√£o aqui quando houver dados.</p>
            </div>
          `;
          return;
        }

        let html = '';

        users.forEach((user, index) => {
          // Calcular estat√≠sticas do usu√°rio
          const userPersonalizedMeditations = personalizedMeditations.filter(m => 
            m.userEmail === user.email || m.userId === user.id
          );
          const completedMeditations = userPersonalizedMeditations.filter(m => m.status === 'completed').length;
          const inProgressMeditations = userPersonalizedMeditations.filter(m => 
            m.status !== 'completed' && m.lastViewed
          ).length;
          
          // Obter estat√≠sticas do admin se dispon√≠veis
          const adminUser = allUsers.find(u => u.id === user.id);
          const userStats = adminUser?.stats || {
            consecutiveDays: 0,
            completedMeditations: completedMeditations,
            totalTime: '0h 0min',
            totalMeditations: userPersonalizedMeditations.length,
            inProgressMeditations: inProgressMeditations
          };
          const userSchedulesCount = userSchedules.length;
          
          // Verificar status do plano
          const isTrialExpired = user.trialExpiry && new Date(user.trialExpiry) < new Date();
          const planStatus = isTrialExpired ? 'Expirado' : 
                           user.planType === 'premium' ? 'Premium' : 
                           user.planType === 'trial' ? 'Trial' : 'Free';
          
          html += `
            <div class="data-card">
              <div class="card-header">
                <h3>üë§ ${user.name} <span style="font-size: 0.8em; color: #7ee787;">#${user.userNumber || (index + 1)}</span></h3>
                <div class="card-actions">
                  <button class="btn btn-sm btn-secondary" onclick="viewUserDetails('${user.id}')">
                    üëÅÔ∏è Ver Detalhes
                  </button>
                  <button class="btn btn-sm btn-warning" onclick="editUserStats('${user.id}')">
                    üìä Estat√≠sticas
                  </button>
                  <button class="btn btn-sm btn-primary" onclick="editUser('${user.id}')">
                    ‚úèÔ∏è Editar
                  </button>
                  <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')">
                    üóëÔ∏è
                  </button>
                </div>
              </div>
              <div class="card-content">
                <p><strong>ID √önico:</strong> <code style="background: #1a1b2e; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;">${user.id}</code></p>
                <p><strong>Email:</strong> ${user.email}</p>
                <p><strong>Plano:</strong> <span class="badge ${planStatus === 'Premium' ? 'badge-success' : planStatus === 'Trial' ? 'badge-warning' : 'badge-secondary'}">${planStatus}</span></p>
                <p><strong>Data de Registro:</strong> ${user.registrationDate ? new Date(user.registrationDate).toLocaleString('pt-BR') : 'N/A'}</p>
                ${user.trialExpiry ? `<p><strong>Expira√ß√£o Trial:</strong> ${new Date(user.trialExpiry).toLocaleString('pt-BR')}</p>` : ''}
                <p><strong>Medita√ß√µes Conclu√≠das:</strong> ${completedMeditations}</p>
                <p><strong>Medita√ß√µes em Andamento:</strong> ${inProgressMeditations}</p>
                <p><strong>Agendamentos:</strong> ${userSchedulesCount}</p>
                <p><strong>Fonte de Dados:</strong> ${user.source}</p>
                <p><strong>√öltima Atividade:</strong> ${new Date(user.lastActivity).toLocaleString('pt-BR')}</p>
              </div>
            </div>
          `;
        });

        grid.innerHTML = html;
        
        console.log('‚úÖ Dados de gerenciamento de usu√°rios carregados:', users.length, 'usu√°rios');
        
      } catch (error) {
        console.error('‚ùå Erro ao carregar dados de usu√°rios:', error);
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üë•</div>
            <h3>Erro ao carregar usu√°rios</h3>
            <p>N√£o foi poss√≠vel carregar os dados dos usu√°rios.</p>
          </div>
        `;
      }
    }

    // Visualizar detalhes do usu√°rio
    function viewUserDetails(userId) {
      const userData = JSON.parse(localStorage.getItem('userData') || 'null');
      const currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
      const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
      const userSchedules = JSON.parse(localStorage.getItem('user_schedules') || '[]');
      
      let user = null;
      if (userId === 'user_data' && userData) {
        user = userData;
      } else if (userId === 'current_user' && currentUser) {
        user = currentUser;
      }
      
      if (!user) {
        showNotification('‚ùå Usu√°rio n√£o encontrado!', 'error');
        return;
      }

      // Filtrar dados espec√≠ficos do usu√°rio
      const userPersonalizedMeditations = personalizedMeditations.filter(m => 
        m.userEmail === user.email || m.userId === userId
      );
      const userSchedulesFiltered = userSchedules.filter(s => 
        s.userId === userId || s.userEmail === user.email
      );

      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'block';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
          <div class="modal-header">
            <h3>Detalhes do Usu√°rio: ${user.name || user.email}</h3>
            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
          </div>
          <div class="modal-body">
            <div style="background: #23243a; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
              <h4>üìã Informa√ß√µes B√°sicas</h4>
              <p><strong>Nome:</strong> ${user.name || 'N/A'}</p>
              <p><strong>Email:</strong> ${user.email || 'N/A'}</p>
              <p><strong>Plano:</strong> ${user.planType || user.plan || 'N/A'}</p>
              <p><strong>Data de Registro:</strong> ${user.registrationDate || user.createdAt ? new Date(user.registrationDate || user.createdAt).toLocaleString('pt-BR') : 'N/A'}</p>
              ${user.trialExpiry ? `<p><strong>Expira√ß√£o Trial:</strong> ${new Date(user.trialExpiry).toLocaleString('pt-BR')}</p>` : ''}
            </div>
            
            <div style="background: #23243a; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
              <h4>üìä Estat√≠sticas</h4>
              <p><strong>Medita√ß√µes Personalizadas:</strong> ${userPersonalizedMeditations.length}</p>
              <p><strong>Medita√ß√µes Conclu√≠das:</strong> ${userPersonalizedMeditations.filter(m => m.status === 'completed').length}</p>
              <p><strong>Medita√ß√µes em Andamento:</strong> ${userPersonalizedMeditations.filter(m => m.status !== 'completed' && m.lastViewed).length}</p>
              <p><strong>Agendamentos:</strong> ${userSchedulesFiltered.length}</p>
            </div>
            
            ${userPersonalizedMeditations.length > 0 ? `
            <div style="background: #23243a; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
              <h4>üìñ Medita√ß√µes Personalizadas</h4>
              ${userPersonalizedMeditations.map(meditation => `
                <div style="border-bottom: 1px solid #3a3b5a; padding: 8px 0;">
                  <p><strong>${meditation.title}</strong></p>
                  <p style="font-size: 0.9rem; color: #a3a8c9;">Status: ${meditation.status || 'pending'}</p>
                  ${meditation.lastViewed ? `<p style="font-size: 0.8rem; color: #7ee787;">Vista em: ${new Date(meditation.lastViewed).toLocaleString('pt-BR')}</p>` : ''}
                </div>
              `).join('')}
            </div>
            ` : ''}
            
            ${userSchedulesFiltered.length > 0 ? `
            <div style="background: #23243a; padding: 16px; border-radius: 8px;">
              <h4>üìÖ Agendamentos</h4>
              ${userSchedulesFiltered.map(schedule => `
                <div style="border-bottom: 1px solid #3a3b5a; padding: 8px 0;">
                  <p><strong>${schedule.title || 'Agendamento'}</strong></p>
                  <p style="font-size: 0.9rem; color: #a3a8c9;">${schedule.time} - ${schedule.category}</p>
                </div>
              `).join('')}
            </div>
            ` : ''}
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    // Editar usu√°rio
    function editUser(userId) {
      const userData = JSON.parse(localStorage.getItem('userData') || 'null');
      const currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
      
      let user = null;
      if (userId === 'user_data' && userData) {
        user = userData;
      } else if (userId === 'current_user' && currentUser) {
        user = currentUser;
      }
      
      if (!user) {
        showNotification('‚ùå Usu√°rio n√£o encontrado!', 'error');
        return;
      }

      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'block';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-header">
            <h3>Editar Usu√°rio: ${user.name || user.email}</h3>
            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
          </div>
          <div class="modal-body">
            <form id="editUserForm">
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: #f5f6fa;">Nome:</label>
                <input type="text" id="editUserName" value="${user.name || ''}" style="width: 100%; padding: 12px; border: 1px solid #3a3b5a; border-radius: 8px; background: #23243a; color: #f5f6fa;">
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: #f5f6fa;">Email:</label>
                <input type="email" id="editUserEmail" value="${user.email || ''}" style="width: 100%; padding: 12px; border: 1px solid #3a3b5a; border-radius: 8px; background: #23243a; color: #f5f6fa;">
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: #f5f6fa;">Plano:</label>
                <select id="editUserPlan" style="width: 100%; padding: 12px; border: 1px solid #3a3b5a; border-radius: 8px; background: #23243a; color: #f5f6fa;">
                  <option value="trial" ${(user.planType || user.plan) === 'trial' ? 'selected' : ''}>Trial</option>
                  <option value="premium" ${(user.planType || user.plan) === 'premium' ? 'selected' : ''}>Premium</option>
                  <option value="free" ${(user.planType || user.plan) === 'free' ? 'selected' : ''}>Free</option>
                </select>
              </div>
              <div style="display: flex; gap: 12px;">
                <button type="button" onclick="saveUserEdit('${userId}')" class="btn btn-primary" style="flex: 1;">Salvar</button>
                <button type="button" onclick="this.closest('.modal').remove()" class="btn btn-secondary" style="flex: 1;">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    // Salvar edi√ß√£o do usu√°rio
    function saveUserEdit(userId) {
      const name = document.getElementById('editUserName').value;
      const email = document.getElementById('editUserEmail').value;
      const plan = document.getElementById('editUserPlan').value;
      
      if (!name || !email) {
        showNotification('‚ùå Nome e email s√£o obrigat√≥rios!', 'error');
        return;
      }
      
      try {
        if (userId === 'user_data') {
          const userData = JSON.parse(localStorage.getItem('userData') || '{}');
          userData.name = name;
          userData.email = email;
          userData.planType = plan;
          localStorage.setItem('userData', JSON.stringify(userData));
        } else if (userId === 'current_user') {
          const currentUser = JSON.parse(localStorage.getItem('current_user') || '{}');
          currentUser.name = name;
          currentUser.email = email;
          currentUser.plan = plan;
          localStorage.setItem('current_user', JSON.stringify(currentUser));
        }
        
        document.querySelector('.modal').remove();
        loadUsersManagementData();
        showNotification('‚úÖ Usu√°rio atualizado com sucesso!', 'success');
      } catch (error) {
        console.error('Erro ao salvar usu√°rio:', error);
        showNotification('‚ùå Erro ao salvar usu√°rio!', 'error');
      }
    }

    // Fun√ß√£o para editar estat√≠sticas do usu√°rio
    function editUserStats(userId) {
        try {
            console.log('üîÑ Editando estat√≠sticas do usu√°rio:', userId);
            
            // Carregar dados dos usu√°rios
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === userId);
            
            if (!user) {
                console.error('‚ùå Usu√°rio n√£o encontrado:', userId);
                return;
            }
            
            console.log('üìä Dados do usu√°rio:', user);
            
            // Preencher formul√°rio com dados atuais
            document.getElementById('user-name').value = user.name || '';
            document.getElementById('user-email').value = user.email || '';
            document.getElementById('user-consecutive-days').value = user.stats?.consecutiveDays || 0;
            document.getElementById('user-completed-meditations').value = user.stats?.completedMeditations || 0;
            document.getElementById('user-total-time').value = user.stats?.totalTime || '0h 0min';
            document.getElementById('user-total-meditations').value = user.stats?.totalMeditations || 0;
            document.getElementById('user-in-progress').value = user.stats?.inProgressMeditations || 0;
            document.getElementById('user-last-login').value = user.lastLogin ? new Date(user.lastLogin).toLocaleString('pt-BR') : 'Nunca';
            
            // Armazenar ID do usu√°rio para salvar
            window.currentEditingUserId = userId;
            
            // Abrir modal
            openModal('user-stats');
            
        } catch (error) {
            console.error('‚ùå Erro ao editar estat√≠sticas do usu√°rio:', error);
        }
    }

    // Fun√ß√£o para salvar estat√≠sticas do usu√°rio
    function saveUserStats(event) {
        event.preventDefault();
        
        try {
            const userId = window.currentEditingUserId;
            if (!userId) {
                console.error('‚ùå ID do usu√°rio n√£o encontrado');
                return;
            }
            
            console.log('üíæ Salvando estat√≠sticas do usu√°rio:', userId);
            
            // Obter dados do formul√°rio
            const formData = new FormData(event.target);
            const stats = {
                consecutiveDays: parseInt(formData.get('consecutiveDays')) || 0,
                completedMeditations: parseInt(formData.get('completedMeditations')) || 0,
                totalTime: formData.get('totalTime') || '0h 0min',
                totalMeditations: parseInt(formData.get('totalMeditations')) || 0,
                inProgressMeditations: parseInt(formData.get('inProgressMeditations')) || 0
            };
            
            console.log('üìä Novas estat√≠sticas:', stats);
            
            // Atualizar usu√°rio no localStorage
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                users[userIndex].stats = stats;
                users[userIndex].lastUpdated = new Date().toISOString();
                
                localStorage.setItem('users', JSON.stringify(users));
                
                console.log('‚úÖ Estat√≠sticas salvas com sucesso');
                showNotification('Estat√≠sticas do usu√°rio atualizadas com sucesso!', 'success');
                
                // Fechar modal e recarregar lista
                closeModal('user-stats');
                loadUsersManagementData();
                
            } else {
                console.error('‚ùå Usu√°rio n√£o encontrado para atualiza√ß√£o');
                showNotification('Erro: Usu√°rio n√£o encontrado', 'error');
            }
            
        } catch (error) {
            console.error('‚ùå Erro ao salvar estat√≠sticas:', error);
            showNotification('Erro ao salvar estat√≠sticas', 'error');
        }
    }

    // Deletar usu√°rio
    function deleteUser(userId) {
      if (!confirm('Tem certeza que deseja deletar este usu√°rio? Esta a√ß√£o n√£o pode ser desfeita!')) {
        return;
      }
      
      try {
        console.log('üóëÔ∏è Tentando deletar usu√°rio com ID:', userId);
        
        // Carregar array de usu√°rios
        let users = JSON.parse(localStorage.getItem('users') || '[]');
        console.log('üìã Usu√°rios antes da exclus√£o:', users.length);
        
        // Encontrar e remover o usu√°rio do array
        const userIndex = users.findIndex(user => user.id === userId);
        
        if (userIndex !== -1) {
          const deletedUser = users[userIndex];
          console.log('üë§ Usu√°rio encontrado:', deletedUser.name, deletedUser.email);
          
          // Remover do array
          users.splice(userIndex, 1);
          
          // Salvar array atualizado
          localStorage.setItem('users', JSON.stringify(users));
          console.log('‚úÖ Usu√°rio removido do array. Total restante:', users.length);
          
          // Atualizar n√∫meros sequenciais dos usu√°rios restantes
          users.forEach((user, index) => {
            user.userNumber = index + 1;
          });
          
          // Salvar novamente com n√∫meros atualizados
          localStorage.setItem('users', JSON.stringify(users));
          console.log('üîÑ N√∫meros sequenciais atualizados');
          
          showNotification(`‚úÖ Usu√°rio "${deletedUser.name}" deletado com sucesso!`, 'success');
        } else {
          console.log('‚ùå Usu√°rio n√£o encontrado no array');
          
          // Fallback para dados antigos
          if (userId === 'user_data') {
            localStorage.removeItem('userData');
            console.log('üóëÔ∏è userData removido');
          } else if (userId === 'current_user') {
            localStorage.removeItem('current_user');
            console.log('üóëÔ∏è current_user removido');
          }
          
          showNotification('‚úÖ Usu√°rio deletado com sucesso!', 'success');
        }
        
        // Recarregar dados
        loadUsersManagementData();
        
      } catch (error) {
        console.error('‚ùå Erro ao deletar usu√°rio:', error);
        showNotification('‚ùå Erro ao deletar usu√°rio!', 'error');
      }
    }

    // Adicionar novo usu√°rio
    function showAddUserModal() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'block';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-header">
            <h3>Adicionar Novo Usu√°rio</h3>
            <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
          </div>
          <div class="modal-body">
            <form id="addUserForm">
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: #f5f6fa;">Nome:</label>
                <input type="text" id="newUserName" required style="width: 100%; padding: 12px; border: 1px solid #3a3b5a; border-radius: 8px; background: #23243a; color: #f5f6fa;">
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: #f5f6fa;">Email:</label>
                <input type="email" id="newUserEmail" required style="width: 100%; padding: 12px; border: 1px solid #3a3b5a; border-radius: 8px; background: #23243a; color: #f5f6fa;">
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; margin-bottom: 8px; color: #f5f6fa;">Plano:</label>
                <select id="newUserPlan" style="width: 100%; padding: 12px; border: 1px solid #3a3b5a; border-radius: 8px; background: #23243a; color: #f5f6fa;">
                  <option value="trial">Trial</option>
                  <option value="premium">Premium</option>
                  <option value="free">Free</option>
                </select>
              </div>
              <div style="display: flex; gap: 12px;">
                <button type="button" onclick="saveNewUser()" class="btn btn-primary" style="flex: 1;">Adicionar</button>
                <button type="button" onclick="this.closest('.modal').remove()" class="btn btn-secondary" style="flex: 1;">Cancelar</button>
              </div>
            </form>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    // Salvar novo usu√°rio
    function saveNewUser() {
      const name = document.getElementById('newUserName').value;
      const email = document.getElementById('newUserEmail').value;
      const plan = document.getElementById('newUserPlan').value;
      
      if (!name || !email) {
        showNotification('‚ùå Nome e email s√£o obrigat√≥rios!', 'error');
        return;
      }
      
      // Verificar se o email j√° existe
      try {
        const existingUsers = JSON.parse(localStorage.getItem('users') || '[]');
        const emailExists = existingUsers.some(user => user.email.toLowerCase() === email.toLowerCase());
        
        if (emailExists) {
          showNotification('‚ùå Este email j√° est√° cadastrado! Use um email diferente.', 'error');
          return;
        }
        
        console.log('‚ûï Adicionando novo usu√°rio via painel admin:', name, email);
        
        const newUserData = {
          name: name,
          email: email,
          planType: plan,
          registrationDate: new Date().toISOString(),
          trialExpiry: plan === 'trial' ? new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString() : null,
          lastActivity: new Date().toISOString()
        };
        
        // Usar a fun√ß√£o centralizada para gerenciar usu√°rios
        const result = manageUsers(newUserData);
        
        if (result.success) {
          console.log('‚úÖ Usu√°rio adicionado via painel admin:', result.userId);
          document.querySelector('.modal').remove();
          loadUsersManagementData();
          showNotification(`‚úÖ Usu√°rio "${name}" adicionado com sucesso!`, 'success');
        } else {
          console.error('‚ùå Erro ao adicionar usu√°rio via painel admin:', result.error);
          showNotification('‚ùå Erro ao adicionar usu√°rio!', 'error');
        }
      } catch (error) {
        console.error('‚ùå Erro ao adicionar usu√°rio:', error);
        showNotification('‚ùå Erro ao adicionar usu√°rio!', 'error');
      }
    }

    // Exportar dados de gerenciamento de usu√°rios
    function exportUsersManagementData() {
      try {
        const userData = JSON.parse(localStorage.getItem('userData') || 'null');
        const currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
        const personalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
        const userSchedules = JSON.parse(localStorage.getItem('user_schedules') || '[]');
        
        const usersData = {
          exportDate: new Date().toISOString(),
          version: '1.0',
          users: {
            userData: userData,
            currentUser: currentUser
          },
          userActivities: {
            personalizedMeditations: personalizedMeditations,
            userSchedules: userSchedules
          }
        };

        const dataStr = JSON.stringify(usersData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `oraetmedita_users_management_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showNotification('‚úÖ Dados de gerenciamento de usu√°rios exportados com sucesso!', 'success');
      } catch (error) {
        console.error('Erro ao exportar dados de usu√°rios:', error);
        showNotification('‚ùå Erro ao exportar dados de usu√°rios!', 'error');
      }
    }

    // Importar dados de gerenciamento de usu√°rios
    function importUsersManagementData() {
      try {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.style.display = 'none';
        
        input.addEventListener('change', async (event) => {
          const file = event.target.files[0];
          if (!file) return;
          
          try {
            const text = await file.text();
            const data = JSON.parse(text);
            
            // Validar estrutura do arquivo
            if (!data.users) {
              throw new Error('Arquivo inv√°lido: n√£o cont√©m dados de usu√°rios');
            }
            
            if (!confirm('Importar dados de gerenciamento de usu√°rios? Esta a√ß√£o ir√° substituir os dados atuais.')) {
              return;
            }
            
            // Importar dados
            if (data.users.userData) {
              localStorage.setItem('userData', JSON.stringify(data.users.userData));
            }
            
            if (data.users.currentUser) {
              localStorage.setItem('current_user', JSON.stringify(data.users.currentUser));
            }
            
            if (data.userActivities) {
              if (data.userActivities.personalizedMeditations) {
                localStorage.setItem('personalized_meditations', JSON.stringify(data.userActivities.personalizedMeditations));
              }
              
              if (data.userActivities.userSchedules) {
                localStorage.setItem('user_schedules', JSON.stringify(data.userActivities.userSchedules));
              }
            }
            
            // Recarregar dados
            loadUsersManagementData();
            
            showNotification('‚úÖ Dados de gerenciamento de usu√°rios importados com sucesso!', 'success');
            
          } catch (error) {
            console.error('Erro ao importar dados de usu√°rios:', error);
            showNotification('‚ùå Erro ao importar dados de usu√°rios: ' + error.message, 'error');
          }
          
          // Limpar input
          document.body.removeChild(input);
        });
        
        document.body.appendChild(input);
        input.click();
        
      } catch (error) {
        console.error('Erro ao preparar importa√ß√£o:', error);
        showNotification('‚ùå Erro ao preparar importa√ß√£o', 'error');
      }
    }

    // Atualizar lista de usu√°rios
    function refreshUsersList() {
      loadUsersManagementData();
      showNotification('‚úÖ Lista de usu√°rios atualizada!', 'success');
    }

    // ... existing code ...

    // Fun√ß√£o para exportar dados completos para JSON unificado
    function exportCompleteData() {
        try {
            console.log('üì§ Iniciando exporta√ß√£o completa...');
            
            // Coletar todos os dados
            const completeData = {
                metadata: {
                    version: "1.0",
                    createdAt: new Date().toISOString(),
                    description: "Backup completo do sistema Ora et Medita - Inclui medita√ß√µes padr√£o, categorias, usu√°rios, medita√ß√µes personalizadas, agendamentos e estat√≠sticas",
                    totalUsers: 0,
                    totalPersonalizedMeditations: 0,
                    totalSchedules: 0
                },
                meditations: JSON.parse(localStorage.getItem('meditations') || '[]'),
                categories: JSON.parse(localStorage.getItem('categories') || '[]'),
                users: JSON.parse(localStorage.getItem('users') || '[]'),
                personalizedMeditations: JSON.parse(localStorage.getItem('personalized_meditations') || '[]'),
                schedules: JSON.parse(localStorage.getItem('user_schedules') || '[]'),
                userMeditationStats: JSON.parse(localStorage.getItem('user_meditation_stats') || '{}'),
                personalizedMeditationsHistory: JSON.parse(localStorage.getItem('personalized_meditations_history') || '[]'),
                userSchedules: JSON.parse(localStorage.getItem('user_schedules') || '[]'),
                activeSessions: JSON.parse(localStorage.getItem('active_sessions') || '[]'),
                systemSettings: {
                    version: "1.0",
                    lastBackup: new Date().toISOString(),
                    autoBackup: true,
                    backupInterval: "daily",
                    maxUsers: 1000,
                    maxPersonalizedMeditations: 100,
                    maxSchedules: 50
                }
            };
            
            // Atualizar metadados
            completeData.metadata.totalUsers = completeData.users.length;
            completeData.metadata.totalPersonalizedMeditations = completeData.personalizedMeditations.length;
            completeData.metadata.totalSchedules = completeData.schedules.length;
            
            // Criar nome do arquivo com timestamp
            const timestamp = new Date().toISOString().split('T')[0].replace(/-/g, '-');
            const filename = `oraetmedita_backup_completo_${timestamp}.json`;
            
            // Converter para JSON e fazer download
            const jsonString = JSON.stringify(completeData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('‚úÖ Exporta√ß√£o completa realizada:', filename);
            showNotification('Exporta√ß√£o completa realizada com sucesso!', 'success');
            
        } catch (error) {
            console.error('‚ùå Erro na exporta√ß√£o completa:', error);
            showNotification('Erro na exporta√ß√£o completa', 'error');
        }
    }

    // Fun√ß√£o para importar dados completos do JSON unificado
    function importCompleteData() {
        try {
            console.log('üì• Iniciando importa√ß√£o completa...');
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const completeData = JSON.parse(e.target.result);
                            console.log('üìã Dados carregados:', completeData);
                            
                            // Validar estrutura do arquivo
                            if (!completeData.metadata || !completeData.meditations) {
                                throw new Error('Arquivo inv√°lido: estrutura incorreta');
                            }
                            
                            // Importar cada se√ß√£o
                            if (completeData.meditations) {
                                localStorage.setItem('meditations', JSON.stringify(completeData.meditations));
                                console.log('‚úÖ Medita√ß√µes importadas:', completeData.meditations.length);
                            }
                            
                            if (completeData.categories) {
                                localStorage.setItem('categories', JSON.stringify(completeData.categories));
                                console.log('‚úÖ Categorias importadas:', completeData.categories.length);
                            }
                            
                            if (completeData.users) {
                                localStorage.setItem('users', JSON.stringify(completeData.users));
                                console.log('‚úÖ Usu√°rios importados:', completeData.users.length);
                            }
                            
                            if (completeData.personalizedMeditations) {
                                localStorage.setItem('personalized_meditations', JSON.stringify(completeData.personalizedMeditations));
                                console.log('‚úÖ Medita√ß√µes personalizadas importadas:', completeData.personalizedMeditations.length);
                            }
                            
                            if (completeData.schedules) {
                                localStorage.setItem('user_schedules', JSON.stringify(completeData.schedules));
                                console.log('‚úÖ Agendamentos importados:', completeData.schedules.length);
                            }
                            
                            if (completeData.userMeditationStats) {
                                localStorage.setItem('user_meditation_stats', JSON.stringify(completeData.userMeditationStats));
                                console.log('‚úÖ Estat√≠sticas importadas');
                            }
                            
                            if (completeData.personalizedMeditationsHistory) {
                                localStorage.setItem('personalized_meditations_history', JSON.stringify(completeData.personalizedMeditationsHistory));
                                console.log('‚úÖ Hist√≥rico de medita√ß√µes importado:', completeData.personalizedMeditationsHistory.length);
                            }
                            
                            if (completeData.userSchedules) {
                                localStorage.setItem('user_schedules', JSON.stringify(completeData.userSchedules));
                                console.log('‚úÖ Agendamentos de usu√°rios importados:', completeData.userSchedules.length);
                            }
                            
                            if (completeData.activeSessions) {
                                localStorage.setItem('active_sessions', JSON.stringify(completeData.activeSessions));
                                console.log('‚úÖ Sess√µes ativas importadas:', completeData.activeSessions.length);
                            }
                            
                            // Recarregar dados na interface
                            loadAllData();
                            
                            console.log('‚úÖ Importa√ß√£o completa realizada com sucesso!');
                            showNotification('Importa√ß√£o completa realizada com sucesso!', 'success');
                            
                        } catch (error) {
                            console.error('‚ùå Erro ao processar arquivo:', error);
                            showNotification('Erro ao processar arquivo: ' + error.message, 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
            
        } catch (error) {
            console.error('‚ùå Erro na importa√ß√£o completa:', error);
            showNotification('Erro na importa√ß√£o completa', 'error');
        }
    }

    // Fun√ß√£o para fazer backup autom√°tico
    function autoBackup() {
        try {
            console.log('üîÑ Iniciando backup autom√°tico...');
            
            // Coletar dados atuais
            const currentData = {
                meditations: JSON.parse(localStorage.getItem('meditations') || '[]'),
                categories: JSON.parse(localStorage.getItem('categories') || '[]'),
                users: JSON.parse(localStorage.getItem('users') || '[]'),
                personalizedMeditations: JSON.parse(localStorage.getItem('personalized_meditations') || '[]'),
                schedules: JSON.parse(localStorage.getItem('user_schedules') || '[]'),
                userMeditationStats: JSON.parse(localStorage.getItem('user_meditation_stats') || '{}'),
                personalizedMeditationsHistory: JSON.parse(localStorage.getItem('personalized_meditations_history') || '[]'),
                userSchedules: JSON.parse(localStorage.getItem('user_schedules') || '[]'),
                activeSessions: JSON.parse(localStorage.getItem('active_sessions') || '[]')
            };
            
            // Salvar backup no localStorage
            localStorage.setItem('auto_backup_' + Date.now(), JSON.stringify(currentData));
            
            // Manter apenas os √∫ltimos 5 backups
            const backupKeys = Object.keys(localStorage).filter(key => key.startsWith('auto_backup_'));
            if (backupKeys.length > 5) {
                backupKeys.sort().slice(0, -5).forEach(key => {
                    localStorage.removeItem(key);
                });
            }
            
            console.log('‚úÖ Backup autom√°tico realizado');
            
        } catch (error) {
            console.error('‚ùå Erro no backup autom√°tico:', error);
        }
    }

    // Fun√ß√£o para restaurar backup autom√°tico
    function restoreAutoBackup() {
        try {
            console.log('üîÑ Restaurando backup autom√°tico...');
            
            const backupKeys = Object.keys(localStorage).filter(key => key.startsWith('auto_backup_'));
            if (backupKeys.length === 0) {
                showNotification('Nenhum backup autom√°tico encontrado', 'warning');
                return;
            }
            
            // Pegar o backup mais recente
            const latestBackupKey = backupKeys.sort().pop();
            const backupData = JSON.parse(localStorage.getItem(latestBackupKey));
            
            // Restaurar dados
            if (backupData.meditations) localStorage.setItem('meditations', JSON.stringify(backupData.meditations));
            if (backupData.categories) localStorage.setItem('categories', JSON.stringify(backupData.categories));
            if (backupData.users) localStorage.setItem('users', JSON.stringify(backupData.users));
            if (backupData.personalizedMeditations) localStorage.setItem('personalized_meditations', JSON.stringify(backupData.personalizedMeditations));
            if (backupData.schedules) localStorage.setItem('user_schedules', JSON.stringify(backupData.schedules));
            if (backupData.userMeditationStats) localStorage.setItem('user_meditation_stats', JSON.stringify(backupData.userMeditationStats));
            if (backupData.personalizedMeditationsHistory) localStorage.setItem('personalized_meditations_history', JSON.stringify(backupData.personalizedMeditationsHistory));
            if (backupData.userSchedules) localStorage.setItem('user_schedules', JSON.stringify(backupData.userSchedules));
            if (backupData.activeSessions) localStorage.setItem('active_sessions', JSON.stringify(backupData.activeSessions));
            
            // Recarregar dados na interface
            loadAllData();
            
            console.log('‚úÖ Backup autom√°tico restaurado:', latestBackupKey);
            showNotification('Backup autom√°tico restaurado com sucesso!', 'success');
            
        } catch (error) {
            console.error('‚ùå Erro ao restaurar backup autom√°tico:', error);
            showNotification('Erro ao restaurar backup autom√°tico', 'error');
        }
    }

    // ... existing code ...
  </script>
  
  <!-- Session Manager -->
  <script src="session-manager.js"></script>
  
  <!-- Backup Manager -->
  <script src="backup-manager.js"></script>
  
  <!-- Supabase Manager -->
  <script src="supabase-config.js"></script>
</body>
</html> 