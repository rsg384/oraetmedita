<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medita√ß√µes da Categoria - Ora et Medita</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-dark: #101223;
            --background-primary: #181a2a;
            --background-card: #23243a;
            --background-light: #2a2b4a;
            --text-primary: #f5f6fa;
            --text-secondary: #a3a8c9;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --border-color: #3a3b5a;
            --primary-gradient: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background-dark);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid #2a2d3e;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #f5f6fa;
        }

        .back-btn {
            background: #23243a;
            color: #f5f6fa;
            border: 1px solid #3a3b5a;
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #3a3b5a;
            border-color: #7ee787;
        }

        .category-info {
            background: var(--background-card);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .category-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #7ee787, #4ade80);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .category-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .category-description {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        .category-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--background-light);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-green);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Responsividade para os cards de estat√≠sticas */
        @media (max-width: 768px) {
            .category-stats {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .stat-item {
                padding: 0.75rem;
            }
            
            .stat-number {
                font-size: 1.25rem;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
        }

        .meditation-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .meditation-item {
            background: var(--background-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .meditation-item:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.1);
        }

        .meditation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .meditation-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .meditation-source {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            background: var(--background-light);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .meditation-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-weight: 500;
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-in-progress {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-locked {
            background: rgba(107, 114, 128, 0.1);
            color: #6b7280;
            border: 1px solid rgba(107, 114, 128, 0.2);
        }



        .meditation-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .meditation-meta {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }





        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .category-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .meditation-list {
                grid-template-columns: 1fr;
            }

            .meditation-header {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="pageTitle">Medita√ß√µes da Categoria</h1>
            <a href="categorias.html" class="back-btn">‚Üê Voltar √†s Categorias</a>
        </div>

        <div class="category-info" id="categoryInfo">
            <!-- Informa√ß√µes da categoria ser√£o carregadas dinamicamente -->
        </div>

        <div class="meditation-list" id="meditationList">
            <!-- Lista de medita√ß√µes ser√° carregada dinamicamente -->
        </div>
    </div>

    <script>
        // Fun√ß√£o para obter par√¢metros da URL
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Fun√ß√£o para obter dados da categoria
        function getCategoryData(categoryId) {
            try {
                const adminCategories = JSON.parse(localStorage.getItem('categories') || '[]');
                return adminCategories.find(cat => cat.id === categoryId);
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados da categoria:', error);
                return null;
            }
        }

        // Fun√ß√£o para obter medita√ß√µes da categoria
        function getCategoryMeditations(categoryId) {
            try {
                const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
                let categoryMeditations = adminMeditations.filter(med => med.categoryId === categoryId);
                
                // Se for a categoria "Minhas Medita√ß√µes", incluir medita√ß√µes personalizadas
                if (categoryId === 'cat_1753676096892') {
                    console.log('üéØ Carregando medita√ß√µes personalizadas para "Minhas Medita√ß√µes"');
                    
                    // Obter usu√°rio atual
                    const currentUser = JSON.parse(localStorage.getItem('userData') || '{}');
                    const userId = currentUser.id || 'anonymous';
                    
                    // Carregar medita√ß√µes personalizadas
                    const personalizedData = localStorage.getItem('personalized_meditations');
                    if (personalizedData) {
                        try {
                            const allPersonalizedMeditations = JSON.parse(personalizedData);
                            const userPersonalizedMeditations = allPersonalizedMeditations.filter(med => 
                                med.userId === userId && (med.type === 'simple' || !med.type)
                            );
                            
                            console.log('üìã Medita√ß√µes personalizadas encontradas:', userPersonalizedMeditations.length);
                            
                            // Adicionar medita√ß√µes personalizadas √† lista
                            categoryMeditations = [...categoryMeditations, ...userPersonalizedMeditations];
                        } catch (error) {
                            console.error('‚ùå Erro ao carregar medita√ß√µes personalizadas:', error);
                        }
                    }
                }
                
                return categoryMeditations;
            } catch (error) {
                console.error('‚ùå Erro ao carregar medita√ß√µes da categoria:', error);
                return [];
            }
        }

        // Fun√ß√£o para renderizar informa√ß√µes da categoria
        function renderCategoryInfo(category) {
            const categoryInfo = document.getElementById('categoryInfo');
            if (!categoryInfo || !category) return;

            const meditations = getCategoryMeditations(category.id);
            const completed = meditations.filter(m => m.status === 'completed').length;
            const inProgress = meditations.filter(m => 
                m.status === 'in_progress' || m.status === 'pending'
            ).length;
            const total = meditations.length;

            console.log('üìä Estat√≠sticas da categoria:', {
                category: category.name,
                total: total,
                completed: completed,
                inProgress: inProgress,
                pending: total - completed - inProgress
            });

            categoryInfo.innerHTML = `
                <div class="category-header">
                    <div class="category-icon">${category.icon || 'üìñ'}</div>
                    <div>
                        <h2 class="category-title">${category.name}</h2>
                        <p class="category-description">${category.description || 'Medita√ß√µes espirituais para crescimento na f√©'}</p>
                    </div>
                </div>
                <div class="category-stats">
                    <div class="stat-item">
                        <div class="stat-number">${total}</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${completed}</div>
                        <div class="stat-label">Conclu√≠das</div>
                    </div>
                </div>
            `;
        }

        // Fun√ß√£o para renderizar lista de medita√ß√µes
        function renderMeditationList(meditations, category) {
            const meditationList = document.getElementById('meditationList');
            if (!meditationList) return;

            if (meditations.length === 0) {
                meditationList.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">üìñ</div>
                        <h3>Nenhuma medita√ß√£o encontrada</h3>
                        <p>Esta categoria ainda n√£o possui medita√ß√µes dispon√≠veis.</p>
                    </div>
                `;
                return;
            }

            meditationList.innerHTML = '';

            meditations.forEach(meditation => {
                const statusClass = getStatusClass(meditation.status);
                const statusText = getStatusText(meditation.status);
                const statusIcon = getStatusIcon(meditation.status);

                const meditationItem = document.createElement('div');
                meditationItem.className = 'meditation-item';
                meditationItem.onclick = () => startMeditation(meditation);

                // Verificar se √© uma medita√ß√£o personalizada
                const isPersonalized = meditation.userId && !meditation.categoryId;
                const sourceIcon = isPersonalized ? '‚ú®' : 'üìñ';
                const sourceText = isPersonalized ? 'Personalizada' : 'Admin';

                meditationItem.innerHTML = `
                    <div class="meditation-header">
                        <div>
                            <h3 class="meditation-title">${meditation.title}</h3>
                            <div class="meditation-status ${statusClass}">
                                <span>${statusIcon}</span>
                                <span>${statusText}</span>
                            </div>
                        </div>
                        <div class="meditation-source">
                            <span>${sourceIcon}</span>
                            <span>${sourceText}</span>
                        </div>
                    </div>

                `;

                meditationList.appendChild(meditationItem);
            });

            console.log('‚úÖ Lista de medita√ß√µes renderizada:', meditations.length, 'itens');
        }

        // Fun√ß√µes auxiliares para status
        function getStatusClass(status) {
            switch (status) {
                case 'completed': return 'status-completed';
                case 'in_progress': return 'status-in-progress';
                case 'pending': return 'status-pending';
                case 'locked': return 'status-locked';
                default: return 'status-pending';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'completed': return 'Conclu√≠da';
                case 'in_progress': return 'Em andamento';
                case 'pending': return 'Pendente';
                case 'locked': return 'Bloqueada';
                default: return 'Pendente';
            }
        }

        function getStatusIcon(status) {
            switch (status) {
                case 'completed': return '‚úÖ';
                case 'in_progress': return 'üîÑ';
                case 'pending': return '‚è≥';
                case 'locked': return 'üîí';
                default: return '‚è≥';
            }
        }

        // Fun√ß√£o para iniciar medita√ß√£o
        function startMeditation(meditation) {
            console.log('üöÄ Iniciando medita√ß√£o:', meditation.title);

            // Salvar medita√ß√£o atual no localStorage (igual ao dashboard)
            const meditationData = {
                id: meditation.id,
                title: meditation.title,
                categoryId: meditation.categoryId,
                category: meditation.category,
                duration: meditation.duration,
                status: meditation.status,
                lectio: meditation.lectio || '',
                meditatio: meditation.meditatio || '',
                oratio: meditation.oratio || '',
                contemplatio: meditation.contemplatio || '',
                reading: meditation.lectio || meditation.reading || '',
                meditation: meditation.meditatio || meditation.meditation || '',
                prayer: meditation.oratio || meditation.prayer || '',
                contemplation: meditation.contemplatio || meditation.contemplation || ''
            };

            localStorage.setItem('meditacao-atual', JSON.stringify(meditationData));

            // Marcar como em progresso se estiver pendente
            if (meditation.status === 'pending') {
                meditation.status = 'in_progress';
                // Atualizar no localStorage
                const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
                const updatedMeditations = adminMeditations.map(m => 
                    m.id === meditation.id ? { ...m, status: 'in_progress' } : m
                );
                localStorage.setItem('meditations', JSON.stringify(updatedMeditations));
            }

            // Redirecionar para p√°gina de medita√ß√£o com par√¢metro de origem
            window.location.href = 'meditacao.html?from=minhas-meditacoes';
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ P√°gina de medita√ß√µes da categoria carregada');

            const categoryId = getUrlParameter('category');
            if (!categoryId) {
                console.error('‚ùå ID da categoria n√£o fornecido');
                window.location.href = 'categorias.html';
                return;
            }

            console.log('üìã Categoria ID:', categoryId);

            // Carregar dados da categoria
            const category = getCategoryData(categoryId);
            if (!category) {
                console.error('‚ùå Categoria n√£o encontrada');
                window.location.href = 'categorias.html';
                return;
            }

            // Atualizar t√≠tulo da p√°gina
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) {
                pageTitle.textContent = `Medita√ß√µes - ${category.name}`;
            }

            // Renderizar informa√ß√µes da categoria
            renderCategoryInfo(category);

            // Carregar e renderizar medita√ß√µes
            const meditations = getCategoryMeditations(categoryId);
            renderMeditationList(meditations, category);

            console.log('‚úÖ P√°gina inicializada para categoria:', category.name);
        });
    </script>
</body>
</html> 