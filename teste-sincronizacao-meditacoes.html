<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste de Sincroniza√ß√£o de Medita√ß√µes - Ora et Medita</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            word-break: break-all;
        }
        
        .success {
            border-left: 4px solid #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .error {
            border-left: 4px solid #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .warning {
            border-left: 4px solid #ff9800;
            background: rgba(255, 152, 0, 0.1);
        }
        
        .info {
            border-left: 4px solid #2196F3;
            background: rgba(33, 150, 243, 0.1);
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .meditation-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .meditation-card h4 {
            color: #fff;
            margin-bottom: 10px;
        }
        
        .meditation-card p {
            color: #ccc;
            font-size: 0.9em;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Sincroniza√ß√£o de Medita√ß√µes</h1>
        
        <div class="test-section">
            <h3>üîß Inicializa√ß√£o</h3>
            <button onclick="testInitialization()">Testar Inicializa√ß√£o</button>
            <div id="initialization-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä Status da Sincroniza√ß√£o</h3>
            <button onclick="testSyncStatus()">Verificar Status</button>
            <div id="sync-status-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üíæ Salvar Medita√ß√£o de Teste</h3>
            <button onclick="testSaveMeditation()">Salvar Medita√ß√£o</button>
            <div id="save-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìö Carregar Medita√ß√µes</h3>
            <button onclick="testLoadMeditations()">Carregar Medita√ß√µes</button>
            <div id="load-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üîÑ Sincroniza√ß√£o Completa</h3>
            <button onclick="testFullSync()">Sincronizar Tudo</button>
            <div id="full-sync-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üóëÔ∏è Excluir Medita√ß√£o</h3>
            <button onclick="testDeleteMeditation()">Excluir √öltima Medita√ß√£o</button>
            <div id="delete-result"></div>
        </div>
    </div>

    <script src="supabase-config.js"></script>
    <script src="sync-supabase-meditations.js"></script>
    <script>
        let lastCreatedMeditationId = null;

        function addLog(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            element.appendChild(div);
        }

        function clearLog(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        async function testInitialization() {
            clearLog('initialization-result');
            addLog('initialization-result', 'üîÑ Testando inicializa√ß√£o...', 'info');
            
            try {
                const result = await window.meditationSyncManager.initialize();
                if (result) {
                    addLog('initialization-result', '‚úÖ MeditationSyncManager inicializado com sucesso', 'success');
                    addLog('initialization-result', `üìä Supabase dispon√≠vel: ${window.meditationSyncManager.isInitialized}`, 'info');
                } else {
                    addLog('initialization-result', '‚ö†Ô∏è MeditationSyncManager inicializado mas Supabase n√£o dispon√≠vel', 'warning');
                }
            } catch (error) {
                addLog('initialization-result', `‚ùå Erro na inicializa√ß√£o: ${error.message}`, 'error');
            }
        }

        async function testSyncStatus() {
            clearLog('sync-status-result');
            addLog('sync-status-result', 'üìä Verificando status da sincroniza√ß√£o...', 'info');
            
            try {
                const status = await window.meditationSyncManager.checkSyncStatus();
                if (status) {
                    addLog('sync-status-result', `üìä Status da sincroniza√ß√£o:`, 'info');
                    addLog('sync-status-result', `üì± Local: ${status.localCount} medita√ß√µes`, 'info');
                    addLog('sync-status-result', `‚òÅÔ∏è Supabase: ${status.supabaseCount} medita√ß√µes`, 'info');
                    addLog('sync-status-result', `üîó Supabase dispon√≠vel: ${status.supabaseAvailable}`, 'info');
                    
                    if (status.localMeditations.length > 0) {
                        addLog('sync-status-result', 'üìã Medita√ß√µes locais:', 'info');
                        status.localMeditations.forEach((med, index) => {
                            addLog('sync-status-result', `  ${index + 1}. ${med.title} (${med.id})`, 'info');
                        });
                    }
                } else {
                    addLog('sync-status-result', '‚ùå Erro ao verificar status', 'error');
                }
            } catch (error) {
                addLog('sync-status-result', `‚ùå Erro: ${error.message}`, 'error');
            }
        }

        async function testSaveMeditation() {
            clearLog('save-result');
            addLog('save-result', 'üíæ Salvando medita√ß√£o de teste...', 'info');
            
            try {
                const testMeditation = {
                    id: 'test-meditation-' + Date.now(),
                    title: 'Medita√ß√£o de Teste - ' + new Date().toLocaleString(),
                    topic: 'Teste de Sincroniza√ß√£o',
                    content: 'Esta √© uma medita√ß√£o de teste para verificar a sincroniza√ß√£o com o Supabase.',
                    duration: '10 min',
                    status: 'completed',
                    source: 'test',
                    type: 'simple'
                };
                
                const result = await window.meditationSyncManager.saveMeditation(testMeditation);
                if (result) {
                    addLog('save-result', '‚úÖ Medita√ß√£o salva com sucesso', 'success');
                    addLog('save-result', `üìù T√≠tulo: ${testMeditation.title}`, 'info');
                    addLog('save-result', `üÜî ID: ${testMeditation.id}`, 'info');
                    lastCreatedMeditationId = testMeditation.id;
                } else {
                    addLog('save-result', '‚ùå Erro ao salvar medita√ß√£o', 'error');
                }
            } catch (error) {
                addLog('save-result', `‚ùå Erro: ${error.message}`, 'error');
            }
        }

        async function testLoadMeditations() {
            clearLog('load-result');
            addLog('load-result', 'üìö Carregando medita√ß√µes...', 'info');
            
            try {
                const meditations = await window.meditationSyncManager.loadMeditations();
                addLog('load-result', `‚úÖ ${meditations.length} medita√ß√µes carregadas`, 'success');
                
                if (meditations.length > 0) {
                    meditations.forEach((med, index) => {
                        const card = document.createElement('div');
                        card.className = 'meditation-card';
                        card.innerHTML = `
                            <h4>${med.title}</h4>
                            <p><strong>ID:</strong> ${med.id}</p>
                            <p><strong>T√≥pico:</strong> ${med.topic}</p>
                            <p><strong>Dura√ß√£o:</strong> ${med.duration}</p>
                            <p><strong>Status:</strong> ${med.status}</p>
                            <p><strong>Criado:</strong> ${new Date(med.createdAt).toLocaleString()}</p>
                        `;
                        document.getElementById('load-result').appendChild(card);
                    });
                } else {
                    addLog('load-result', 'üì≠ Nenhuma medita√ß√£o encontrada', 'warning');
                }
            } catch (error) {
                addLog('load-result', `‚ùå Erro: ${error.message}`, 'error');
            }
        }

        async function testFullSync() {
            clearLog('full-sync-result');
            addLog('full-sync-result', 'üîÑ Iniciando sincroniza√ß√£o completa...', 'info');
            
            try {
                const result = await window.meditationSyncManager.syncAllMeditations();
                if (result) {
                    addLog('full-sync-result', '‚úÖ Sincroniza√ß√£o completa realizada com sucesso', 'success');
                } else {
                    addLog('full-sync-result', '‚ö†Ô∏è Sincroniza√ß√£o parcial ou falhou', 'warning');
                }
            } catch (error) {
                addLog('full-sync-result', `‚ùå Erro: ${error.message}`, 'error');
            }
        }

        async function testDeleteMeditation() {
            clearLog('delete-result');
            
            if (!lastCreatedMeditationId) {
                addLog('delete-result', '‚ö†Ô∏è Nenhuma medita√ß√£o de teste criada. Crie uma primeiro.', 'warning');
                return;
            }
            
            addLog('delete-result', `üóëÔ∏è Excluindo medita√ß√£o: ${lastCreatedMeditationId}`, 'info');
            
            try {
                const result = await window.meditationSyncManager.deleteMeditation(lastCreatedMeditationId);
                if (result) {
                    addLog('delete-result', '‚úÖ Medita√ß√£o exclu√≠da com sucesso', 'success');
                    lastCreatedMeditationId = null;
                } else {
                    addLog('delete-result', '‚ùå Erro ao excluir medita√ß√£o', 'error');
                }
            } catch (error) {
                addLog('delete-result', `‚ùå Erro: ${error.message}`, 'error');
            }
        }

        // Teste autom√°tico ao carregar
        window.addEventListener('load', function() {
            setTimeout(() => {
                testInitialization();
            }, 1000);
        });
    </script>
</body>
</html> 