<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lectio Divina - Medita√ß√£o</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #101223;
      color: #f5f6fa;
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 100%;
      min-height: 100vh;
      background: #181a2a;
      padding: 0;
      box-sizing: border-box;
    }
    
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #181a2a;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      border-bottom: 1px solid #23243a;
    }
    
    /* Bot√£o Voltar */
    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: none;
      border: none;
      color: #f5f6fa;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 6px;
      transition: background-color 0.3s ease;
      font-size: 14px;
    }
    
    .back-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .back-icon {
      font-size: 18px;
      font-weight: bold;
    }
    
    .back-text {
      font-weight: 500;
    }
    
    /* Centro do Header */
    .header-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    
    .meditation-title {
      color: #9ca3af;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 2px;
    }
    
    .meditation-number {
      color: #7ee787;
      font-size: 18px;
      font-weight: bold;
    }
    
    /* Bot√£o de Tema */
    .theme-toggle-btn {
      background: #23243a;
      border: 1px solid #3a3b5a;
      border-radius: 8px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .theme-toggle-btn:hover {
      background: #2d2e4a;
      border-color: #4a4b6a;
    }
    
    .main-content {
      padding: 120px 24px 24px 24px;
      margin-top: 0;
    }
    
    .theme-toggle {
      background: #23243a;
      border: none;
      color: #a3a8c9;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      margin-left: 12px;
    }
    
    .theme-toggle:hover {
      background: #2a2b4a;
      color: #fff;
    }

    .theme-icon {
      transition: all 0.3s ease;
    }

    .theme-icon.sun-icon {
      display: block;
    }

    .theme-icon.moon-icon {
      display: none;
    }

    body.light-mode .theme-icon.sun-icon {
      display: none;
    }

    body.light-mode .theme-icon.moon-icon {
      display: block;
    }
    
    /* Modo claro */
    body.light-mode {
      background: #f5f6fa;
      color: #2c3e50;
    }
    
    body.light-mode .container {
      background: #ffffff;
    }
    
    body.light-mode .header {
      background: #ffffff;
      border-bottom: 1px solid #dee2e6;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    body.light-mode .back-btn {
      color: #2c3e50;
    }
    
    body.light-mode .back-btn:hover {
      background: rgba(0, 0, 0, 0.05);
    }
    
    body.light-mode .meditation-title {
      color: #6c757d;
    }
    
    body.light-mode .meditation-number {
      color: #17a2b8;
    }
    
    body.light-mode .theme-toggle-btn {
      background: #f8f9fa;
      border-color: #dee2e6;
    }
    
    body.light-mode .theme-toggle-btn:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }
    
    body.light-mode .header .back {
      color: #6c757d;
    }
    
    body.light-mode .header .back:hover {
      color: #2c3e50;
    }
    
    body.light-mode .header .info .categoria {
      color: #6c757d;
    }
    
    body.light-mode .progress-bar {
      background: #e9ecef;
    }
    
    body.light-mode .step {
      background: #e9ecef;
      color: #6c757d;
    }
    
    body.light-mode .step.active {
      background: #d1ecf1;
      color: #2c3e50;
      border-bottom: 3px solid #17a2b8;
    }
    
    body.light-mode .content {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    body.light-mode .theme-toggle {
      background: #e9ecef;
      color: #6c757d;
    }
    
    body.light-mode .theme-toggle:hover {
      background: #dee2e6;
      color: #2c3e50;
    }
    
    /* Formata√ß√£o do conte√∫do das medita√ß√µes */
    .content {
      text-align: justify;
      line-height: 1.8;
      font-size: 16px;
    }
    
    .content em {
      font-style: italic;
    }
    
    .content strong {
      font-weight: bold;
    }
    
    body.light-mode .main-text {
      color: #2c3e50;
    }
    
    body.light-mode .instruction {
      background: #e3f2fd;
      border-left: 4px solid #17a2b8;
      color: #2c3e50;
    }
    
    body.light-mode .reflection-box {
      background: #f8f9fa;
      color: #2c3e50;
    }
    
    body.light-mode .reflection-box h3 {
      color: #17a2b8;
    }
    
    body.light-mode .question {
      background: #e3f2fd;
      color: #2c3e50;
    }
    
    body.light-mode .question strong {
      color: #17a2b8;
    }
    
    body.light-mode .practical-application {
      background: #e3f2fd;
      color: #2c3e50;
    }
    
    body.light-mode .practical-application h4 {
      color: #17a2b8;
    }
    
    body.light-mode .prayer-box {
      background: #f8f9fa;
      color: #2c3e50;
    }
    
    body.light-mode .prayer-text {
      color: #6c757d;
    }
    
    body.light-mode .intentions {
      background: #e3f2fd;
      color: #2c3e50;
    }
    
    body.light-mode .intention-item {
      border-bottom: 1px solid #dee2e6;
    }
    
    body.light-mode .personal-prayer {
      background: #e3f2fd;
      color: #2c3e50;
    }
    
    body.light-mode .personal-prayer textarea {
      background: #ffffff;
      border: 1px solid #dee2e6;
      color: #2c3e50;
    }
    
    body.light-mode .contemplation-box {
      background: #f8f9fa;
      color: #2c3e50;
    }
    
    body.light-mode .timer-box {
      background: #e3f2fd;
      color: #2c3e50;
    }
    .header .back {
      color: #a3a8c9;
      text-decoration: none;
      font-size: 1.1em;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: color .2s;
    }
    .header .back:hover {
      color: #fff;
    }
    .header .info {
      text-align: right;
    }
    .header .info .categoria {
      font-size: 1em;
      color: #a3a8c9;
    }
    .header .info .tempo {
      font-size: 1.1em;
      font-weight: 600;
      color: #7ee787;
      margin-left: 8px;
    }
    .progress-bar {
      width: 100%;
      height: 16px;
      background: #23243a;
      border-radius: 8px;
      margin: 16px 0 24px 0;
      overflow: hidden;
      position: relative;
    }
    .progress-bar-inner {
      height: 100%;
      background: linear-gradient(90deg, #7ee787 60%, #a3a8c9 100%);
      border-radius: 8px;
      transition: width .4s;
    }
    .steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 18px;
      gap: 4px;
    }
    .step {
      flex: 1;
      background: #23243a;
      color: #a3a8c9;
      padding: 10px 0;
      border-radius: 8px 8px 0 0;
      text-align: center;
      font-weight: 600;
      cursor: pointer;
      transition: background .2s, color .2s;
      border-bottom: 3px solid transparent;
    }
    .step.active {
      background: #222b4a;
      color: #fff;
      border-bottom: 3px solid #7ee787;
    }
    .content {
      background: #181a2a;
      border-radius: 0 0 12px 12px;
      padding: 24px 16px 16px 16px;
      min-height: 320px;
      box-shadow: 0 2px 8px #0001;
    }
    
    /* Estilos para a lista de medita√ß√µes */
    .meditation-list {
      margin-top: 20px;
    }
    
    .meditation-item {
      background: #181a2a;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      border: 1px solid #23243a;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .meditation-item:hover {
      background: #1e1f2e;
      border-color: #7ee787;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(126, 231, 135, 0.2);
    }
    
    .meditation-info {
      flex: 1;
    }
    
    .meditation-title {
      font-size: 1.1em;
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }
    
    .meditation-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9em;
    }
    
    .status-icon {
      font-size: 1.2em;
    }
    
    .status-completed {
      color: #7ee787;
    }
    
    .status-in-progress {
      color: #60a5fa;
    }
    
    .status-locked {
      color: #a3a8c9;
    }
    
    .meditation-duration {
      color: #7ee787;
      font-weight: 600;
      font-size: 0.9em;
    }
    
    .meditation-actions {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      background: #23243a;
      border: none;
      color: #a3a8c9;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.2s;
    }
    
    .action-btn:hover {
      background: #2a2b4a;
      color: #fff;
    }
    
    .action-btn.primary {
      background: #7ee787;
      color: #101223;
    }
    
    .action-btn.primary:hover {
      background: #6dd676;
    }
    
    /* Modo claro para a lista de medita√ß√µes */
    body.light-mode .meditation-item {
      background: #ffffff;
      border-color: #e9ecef;
    }
    
    body.light-mode .meditation-item:hover {
      background: #f8f9fa;
      border-color: #17a2b8;
    }
    
    body.light-mode .meditation-title {
      color: #2c3e50;
    }
    
    body.light-mode .action-btn {
      background: #e9ecef;
      color: #6c757d;
    }
    
    body.light-mode .action-btn:hover {
      background: #dee2e6;
      color: #2c3e50;
    }
    
    body.light-mode .action-btn.primary {
      background: #17a2b8;
      color: #ffffff;
    }
    
    body.light-mode .action-btn.primary:hover {
      background: #138496;
    }
    @media (max-width: 600px) {
      .container { padding: 0; }
      .header { padding: 12px 16px; }
      .main-content { padding: 100px 16px 16px 16px; }
      .content { padding: 12px 4px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <button class="back-btn" id="back-button" onclick="goBack()">
        <span class="back-icon">‚Üê</span>
        <span class="back-text">Voltar</span>
      </button>
      
      <div class="header-center">
        <div class="meditation-title" id="meditation-title" style="font-size: 2.5rem; font-weight: bold;">Salmos</div>
        <!-- Removido: <div class="meditation-number" id="meditation-number">12</div> -->
      </div>
      
      <button class="theme-toggle-btn" onclick="toggleTheme()" title="Alternar tema">
        <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/>
          <line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
    </div>
    
    <div class="main-content">
      <!-- Lista de Medita√ß√µes -->
      <div class="meditation-list" id="meditation-list">
        <!-- As medita√ß√µes ser√£o carregadas aqui -->
      </div>
      
      <!-- Container para medita√ß√£o individual (inicialmente oculto) -->
      <div class="meditation-container" id="meditation-container" style="display: none;">
        <div class="progress-bar">
          <div class="progress-bar-inner" style="width: 25%"></div>
        </div>
        <div class="steps">
          <div class="step active" data-step="1"><span id="step1-title">Leitura</span></div>
          <div class="step" data-step="2"><span id="step2-title">Medita√ß√£o</span></div>
          <div class="step" data-step="3"><span id="step3-title">Ora√ß√£o</span></div>
          <div class="step" data-step="4"><span id="step4-title">Contempla√ß√£o</span></div>
        </div>
        <div class="content" id="step-content">
          <!-- Conte√∫do din√¢mico dos passos ser√° inserido aqui -->
        </div>
        
        <!-- Bot√£o Medita√ß√£o Conclu√≠da -->
        <div class="completion-section" style="text-align: center; margin-top: 2rem; padding: 2rem;">
          <button id="complete-meditation-btn" class="completion-btn" onclick="completeMeditation()" style="display: none;">
            ‚úÖ Medita√ß√£o Conclu√≠da
          </button>
        </div>
      </div>
    </div>
  </div>

  <style>
    #step-content {
      display: block;
    }

    .main-text {
      line-height: 1.7;
      margin: 16px 0;
      color: #f5f6fa;
    }
    .instruction {
      background: #2a2b4a;
      border-left: 4px solid #7ee787;
      padding: 12px 16px;
      margin: 16px 0;
      border-radius: 0 8px 8px 0;
    }
    .reflection-box {
      background: #23243a;
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
    }
    .reflection-box h3 {
      color: #7ee787;
      margin: 0 0 12px 0;
    }
    .question {
      background: #2a2b4a;
      border-radius: 8px;
      padding: 12px;
      margin: 12px 0;
    }
    .question strong {
      color: #7ee787;
    }
    .practical-application {
      background: #2a2b4a;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .practical-application h4 {
      color: #7ee787;
      margin: 0 0 8px 0;
    }
    .prayer-box {
      background: #23243a;
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
    }
    .prayer-text {
      font-style: italic;
      color: #a3a8c9;
      line-height: 1.6;
      margin: 12px 0;
    }
    .intentions {
      background: #2a2b4a;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .intention-item {
      margin: 8px 0;
      padding: 8px 0;
      border-bottom: 1px solid #3a3b5a;
    }
    .personal-prayer {
      background: #2a2b4a;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .personal-prayer textarea {
      width: 100%;
      min-height: 120px;
      background: #181a2a;
      border: 1px solid #3a3b5a;
      border-radius: 8px;
      color: #f5f6fa;
      padding: 12px;
      font-family: inherit;
      resize: vertical;
    }
    .completion-btn {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      margin: 20px auto;
      display: inline-block;
    }

    .completion-btn:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .completion-btn:active {
      transform: translateY(0);
    }

    .completion-section {
      text-align: center;
      margin-top: 2rem;
      padding: 2rem;
      background: rgba(16, 185, 129, 0.05);
      border-radius: 16px;
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .contemplation-box {
      background: #23243a;
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
    }
    .timer-box {
      background: #2a2b4a;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
      text-align: center;
    }
    .timer-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin: 12px 0;
    }
    .timer-btn {
      background: #3a3b5a;
      border: none;
      color: #f5f6fa;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background .2s;
    }
    .timer-btn:hover {
      background: #4a4b6a;
    }
    .timer-btn.active {
      background: #7ee787;
      color: #101223;
    }
    .commitment-box {
      background: #2a2b4a;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .commitment-checkboxes {
      margin: 12px 0;
    }
    .commitment-checkbox {
      display: flex;
      align-items: center;
      margin: 8px 0;
      gap: 8px;
    }
    .commitment-checkbox input {
      width: 18px;
      height: 18px;
    }
    .completion-box {
      background: #23243a;
      border-radius: 12px;
      padding: 20px;
      margin: 16px 0;
      text-align: center;
    }
    .evaluation {
      background: #2a2b4a;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .evaluation-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin: 12px 0;
    }
    .eval-btn {
      background: #3a3b5a;
      border: none;
      color: #f5f6fa;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: background .2s;
    }
    .eval-btn:hover {
      background: #4a4b6a;
    }
    .navigation-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin: 20px 0;
    }
    .nav-btn {
      background: #3a3b5a;
      border: none;
      color: #f5f6fa;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: background .2s;
      text-decoration: none;
      display: inline-block;
    }
    .nav-btn:hover {
      background: #4a4b6a;
    }
    .nav-btn.primary {
      background: #7ee787;
      color: #101223;
    }
    .nav-btn.primary:hover {
      background: #6dd676;
    }
    .save-btn {
      background: #7ee787;
      border: none;
      color: #101223;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin: 8px 4px;
    }
    .save-btn:hover {
      background: #6dd676;
    }
    .clear-btn {
      background: #4a4b6a;
      border: none;
      color: #f5f6fa;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin: 8px 4px;
    }
    .clear-btn:hover {
      background: #5a5b7a;
    }
    
    /* Bot√£o de Conclus√£o */
    .completion-btn {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    
    .completion-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }
    
    .completion-btn:active {
      transform: translateY(0);
    }
  </style>

  <script>
    // Dados da medita√ß√£o
    const meditacaoData = {
      titulo: "A Vida Interior",
      categoria: "Princ√≠pios da Vida Sobrenatural",
      licao: 1,
      total: 24,
      duracao: 12,
      passos: {
        1: {
          titulo: "LEITURA",
          icone: "üìñ",
          conteudo: `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">A Vida Interior</h2>
            
            <h3>üìö Texto Principal para Leitura</h3>
            <div class="main-text">
              A vida interior √© o fundamento de toda espiritualidade crist√£. √â a dimens√£o mais profunda da exist√™ncia humana, onde a alma se encontra com Deus no sil√™ncio do cora√ß√£o.
            </div>
            
            <div class="main-text">
              Jesus nos ensina que o Reino de Deus est√° dentro de n√≥s. Isso significa que n√£o precisamos procurar Deus em lugares distantes - Ele j√° habita em nossa alma pela gra√ßa do Batismo. A vida interior √© o santu√°rio √≠ntimo onde acontece a verdadeira transforma√ß√£o espiritual.
            </div>
            
            <div class="main-text">
              Os tr√™s pilares da vida interior s√£o:
            </div>
            
            <div class="main-text">
              <strong>1. Recolhimento:</strong> A capacidade de se voltar para dentro, saindo do barulho exterior para encontrar o sil√™ncio do cora√ß√£o. √â como Jesus que "se retirava para lugares solit√°rios para orar" (Lc 5,16).
            </div>
            
            <div class="main-text">
              <strong>2. Sil√™ncio:</strong> O espa√ßo sagrado onde podemos escutar a voz suave de Deus. No sil√™ncio, descobrimos que Deus fala n√£o com palavras, mas com sua presen√ßa que toca o cora√ß√£o.
            </div>
            
            <div class="main-text">
              <strong>3. Presen√ßa:</strong> A consci√™ncia constante de que Deus est√° conosco. S√£o Paulo nos lembra: "Nele vivemos, nos movemos e existimos" (At 17,28).
            </div>
            
            <div class="main-text">
              A vida interior n√£o √© fuga do mundo, mas sim a fonte de for√ßa para viver autenticamente os valores crist√£os na vida cotidiana. √â no encontro √≠ntimo com Deus que encontramos a paz, a dire√ß√£o e a for√ßa para enfrentar os desafios da vida.
            </div>
            
            <div class="instruction">
              üëÅÔ∏è Leia este texto duas vezes, devagar, deixando as palavras penetrarem em seu cora√ß√£o.
            </div>
          `
        },
        2: {
          titulo: "MEDITA√á√ÉO",
          icone: "ü§î",
          conteudo: `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">A Vida Interior</h2>
            
            <div class="reflection-box">
              <h3>üí≠ PARA REFLETIR</h3>
              <div class="main-text">Leia cada pergunta devagar e reflita honestamente</div>
            </div>
            
            <h3>üîç Perguntas para Reflex√£o:</h3>
            
            <div class="question">
              <strong>1. Descobrindo sua vida interior:</strong><br>
              Em que momentos do dia voc√™ se lembra de que Deus est√° presente em sua alma? Quando voc√™ sente mais facilidade para "entrar no seu quarto interior" e encontrar Deus?
            </div>
            
            <div class="question">
              <strong>2. Identificando os obst√°culos:</strong><br>
              O que mais distrai voc√™ da vida interior? Talvez seja o celular, as preocupa√ß√µes do trabalho, o barulho constante, ou a pressa da rotina. Seja honesto consigo mesmo.
            </div>
            
            <div class="question">
              <strong>3. Reconhecendo a presen√ßa de Deus:</strong><br>
              Como Deus j√° se manifestou em sua vida? Que sinais de sua presen√ßa voc√™ pode reconhecer: uma paz inexplic√°vel, uma inspira√ß√£o boa, um encontro providencial, uma ora√ß√£o atendida?
            </div>
            
            <div class="question">
              <strong>4. Planejando mudan√ßas pr√°ticas:</strong><br>
              Como voc√™ pode criar pequenos espa√ßos de sil√™ncio em sua rotina? Pense em momentos espec√≠ficos: ao acordar, no tr√¢nsito, antes das refei√ß√µes, antes de dormir.
            </div>
            
            <div class="practical-application">
              <h4>üí° Aplica√ß√£o Pr√°tica:</h4>
              <div class="main-text">
                <strong>No trabalho:</strong> Antes de come√ßar suas tarefas, fa√ßa uma ora√ß√£o breve oferecendo o dia a Deus. Pratique pequenas jaculat√≥rias durante o dia: "Jesus, eu confio em V√≥s" ou "Senhor, dai-me for√ßa".
              </div>
              <div class="main-text">
                <strong>Em casa:</strong> Reserve 5 minutos pela manh√£ para sil√™ncio, antes de pegar o celular. Crie um "cantinho de ora√ß√£o" em seu quarto, mesmo que seja apenas uma imagem sacra.
              </div>
              <div class="main-text">
                <strong>Nos relacionamentos:</strong> Antes de responder com irrita√ß√£o, fa√ßa uma ora√ß√£o r√°pida pedindo paci√™ncia. Veja Cristo nas pessoas que encontra, especialmente nas mais dif√≠ceis.
              </div>
            </div>
            
            <div class="instruction">
              üéØ <strong>Frase para memorizar:</strong> "O Reino de Deus est√° dentro de v√≥s" - Jesus quer lembrar voc√™ desta verdade todos os dias.
            </div>
          `
        },
        3: {
          titulo: "ORA√á√ÉO",
          icone: "üôè",
          conteudo: `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">A Vida Interior</h2>
            
            <div class="prayer-box">
              <h3>üôè DI√ÅLOGO COM DEUS</h3>
              <div class="main-text">Leia esta ora√ß√£o devagar, como se estivesse conversando pessoalmente com Jesus</div>
            </div>
            
            <h3>üôè Ora√ß√£o Dirigida:</h3>
            
            <div class="prayer-text">
              "Senhor Jesus, Tu disseste que o Reino de Deus est√° dentro de n√≥s. Que verdade maravilhosa! Ajuda-me a descobrir cada dia este tesouro que j√° possuo pela gra√ßa do Batismo.
            </div>
            
            <div class="prayer-text">
              Perdoa-me pelas vezes em que Te ignoro, mesmo sabendo que habitas em minha alma. Perdoa-me por buscar felicidade apenas nas coisas exteriores, esquecendo-me de que a fonte da verdadeira alegria est√° em Ti.
            </div>
            
            <div class="prayer-text">
              Senhor, reconhe√ßo que vivo muitas vezes na superf√≠cie da vida, correndo atr√°s de mil coisas e esquecendo-me do essencial. Ensina-me a cultivar o sil√™ncio, o recolhimento e a ora√ß√£o.
            </div>
            
            <div class="prayer-text">
              D√°-me a gra√ßa de lembrar-me de Ti durante o dia. Que nas pequenas pausas, nos momentos de dificuldade, nas alegrias e tristezas, eu sempre me volte para Ti que vives em mim.
            </div>
            
            <div class="prayer-text">
              Que minha vida seja um reflexo de Tua presen√ßa em mim. Que as pessoas percebam em mim algo de Teu amor, Tua paz e Tua bondade.
            </div>
            
            <div class="prayer-text">
              Virgem Maria, M√£e da vida interior, que soubeste guardar todas as coisas em teu cora√ß√£o, intercede por mim. Ajuda-me a aprender de ti o recolhimento, o sil√™ncio e a contempla√ß√£o.
            </div>
            
            <div class="prayer-text">
              Am√©m."
            </div>
            
            <div class="intentions">
              <h4>üïäÔ∏è Inten√ß√µes Espec√≠ficas:</h4>
              <div class="main-text">Reze pelas seguintes inten√ß√µes, uma por vez, com o cora√ß√£o:</div>
              
              <div class="intention-item">
                <strong>Pelos que perderam a f√©:</strong> Para que redescubram a presen√ßa de Deus em suas vidas
              </div>
              <div class="intention-item">
                <strong>Pelas fam√≠lias em conflito:</strong> Para que encontrem a paz no di√°logo e no perd√£o
              </div>
              <div class="intention-item">
                <strong>Pelos jovens:</strong> Para que encontrem sentido e dire√ß√£o para suas vidas
              </div>
              <div class="intention-item">
                <strong>Pelos sacerdotes e religiosos:</strong> Para que sejam fi√©is √† sua voca√ß√£o
              </div>
              <div class="intention-item">
                <strong>Por sua convers√£o:</strong> Para que cres√ßa sempre mais na vida interior
              </div>
            </div>
            
            <div class="personal-prayer">
              <h4>üí¨ Sua Ora√ß√£o Pessoal:</h4>
              <div class="main-text">Agora fale com Deus com suas pr√≥prias palavras. Conte-lhe suas alegrias, preocupa√ß√µes, pedidos...</div>
              
              <textarea id="personal-prayer-text" placeholder="Escreva aqui sua ora√ß√£o pessoal...&#10;&#10;(Este texto ser√° salvo apenas para voc√™)"></textarea>
              
              <div style="text-align: center; margin-top: 12px;">
                <button class="save-btn" onclick="salvarOracao()">üíæ Salvar Ora√ß√£o</button>
                <button class="clear-btn" onclick="limparOracao()">üîÑ Limpar Texto</button>
              </div>
            </div>
          `
        },
        4: {
          titulo: "CONTEMPLA√á√ÉO",
          icone: "‚ú®",
          conteudo: `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">A Vida Interior</h2>
            
            <div class="contemplation-box">
              <h3>üßò‚Äç‚ôÄÔ∏è SIL√äNCIO INTERIOR</h3>
              <div class="main-text">Agora √© momento de simplesmente ESTAR com Deus</div>
            </div>
            
            <h3>üßò‚Äç‚ôÄÔ∏è Instru√ß√µes para o Sil√™ncio:</h3>
            <div class="main-text">Leia estas instru√ß√µes e depois pratique:</div>
            
            <div class="main-text">
              ‚Ä¢ Encontre uma posi√ß√£o confort√°vel. Sente-se com as costas eretas, mas relaxadas. Coloque as m√£os sobre o colo.<br>
              ‚Ä¢ Feche suavemente os olhos. N√£o force, apenas deixe as p√°lpebras se fecharem naturalmente.<br>
              ‚Ä¢ Respire normalmente. N√£o precisa controlar a respira√ß√£o, apenas observe-a acontecer.<br>
              ‚Ä¢ Se pensamentos surgirem, n√£o se preocupe. √â normal. Simplesmente volte gentilmente √† presen√ßa de Deus.<br>
              ‚Ä¢ Repita mentalmente, se necess√°rio: "Jesus, eu confio em V√≥s" ou "Senhor, Tu est√°s em mim".
            </div>
            
            <div class="instruction">
              üìù <strong>Texto para Contempla√ß√£o:</strong><br>
              "O Reino de Deus est√° dentro de v√≥s"<br>
              Permane√ßa com esta frase. N√£o precisa pensar sobre ela, apenas deixe que ela repouse em seu cora√ß√£o. Deus est√° aqui, agora, dentro de voc√™.
            </div>
            
            <div class="main-text">
              N√£o precisa fazer nada, apenas estar. Como Maria aos p√©s de Jesus, escolha a melhor parte: simplesmente permanecer na presen√ßa do Senhor.
            </div>
            
            <div class="timer-box">
              <h4>‚è∞ Tempo de Sil√™ncio:</h4>
              <div class="main-text">Escolha o tempo de contempla√ß√£o:</div>
              
              <div class="timer-buttons">
                <button class="timer-btn" onclick="iniciarContemplacao(2)">2 minutos</button>
                <button class="timer-btn" onclick="iniciarContemplacao(3)">3 minutos</button>
                <button class="timer-btn" onclick="iniciarContemplacao(5)">5 minutos</button>
                <button class="timer-btn" onclick="iniciarContemplacao(0)">Sem limite</button>
              </div>
              
              <div id="timer-display" style="display: none;">
                <div style="font-size: 2em; margin: 16px 0;" id="timer-text">03:00</div>
                <button class="save-btn" onclick="pararContemplacao()">‚èπÔ∏è Parar</button>
              </div>
            </div>
            
            <div class="commitment-box">
              <h4>üéØ Prop√≥sito para Hoje:</h4>
              <div class="main-text">Hoje eu vou colocar em pr√°tica:</div>
              
              <div class="main-text" style="font-style: italic; color: #7ee787;">
                "Fazer tr√™s pausas durante o dia para lembrar-me de que Deus est√° presente em minha alma"
              </div>
              
              <div class="commitment-checkboxes">
                <div class="commitment-checkbox">
                  <input type="checkbox" id="check1">
                  <label for="check1">‚òê Ao acordar (antes de pegar o celular)</label>
                </div>
                <div class="commitment-checkbox">
                  <input type="checkbox" id="check2">
                  <label for="check2">‚òê No almo√ßo (ora√ß√£o breve de gratid√£o)</label>
                </div>
                <div class="commitment-checkbox">
                  <input type="checkbox" id="check3">
                  <label for="check3">‚òê Antes de dormir (exame de consci√™ncia)</label>
                </div>
              </div>
              
              <div class="main-text">
                ‚≠ê <strong>Palavra-chave para lembrar hoje:</strong> "PRESEN√áA"
              </div>
              
              <div class="main-text">
                ‚úçÔ∏è <strong>Meu compromisso pessoal:</strong>
              </div>
              
              <textarea id="personal-commitment" placeholder="Escreva uma a√ß√£o concreta que vai fazer hoje..." style="width: 100%; min-height: 80px; background: #181a2a; border: 1px solid #3a3b5a; border-radius: 8px; color: #f5f6fa; padding: 12px; font-family: inherit; resize: vertical;"></textarea>
              
              <div style="text-align: center; margin-top: 12px;">
                <button class="save-btn" onclick="salvarCompromisso()">üíæ Salvar Compromisso</button>
                <button class="clear-btn" onclick="limparCompromisso()">üîÑ Limpar</button>
              </div>
              
              <div style="text-align: center; margin-top: 20px; padding: 20px; border-top: 1px solid #3a3b5a;">
                <h4>‚úÖ Concluir Medita√ß√£o</h4>
                <div class="main-text" style="margin-bottom: 16px;">
                  Marque esta medita√ß√£o como conclu√≠da para atualizar suas estat√≠sticas
                </div>
                <button class="completion-btn" onclick="concluirMeditacao()" style="
                  background: linear-gradient(135deg, #7ee787, #56d364);
                  color: #0d1117;
                  border: none;
                  padding: 12px 24px;
                  border-radius: 8px;
                  font-weight: bold;
                  font-size: 16px;
                  cursor: pointer;
                  transition: all 0.3s ease;
                  box-shadow: 0 4px 12px rgba(126, 231, 135, 0.3);
                ">
                  üéâ Marcar como Conclu√≠da
                </button>
              </div>
            </div>
            
            <div class="completion-box">
              <h3>üéâ MEDITA√á√ÉO CONCLU√çDA!</h3>
              <div class="main-text">Parab√©ns! Voc√™ completou "A Vida Interior"</div>
              
              <div style="margin: 16px 0;">
                <div>‚è±Ô∏è Tempo dedicado: 12 minutos</div>
                <div>üî• Streak atual: 12 dias consecutivos</div>
                <div>üìä Progresso: 1/24 (Princ√≠pios da Vida Sobrenatural)</div>
              </div>
              
              <div class="evaluation">
                <h4>Como foi sua experi√™ncia hoje?</h4>
                <div class="evaluation-buttons">
                  <button class="eval-btn" onclick="avaliarMeditacao('muito-boa')">üòä Muito boa</button>
                  <button class="eval-btn" onclick="avaliarMeditacao('boa')">üòê Boa</button>
                  <button class="eval-btn" onclick="avaliarMeditacao('dificil')">üòî Dif√≠cil</button>
                </div>
                
                <div style="margin-top: 12px;">
                  <div class="main-text">üí¨ Coment√°rio (opcional):</div>
                  <textarea id="avaliacao-comentario" placeholder="Compartilhe sua experi√™ncia..." style="width: 100%; min-height: 60px; background: #181a2a; border: 1px solid #3a3b5a; border-radius: 8px; color: #f5f6fa; padding: 12px; font-family: inherit; resize: vertical;"></textarea>
                </div>
              </div>
              
              <div class="navigation-buttons">
                <a href="#" class="nav-btn primary" onclick="proximaMeditacao()">‚ñ∂Ô∏è Pr√≥xima: A Gra√ßa Santificante</a>
                <a href="dashboard.html" class="nav-btn">üè† Dashboard</a>
                <a href="#" class="nav-btn" onclick="agendarProxima()">üìÖ Agendar Pr√≥xima</a>
                <a href="#" class="nav-btn" onclick="compartilharProgresso()">üì§ Compartilhar Progresso</a>
              </div>
            </div>
          `
        }
      }
    };

    // Fun√ß√£o helper para filtrar medita√ß√µes por usu√°rio
    function getPersonalizedMeditationsForCurrentUser() {
        try {
            // Obter usu√°rio atual
            const currentUser = JSON.parse(localStorage.getItem('userData') || '{}');
            const userId = currentUser.id || 'anonymous';
            
            // Carregar todas as medita√ß√µes personalizadas
            const allPersonalizedMeditations = JSON.parse(localStorage.getItem('personalized_meditations') || '[]');
            
            // Filtrar apenas as medita√ß√µes do usu√°rio atual
            const userMeditations = allPersonalizedMeditations.filter(meditation => 
                meditation.userId === userId
            );
            
            console.log('üë§ Usu√°rio atual:', currentUser.name, 'ID:', userId);
            console.log('üìä Medita√ß√µes personalizadas do usu√°rio:', userMeditations.length);
            
            return userMeditations;
        } catch (error) {
            console.error('‚ùå Erro ao filtrar medita√ß√µes por usu√°rio:', error);
            return [];
        }
    }

    let currentStep = 1;
    let contemplationTimer = null;
    let contemplationTime = 0;

    // Inicializar a p√°gina
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ DOMContentLoaded disparado');
      // Adicionar um pequeno delay para garantir que o DOM esteja completamente carregado
      setTimeout(() => {
        console.log('‚è∞ Timeout executado');
        carregarDadosMeditacao();
        setupBackButton();
        loadTheme();
      }, 100);
    });

    // Configurar bot√£o de voltar
    function setupBackButton() {
      const urlParams = new URLSearchParams(window.location.search);
      const fromParam = urlParams.get('from');
      
      const backButton = document.getElementById('back-button');
      
      if (backButton) {
        if (fromParam === 'minhas-meditacoes') {
          // Se veio especificamente de minhas medita√ß√µes, voltar para l√°
          backButton.href = 'minhas-meditacoes.html';
        } else {
          // Padr√£o: voltar para o dashboard
          backButton.href = 'dashboard.html';
        }
      } else {
        console.warn('‚ö†Ô∏è Bot√£o de voltar n√£o encontrado');
      }
    }

    // Carregar dados da medita√ß√£o selecionada
    function carregarDadosMeditacao() {
      console.log('üîÑ Carregando dados da medita√ß√£o...');
      console.log('üîç Fun√ß√£o carregarDadosMeditacao chamada');
      console.log('üîç localStorage dispon√≠vel:', typeof localStorage !== 'undefined');
      
      // PRIMEIRO: Verificar se h√° uma medita√ß√£o espec√≠fica carregada (nova funcionalidade)
      const currentMeditation = localStorage.getItem('current_meditation');
      if (currentMeditation) {
        try {
          const meditation = JSON.parse(currentMeditation);
          console.log('‚úÖ Medita√ß√£o espec√≠fica carregada:', meditation);
          
          meditacaoData.titulo = meditation.title || 'Medita√ß√£o Personalizada';
          meditacaoData.categoria = meditation.topic || 'Personalizada';
          
          // Atualizar o header com os dados corretos
          const titleElement = document.getElementById('meditation-title');
          if (titleElement) {
            titleElement.textContent = meditation.title || 'Medita√ß√£o Personalizada';
          }
          
          // Atualizar o t√≠tulo da p√°gina
          document.title = `Lectio Divina - ${meditation.title || 'Medita√ß√£o Personalizada'}`;
          
          // Processar o conte√∫do da medita√ß√£o
          const processedContent = processMeditationContent(meditation.content);
          
          // Garantir que os passos existam
          if (!meditacaoData.passos) {
            meditacaoData.passos = {};
          }
          
          // Atualizar os passos com os dados da medita√ß√£o personalizada
          // LEITURA
          meditacaoData.passos[1] = meditacaoData.passos[1] || {};
          meditacaoData.passos[1].conteudo = `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || 'Medita√ß√£o Personalizada'}</h2>
            <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedContent}</div>
            <div class="instruction">
              üëÅÔ∏è Leia este texto duas vezes, devagar, deixando as palavras penetrarem em seu cora√ß√£o.
            </div>
          `;
          
          // MEDITA√á√ÉO
          meditacaoData.passos[2] = meditacaoData.passos[2] || {};
          meditacaoData.passos[2].conteudo = `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || 'Medita√ß√£o Personalizada'}</h2>
            <div class="reflection-box">
              <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedContent}</div>
            </div>
          `;
          
          // ORA√á√ÉO
          meditacaoData.passos[3] = meditacaoData.passos[3] || {};
          meditacaoData.passos[3].conteudo = `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || 'Medita√ß√£o Personalizada'}</h2>
            <div class="prayer-box">
              <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedContent}</div>
            </div>
          `;
          
          // CONTEMPLA√á√ÉO
          meditacaoData.passos[4] = meditacaoData.passos[4] || {};
          meditacaoData.passos[4].conteudo = `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || 'Medita√ß√£o Personalizada'}</h2>
            <div class="contemplation-box">
              <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedContent}</div>
            </div>
          `;
          
          // Mostrar o container da medita√ß√£o
          const meditationContainer = document.getElementById('meditation-container');
          const meditationList = document.getElementById('meditation-list');
          
          if (meditationContainer) {
            meditationContainer.style.display = 'block';
            console.log('‚úÖ Container da medita√ß√£o mostrado');
          }
          
          if (meditationList) {
            meditationList.style.display = 'none';
            console.log('‚úÖ Lista de medita√ß√µes ocultada');
          }
          
          // Atualizar a interface
          console.log('üîç Chamando showStep(1) para mostrar o primeiro passo');
          showStep(1);
          
          // Limpar a medita√ß√£o atual ap√≥s carregar
          localStorage.removeItem('current_meditation');
          
          return;
          
        } catch (error) {
          console.error('‚ùå Erro ao carregar medita√ß√£o espec√≠fica:', error);
        }
      }
      
      // SEGUNDO: tentar carregar dados da medita√ß√£o atual (dashboard)
      const meditacaoAtual = localStorage.getItem('meditacao-atual');
      
      console.log('üìä Dados da medita√ß√£o atual:', meditacaoAtual);
      
      if (meditacaoAtual) {
        try {
          const meditationData = JSON.parse(meditacaoAtual);
          console.log('‚úÖ Dados da medita√ß√£o atual carregados:', meditationData);
          console.log('üîç Estrutura dos dados:', {
            id: meditationData.id,
            title: meditationData.title,
            category: meditationData.category,
            lectio: !!meditationData.lectio,
            meditatio: !!meditationData.meditatio,
            oratio: !!meditationData.oratio,
            contemplatio: !!meditationData.contemplatio
          });
          console.log('üîç Conte√∫do real dos campos:', {
            lectio: meditationData.lectio ? meditationData.lectio.substring(0, 50) + '...' : 'null',
            meditatio: meditationData.meditatio ? meditationData.meditatio.substring(0, 50) + '...' : 'null',
            oratio: meditationData.oratio ? meditationData.oratio.substring(0, 50) + '...' : 'null',
            contemplatio: meditationData.contemplatio ? meditationData.contemplatio.substring(0, 50) + '...' : 'null'
          });
          
          // CORRE√á√ÉO CR√çTICA: Se os campos de conte√∫do est√£o vazios, buscar na lista de medita√ß√µes
          if (!meditationData.lectio && !meditationData.meditatio && !meditationData.oratio && !meditationData.contemplatio) {
            console.log('‚ö†Ô∏è Campos de conte√∫do vazios, buscando na lista de medita√ß√µes...');
            
            const meditations = JSON.parse(localStorage.getItem('meditations') || '[]');
            const meditationWithContent = meditations.find(m => m.id === meditationData.id);
            
            if (meditationWithContent && (meditationWithContent.lectio || meditationWithContent.meditatio || meditationWithContent.oratio || meditationWithContent.contemplatio)) {
              console.log('‚úÖ Medita√ß√£o com conte√∫do encontrada na lista:', meditationWithContent.title);
              
              // Criar objeto com conte√∫do completo
              const meditationDataCompleto = {
                ...meditationData,
                lectio: meditationWithContent.lectio || '',
                meditatio: meditationWithContent.meditatio || '',
                oratio: meditationWithContent.oratio || '',
                contemplatio: meditationWithContent.contemplatio || ''
              };
              
              console.log('üîç Conte√∫do real dos campos (CORRIGIDO):', {
                lectio: meditationDataCompleto.lectio ? meditationDataCompleto.lectio.substring(0, 50) + '...' : 'null',
                meditatio: meditationDataCompleto.meditatio ? meditationDataCompleto.meditatio.substring(0, 50) + '...' : 'null',
                oratio: meditationDataCompleto.oratio ? meditationDataCompleto.oratio.substring(0, 50) + '...' : 'null',
                contemplatio: meditationDataCompleto.contemplatio ? meditationDataCompleto.contemplatio.substring(0, 50) + '...' : 'null'
              });
              
              // Carregar medita√ß√£o individual com dados completos
              console.log('üîç Chamando carregarMeditacaoIndividual com dados completos:', meditationDataCompleto);
              carregarMeditacaoIndividual(meditationDataCompleto, meditationDataCompleto.category || 'Medita√ß√£o');
              console.log('üîç carregarMeditacaoIndividual conclu√≠da');
              return;
            } else {
              console.log('‚ùå Medita√ß√£o com conte√∫do n√£o encontrada na lista');
            }
          }
          
          // Carregar medita√ß√£o individual diretamente
          console.log('üîç Chamando carregarMeditacaoIndividual com:', meditationData);
          carregarMeditacaoIndividual(meditationData, meditationData.category || 'Medita√ß√£o');
          console.log('üîç carregarMeditacaoIndividual conclu√≠da');
          return;
        } catch (error) {
          console.error('‚ùå Erro ao carregar dados da medita√ß√£o atual:', error);
        }
      }
      
      // Se n√£o h√° dados da medita√ß√£o atual, tentar dados antigos do localStorage
      const currentMeditations = localStorage.getItem('current_meditations');
      const currentCategory = localStorage.getItem('current_category');
      
      console.log('üìä Dados antigos do localStorage:', { currentMeditations, currentCategory });
      
      if (currentMeditations && currentCategory) {
        try {
          const data = JSON.parse(currentMeditations);
          console.log('‚úÖ Dados carregados do dashboard:', data);
          
          if (data.meditations && data.meditations.length > 0) {
            const meditation = data.meditations[0];
            console.log('üìñ Medita√ß√£o encontrada:', meditation);
            console.log('üîç Campos da medita√ß√£o:', {
              reading: meditation.reading,
              lectio: meditation.lectio,
              meditation: meditation.meditation,
              meditatio: meditation.meditatio,
              prayer: meditation.prayer,
              oratio: meditation.oratio,
              contemplation: meditation.contemplation,
              contemplatio: meditation.contemplatio
            });
            
            // Carregar medita√ß√£o individual diretamente
            carregarMeditacaoIndividual(meditation, data.category);
            return;
          }
        } catch (error) {
          console.error('‚ùå Erro ao carregar dados do dashboard:', error);
        }
      }
      
      // Se n√£o h√° dados do dashboard, tentar URL
      const urlParams = new URLSearchParams(window.location.search);
      const categoryName = urlParams.get('category');
      
      console.log('üìä Categoria da URL:', categoryName);
      
      if (categoryName) {
        // Buscar medita√ß√µes personalizadas no localStorage
        const userMeditations = JSON.parse(localStorage.getItem('userMeditations') || '[]');
        console.log('üìä Medita√ß√µes do usu√°rio:', userMeditations);
        
        // Filtrar medita√ß√µes pela categoria (case-insensitive)
        const categoryMeditations = userMeditations.filter(meditation => 
          meditation.topic && meditation.topic.toLowerCase() === categoryName.toLowerCase()
        );
        
        console.log('üìä Medita√ß√µes encontradas para categoria:', categoryMeditations);
        
        if (categoryMeditations.length > 0) {
          // Atualizar o header com os dados da categoria com verifica√ß√£o de seguran√ßa
          const categoryTitle = document.getElementById('category-title');
          const meditationCount = document.getElementById('meditation-count');
          
          if (categoryTitle) categoryTitle.textContent = categoryName;
          if (meditationCount) meditationCount.textContent = `${categoryMeditations.length} medita√ß√µes`;
          
          // Atualizar o t√≠tulo da p√°gina
          document.title = `Lectio Divina - ${categoryName}`;
          
          // Mostrar lista de medita√ß√µes
          mostrarListaMeditacoes(categoryMeditations, categoryName);
        } else {
          console.error('‚ùå Nenhuma medita√ß√£o encontrada na categoria:', categoryName);
          mostrarErro(`Nenhuma medita√ß√£o encontrada na categoria "${categoryName}".`);
        }
      } else {
        console.error('‚ùå Nenhuma categoria especificada');
        console.log('üîç Tentando carregar dados da medita√ß√£o atual...');
        
        // Tentar carregar dados da medita√ß√£o atual mesmo sem categoria
        const meditacaoAtual = localStorage.getItem('meditacao-atual');
        console.log('üîç meditacao-atual no localStorage:', meditacaoAtual ? 'encontrado' : 'n√£o encontrado');
        if (meditacaoAtual) {
          try {
            const meditationData = JSON.parse(meditacaoAtual);
            console.log('‚úÖ Dados da medita√ß√£o atual encontrados:', meditationData.title);
            console.log('üîç Estrutura dos dados:', meditationData);
            carregarMeditacaoIndividual(meditationData, meditationData.category || 'Medita√ß√£o');
            return;
          } catch (error) {
            console.error('‚ùå Erro ao carregar dados da medita√ß√£o atual:', error);
          }
        } else {
          console.log('‚ùå Nenhum dado de medita√ß√£o atual encontrado no localStorage');
        }
        
        mostrarErro('Nenhuma categoria especificada.');
      }
    }
    
    // Fun√ß√£o para mostrar a lista de medita√ß√µes
    function mostrarListaMeditacoes(meditations, categoryName) {
      const meditationList = document.getElementById('meditation-list');
      const meditationContainer = document.getElementById('meditation-container');
      
      // Verifica√ß√£o de seguran√ßa
      if (!meditationList || !meditationContainer) {
        console.error('‚ùå Elementos necess√°rios n√£o encontrados');
        return;
      }
      
      // Esconder container de medita√ß√£o individual
      meditationContainer.style.display = 'none';
      
      // Limpar lista atual
      meditationList.innerHTML = '';
      
      // Criar itens para cada medita√ß√£o
      meditations.forEach((meditation, index) => {
        const meditationItem = document.createElement('div');
        meditationItem.className = 'meditation-item';
        meditationItem.onclick = () => iniciarMeditacao(meditation, categoryName);
        
        // Determinar status da medita√ß√£o (simulado por enquanto)
        const status = getMeditationStatus(meditation, index);
        const duration = meditation.duration || '15 min';
        
        meditationItem.innerHTML = `
          <div class="meditation-info">
            <div class="meditation-title">${meditation.title || `Medita√ß√£o ${index + 1}`}</div>
            <div class="meditation-status">
              <span class="status-icon ${status.class}">${status.icon}</span>
              <span class="${status.class}">${status.text}</span>
            </div>
          </div>
          <div class="meditation-duration">${duration}</div>
        `;
        
        meditationList.appendChild(meditationItem);
      });
      
      console.log('‚úÖ Lista de medita√ß√µes carregada:', meditations.length, 'medita√ß√µes');
    }
    
    // Fun√ß√£o para determinar o status da medita√ß√£o
    function getMeditationStatus(meditation, index) {
      // Por enquanto, vamos simular status baseado no √≠ndice
      // Na implementa√ß√£o real, isso viria do localStorage ou banco de dados
      if (index === 0) {
        return {
          icon: '‚úÖ',
          text: 'Conclu√≠da',
          class: 'status-completed'
        };
      } else if (index === 1) {
        return {
          icon: '‚è≥',
          text: 'Em progresso',
          class: 'status-in-progress'
        };
      } else {
        return {
          icon: 'üîí',
          text: 'Bloqueada',
          class: 'status-locked'
        };
      }
    }
    
    // Fun√ß√£o para iniciar uma medita√ß√£o espec√≠fica
    function iniciarMeditacao(meditation, categoryName) {
      console.log('üöÄ Iniciando medita√ß√£o:', meditation.title);
      
      // Salvar medita√ß√£o atual no localStorage
      localStorage.setItem('current_meditation', JSON.stringify({
        meditation: meditation,
        type: 'personalized',
        category: categoryName
      }));
      
      // Esconder lista e mostrar medita√ß√£o individual
      document.getElementById('meditation-list').style.display = 'none';
      document.getElementById('meditation-container').style.display = 'block';
      
      // Carregar dados da medita√ß√£o espec√≠fica
      carregarMeditacaoIndividual(meditation, categoryName);
    }
    
    // Fun√ß√£o para mostrar erro
    function mostrarErro(mensagem) {
      const meditationList = document.getElementById('meditation-list');
      meditationList.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #f87171;">
          <div style="font-size: 3em; margin-bottom: 16px;">‚ùå</div>
          <h3>Erro</h3>
          <p>${mensagem}</p>
          <button onclick="window.location.href='minhas-meditacoes.html'" class="action-btn primary">
            Voltar para Minhas Medita√ß√µes
          </button>
        </div>
      `;
    }
    
    // Fun√ß√£o para carregar uma medita√ß√£o individual
    function carregarMeditacaoIndividual(meditation, categoryName) {
      try {
        console.log('üìñ Carregando medita√ß√£o individual:', meditation.title);
        console.log('üîç Todos os campos da medita√ß√£o:', meditation);
        console.log('üîç Chaves dispon√≠veis:', Object.keys(meditation));
        console.log('üîç meditacaoData existe:', !!meditacaoData);
        console.log('üîç Categoria:', categoryName);
        console.log('üîç Tipo de meditation:', typeof meditation);
        console.log('üîç meditation √© objeto:', meditation && typeof meditation === 'object');
        
        // Verificar se meditacaoData existe
        if (!meditacaoData) {
          console.error('‚ùå meditacaoData n√£o est√° definido');
          return;
        }
        
        // Sempre sobrescrever os passos para evitar res√≠duos de execu√ß√µes anteriores
        meditacaoData.passos = {
          1: { conteudo: "" },
          2: { conteudo: "" },
          3: { conteudo: "" },
          4: { conteudo: "" }
        };
        
        console.log('‚úÖ Passos inicializados');
      
      // LEITURA
      console.log('üîç Campos da medita√ß√£o para leitura:', {
        reading: meditation.reading,
        lectio: meditation.lectio,
        hasReading: !!meditation.reading,
        hasLectio: !!meditation.lectio
      });
      const leitura = meditation.reading || meditation.lectio || '';
      console.log('üìñ Leitura encontrada:', !!leitura, leitura ? leitura.substring(0, 100) + '...' : 'Nenhuma');
      if (leitura) {
        const processedReading = processMeditationContent(leitura);
        meditacaoData.passos[1].conteudo = `
          <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || categoryName}</h2>
          <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedReading}</div>
          <div class="instruction">
            üëÅÔ∏è Leia este texto duas vezes, devagar, deixando as palavras penetrarem em seu cora√ß√£o.
          </div>
        `;
        console.log('‚úÖ Passo 1 (Leitura) carregado');
        console.log('üîç Conte√∫do do passo 1:', meditacaoData.passos[1].conteudo.substring(0, 100) + '...');
      } else {
        console.log('‚ùå Nenhuma leitura encontrada');
      }
      // MEDITA√á√ÉO
      console.log('üîç Campos da medita√ß√£o para medita√ß√£o:', {
        meditation: meditation.meditation,
        meditatio: meditation.meditatio,
        hasMeditation: !!meditation.meditation,
        hasMeditatio: !!meditation.meditatio
      });
      const meditacao = meditation.meditation || meditation.meditatio || '';
      console.log('ü§î Medita√ß√£o encontrada:', !!meditacao, meditacao ? meditacao.substring(0, 100) + '...' : 'Nenhuma');
      if (meditacao) {
        const processedMeditation = processMeditationContent(meditacao);
        meditacaoData.passos[2].conteudo = `
          <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || categoryName}</h2>
          <div class="reflection-box">
            <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedMeditation}</div>
          </div>
        `;
        console.log('‚úÖ Passo 2 (Medita√ß√£o) carregado');
      }
      // ORA√á√ÉO
      const oracao = meditation.prayer || meditation.oratio || '';
      console.log('üôè Ora√ß√£o encontrada:', !!oracao, oracao ? oracao.substring(0, 100) + '...' : 'Nenhuma');
      if (oracao) {
        const processedPrayer = processMeditationContent(oracao);
        meditacaoData.passos[3].conteudo = `
          <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || categoryName}</h2>
          <div class="prayer-box">
            <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedPrayer}</div>
            <div class="instruction">
              <strong>Ora√ß√£o Pessoal:</strong> Agora √© sua vez de falar com Deus. Use o espa√ßo abaixo para escrever sua pr√≥pria ora√ß√£o.
            </div>
            <textarea id="personal-prayer-text" placeholder="Escreva sua ora√ß√£o pessoal aqui..." style="width: 100%; min-height: 100px; background: #23243a; border: 1px solid #3a3b5a; border-radius: 8px; color: #f5f6fa; padding: 12px; font-family: inherit; resize: vertical; margin-top: 12px;"></textarea>
            <div style="margin-top: 12px; display: flex; gap: 8px;">
              <button onclick="salvarOracao()" style="background: #7ee787; color: #101223; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üíæ Salvar</button>
              <button onclick="limparOracao()" style="background: #23243a; color: #f5f6fa; border: 1px solid #3a3b5a; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üóëÔ∏è Limpar</button>
            </div>
          </div>
        `;
        console.log('‚úÖ Passo 3 (Ora√ß√£o) carregado');
      }
      // CONTEMPLA√á√ÉO
      const contemplacao = meditation.contemplation || meditation.contemplatio || '';
      console.log('üßò Contempla√ß√£o encontrada:', !!contemplacao, contemplacao ? contemplacao.substring(0, 100) + '...' : 'Nenhuma');
      if (contemplacao) {
        const processedContemplation = processMeditationContent(contemplacao);
        // Verificar se veio de minhas-meditacoes.html
        const urlParams = new URLSearchParams(window.location.search);
        const fromParam = urlParams.get('from');
        const isFromMinhasMeditacoes = fromParam === 'minhas-meditacoes';
        
        let completionButton = '';
        if (isFromMinhasMeditacoes) {
          completionButton = `
            <div style="margin-top: 24px; text-align: center;">
              <button class="completion-btn" onclick="concluirMeditacao()" style="
                background: linear-gradient(135deg, #7ee787 0%, #10b981 100%);
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 16px;
                box-shadow: 0 4px 12px rgba(126, 231, 135, 0.3);
              ">
                ‚úÖ Medita√ß√£o Conclu√≠da
              </button>
            </div>
          `;
        }
        
        meditacaoData.passos[4].conteudo = `
          <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || categoryName}</h2>
          <div class="contemplation-box">
            <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedContemplation}</div>
            <div class="instruction">
              <strong>Momento de Sil√™ncio:</strong> Agora, simplesmente fique em sil√™ncio na presen√ßa de Deus. Voc√™ pode usar um timer ou simplesmente contemplar.
            </div>
            ${completionButton}
          </div>
        `;
        console.log('‚úÖ Passo 4 (Contempla√ß√£o) carregado');
      }
      // Esconder lista e mostrar medita√ß√£o individual com verifica√ß√£o de seguran√ßa
      const meditationList = document.getElementById('meditation-list');
      const meditationContainer = document.getElementById('meditation-container');
      const stepContent = document.getElementById('step-content');
      
      console.log('üîç Elementos encontrados:', {
        meditationList: !!meditationList,
        meditationContainer: !!meditationContainer,
        stepContent: !!stepContent
      });
      
      if (meditationList) meditationList.style.display = 'none';
      if (meditationContainer) meditationContainer.style.display = 'block';
      if (stepContent) stepContent.innerHTML = '';
      
      console.log('‚úÖ Interface atualizada');
      
      // Mostrar o primeiro passo
      console.log('üîç Chamando showStep(1)');
      showStep(1);
      console.log('üîç showStep(1) conclu√≠da');
      console.log('‚úÖ Medita√ß√£o individual carregada com sucesso');
    } catch (error) {
      console.error('‚ùå Erro ao carregar medita√ß√£o individual:', error);
    }
    }
    
    // Fun√ß√£o para processar o conte√∫do da medita√ß√£o
    function processMeditationContent(content) {
      console.log('üîß processMeditationContent chamada com:', content ? 'conte√∫do v√°lido' : 'conte√∫do vazio');
      if (!content) {
        console.log('‚ùå Conte√∫do vazio, retornando string vazia');
        return '';
      }
      
      console.log('üîß Processando conte√∫do:', content.substring(0, 200) + '...');
      
      // Remover refer√™ncias a "primeira parte", "segunda parte", "terceira parte"
      let processedContent = content
        .replace(/\*Primeira parte do texto da leitura/g, '')
        .replace(/\*Segunda parte do texto da leitura/g, '')
        .replace(/\*Terceira parte do texto da leitura/g, '')
        .replace(/Esta parte introduz o tema e estabelece o fundamento espiritual da [^.]*\./g, '')
        .replace(/Esta parte aprofundando o tema da [^.]*\./g, '')
        .replace(/Esta parte concluindo com reflex√µes sobre a [^.]*\./g, '')
        .replace(/e sua manifesta√ß√£o na vida crist√£ atrav√©s da gra√ßa divina e da a√ß√£o do Esp√≠rito Santo\./g, '')
        .replace(/e sua import√¢ncia para a santifica√ß√£o e crescimento espiritual\./g, '')
        .replace(/com cita√ß√µes b√≠blicas e refer√™ncias aos documentos cat√≥licos\./g, '')
        .replace(/na vida crist√£\./g, '')
        .replace(/como fruto do Esp√≠rito Santo/g, '')
        .replace(/\[B√≠blia Sagrada, [^\]]*\]/g, '')
        .replace(/\[Catecismo da Igreja Cat√≥lica, [^\]]*\]/g, '')
        .replace(/\[[^\]]*\]/g, '');
      
      // Limpar espa√ßos extras e quebras de linha
      processedContent = processedContent
        .replace(/\n\s*\n\s*\n/g, '\n\n')
        .replace(/\*\s*\n\s*\*/g, '\n\n*')
        .trim();
      
      console.log('‚úÖ Conte√∫do processado:', processedContent.substring(0, 200) + '...');
      
      return processedContent;
    }

// Mostrar passo espec√≠fico
function showStep(step) {
  try {
    console.log(`üéØ Mostrando passo ${step}...`);
    console.log('üîç currentStep antes:', currentStep);
    currentStep = step;
    console.log('üîç currentStep depois:', currentStep);
    
    // Verificar se meditacaoData existe
    if (!meditacaoData || !meditacaoData.passos) {
      console.warn('‚ö†Ô∏è Dados da medita√ß√£o n√£o est√£o prontos ainda');
      console.log('üîç meditacaoData:', meditacaoData);
      console.log('üîç meditacaoData.passos:', meditacaoData?.passos);
      return;
    }
    
    // Atualizar classes dos passos
    document.querySelectorAll('.step').forEach((el, index) => {
      el.classList.toggle('active', index + 1 === step);
    });
    
    // Manter t√≠tulos originais dos passos com verifica√ß√£o de seguran√ßa
    const step1Title = document.getElementById('step1-title');
    const step2Title = document.getElementById('step2-title');
    const step3Title = document.getElementById('step3-title');
    const step4Title = document.getElementById('step4-title');
    
    if (step1Title) step1Title.textContent = "Leitura";
    if (step2Title) step2Title.textContent = "Medita√ß√£o";
    if (step3Title) step3Title.textContent = "Ora√ß√£o";
    if (step4Title) step4Title.textContent = "Contempla√ß√£o";

    // Atualizar conte√∫do
    const content = document.getElementById('step-content');
    console.log('üîç Elemento content encontrado:', !!content);
    console.log('üîç Passo existe:', !!meditacaoData.passos[step]);
    console.log('üîç Conte√∫do do passo:', meditacaoData.passos[step]?.conteudo ? 'Sim' : 'N√£o');
    
    if (content && meditacaoData.passos[step]) {
      if (meditacaoData.passos[step].conteudo) {
        console.log(`üìÑ Atualizando conte√∫do do passo ${step}:`, meditacaoData.passos[step].conteudo.substring(0, 100) + '...');
        
        // DEBUG: Verificar se o elemento est√° vis√≠vel antes de atualizar
        console.log('üîç Estado do elemento antes da atualiza√ß√£o:', {
          display: content.style.display,
          visibility: content.style.visibility,
          opacity: content.style.opacity,
          height: content.offsetHeight,
          width: content.offsetWidth,
          parentDisplay: content.parentElement?.style.display,
          parentVisibility: content.parentElement?.style.visibility
        });
        
        content.innerHTML = meditacaoData.passos[step].conteudo;
        console.log('‚úÖ Conte√∫do atualizado');
        console.log('üîç Conte√∫do final do elemento:', content.innerHTML.substring(0, 200) + '...');
        console.log('üîç Elemento content vis√≠vel:', content.offsetHeight > 0);
        
        // Garantir que o conte√∫do seja vis√≠vel
        content.style.display = 'block';
        content.style.visibility = 'visible';
        content.style.opacity = '1';
        
        // DEBUG: Verificar se o elemento est√° vis√≠vel depois de atualizar
        console.log('üîç Estado do elemento depois da atualiza√ß√£o:', {
          display: content.style.display,
          visibility: content.style.visibility,
          opacity: content.style.opacity,
          height: content.offsetHeight,
          width: content.offsetWidth,
          parentDisplay: content.parentElement?.style.display,
          parentVisibility: content.parentElement?.style.visibility
        });
        
        // DEBUG: Verificar se o container pai est√° vis√≠vel
        const meditationContainer = document.getElementById('meditation-container');
        if (meditationContainer) {
          console.log('üîç Estado do meditation-container:', {
            display: meditationContainer.style.display,
            visibility: meditationContainer.style.visibility,
            height: meditationContainer.offsetHeight,
            width: meditationContainer.offsetWidth
          });
        }
        
      } else {
        content.innerHTML = "<div style='text-align:center;color:#a3a8c9;padding:2em'>Nenhum conte√∫do dispon√≠vel para esta etapa.</div>";
        console.warn('‚ö†Ô∏è Nenhum conte√∫do dispon√≠vel para esta etapa.');
        console.log('üîç Passos dispon√≠veis:', Object.keys(meditacaoData.passos));
        console.log('üîç Conte√∫do dos passos:', meditacaoData.passos);
      }
    } else {
      console.error('‚ùå Elemento content n√£o encontrado ou passo n√£o existe');
      console.log('üîç Elemento content:', content);
      console.log('üîç Passo:', step);
      console.log('üîç meditacaoData.passos:', meditacaoData.passos);
    }
    
    // Atualizar header
    console.log('üîç updateHeader chamada');
    updateHeader();
    console.log('‚úÖ Header atualizado:', undefined);
    
    // Mostrar bot√£o de conclus√£o se estiver no √∫ltimo passo
    showCompletionButton();
    
  } catch (error) {
    console.error('‚ùå Erro em showStep:', error);
  }
}

// Atualizar header
function updateHeader() {
  try {
    console.log('üîç updateHeader chamada');
    // Verificar se meditacaoData e currentStep existem
    if (!meditacaoData || !meditacaoData.passos || !currentStep) {
      console.warn('‚ö†Ô∏è Dados da medita√ß√£o n√£o est√£o prontos ainda');
      console.log('üîç meditacaoData:', meditacaoData);
      console.log('üîç meditacaoData.passos:', meditacaoData?.passos);
      console.log('üîç currentStep:', currentStep);
      return;
    }
    
    const stepData = meditacaoData.passos[currentStep];
    
    // Atualizar t√≠tulo da medita√ß√£o
    const dadosSalvos = localStorage.getItem('meditacao-atual');
    if (dadosSalvos) {
      const dados = JSON.parse(dadosSalvos);
      const titleElement = document.getElementById('meditation-title');
      if (titleElement) {
        titleElement.textContent = dados.category || 'Medita√ß√£o';
      }
      
      // O elemento meditation-number foi removido, ent√£o n√£o tentamos acess√°-lo
      console.log('‚úÖ Header atualizado:', dados.category);
    }
  } catch (error) {
    console.error('‚ùå Erro ao atualizar header:', error);
  }
}

// Fun√ß√£o para voltar
function goBack() {
  const urlParams = new URLSearchParams(window.location.search);
  const fromParam = urlParams.get('from');
  
  if (fromParam === 'minhas-meditacoes') {
    // Se veio especificamente de minhas medita√ß√µes, voltar para l√°
    window.location.href = 'minhas-meditacoes.html';
  } else {
    // Padr√£o: voltar para o dashboard
    window.location.href = 'dashboard.html';
  }
}

// Event listeners para navega√ß√£o
document.addEventListener('click', function(e) {
  // Verificar se o clique foi no elemento step ou em seus filhos
  const stepElement = e.target.closest('.step');
  if (stepElement) {
    const step = parseInt(stepElement.dataset.step);
    showStep(step);
  }
});

// Fun√ß√µes para salvar dados
function salvarOracao() {
  const oracao = document.getElementById('personal-prayer-text').value;
  localStorage.setItem('oracao-pessoal', oracao);
  alert('Ora√ß√£o salva com sucesso!');
}

function limparOracao() {
  document.getElementById('personal-prayer-text').value = '';
}

function salvarCompromisso() {
  const compromisso = document.getElementById('personal-commitment').value;
  localStorage.setItem('compromisso-pessoal', compromisso);
  alert('Compromisso salvo com sucesso!');
}

function limparCompromisso() {
  document.getElementById('personal-commitment').value = '';
}

// Fun√ß√µes para contempla√ß√£o
function iniciarContemplacao(minutos) {
  contemplationTime = minutos * 60;
  const timerDisplay = document.getElementById('timer-display');
  const timerText = document.getElementById('timer-text');
  
  timerDisplay.style.display = 'block';
  
  if (minutos === 0) {
    timerText.textContent = '‚àû';
    return;
  }
  
  contemplationTimer = setInterval(() => {
    contemplationTime--;
    const mins = Math.floor(contemplationTime / 60);
    const secs = contemplationTime % 60;
    timerText.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    
    if (contemplationTime <= 0) {
      pararContemplacao();
      alert('Tempo de contempla√ß√£o conclu√≠do!');
    }
  }, 1000);
}

function pararContemplacao() {
  if (contemplationTimer) {
    clearInterval(contemplationTimer);
    contemplationTimer = null;
  }
  document.getElementById('timer-display').style.display = 'none';
}

// Fun√ß√µes de avalia√ß√£o e navega√ß√£o
function avaliarMeditacao(tipo) {
  localStorage.setItem('avaliacao-meditacao', tipo);
  const comentario = document.getElementById('avaliacao-comentario').value;
  if (comentario) {
    localStorage.setItem('avaliacao-comentario', comentario);
  }
  alert('Avalia√ß√£o registrada! Obrigado por compartilhar sua experi√™ncia.');
}

function proximaMeditacao() {
  // Marcar medita√ß√£o como conclu√≠da
  const dadosSalvos = localStorage.getItem('meditacao-atual');
  if (dadosSalvos) {
    const dados = JSON.parse(dadosSalvos);
    localStorage.setItem('meditacao-concluida', JSON.stringify({
      ...dados,
      concluidaEm: new Date().toISOString()
    }));
  }
  
  alert('Medita√ß√£o conclu√≠da! Redirecionando para a pr√≥xima...');
  setTimeout(() => {
    window.location.href = 'dashboard.html';
  }, 1500);
}

function agendarProxima() {
  alert('Funcionalidade de agendamento ser√° implementada em breve!');
}

function compartilharProgresso() {
  alert('Funcionalidade de compartilhamento ser√° implementada em breve!');
}

// Fun√ß√£o para alternar entre modo claro e escuro
function toggleTheme() {
  const body = document.body;
  const currentTheme = body.classList.contains('light-mode') ? 'light' : 'dark';
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  
  if (newTheme === 'light') {
    body.classList.add('light-mode');
  } else {
    body.classList.remove('light-mode');
  }
  
  localStorage.setItem('theme', newTheme);
  
  // Mostrar notifica√ß√£o
  const themeName = newTheme === 'light' ? 'claro' : 'escuro';
  showNotification(`Tema alterado para ${themeName}`, 'success');
}

// Carregar tema salvo
function loadTheme() {
  const savedTheme = localStorage.getItem('theme') || 'dark';
  
  if (savedTheme === 'light') {
    document.body.classList.add('light-mode');
  } else {
    document.body.classList.remove('light-mode');
  }
}

// Fun√ß√£o para mostrar notifica√ß√µes
function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification notification-${type}`;
  notification.textContent = message;
  
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 24px;
    background: ${type === 'success' ? '#10B981' : type === 'error' ? '#EF4444' : '#3B82F6'};
    color: white;
    border-radius: 8px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    font-weight: 500;
    animation: slideIn 0.3s ease;
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 300);
  }, 3000);
}

// Fun√ß√£o para debug dos dados
function debugData() {
  console.log('üîç Debug dos dados:');
  console.log('current_meditations:', localStorage.getItem('current_meditations'));
  console.log('current_category:', localStorage.getItem('current_category'));
  console.log('personalized_meditations:', localStorage.getItem('personalized_meditations'));
  console.log('personalized_meditations_history:', localStorage.getItem('personalized_meditations_history'));
  
  try {
    const currentMeditations = localStorage.getItem('current_meditations');
    if (currentMeditations) {
      const data = JSON.parse(currentMeditations);
      console.log('üìä Dados parseados:', data);
      if (data.meditations && data.meditations.length > 0) {
        console.log('üìñ Primeira medita√ß√£o:', data.meditations[0]);
      }
    }
  } catch (error) {
    console.error('‚ùå Erro ao parsear dados:', error);
  }
}

// Carregar dados salvos ao iniciar
window.addEventListener('load', function() {
  console.log('üöÄ P√°gina de medita√ß√£o carregada');
  
  // Debug dos dados
  debugData();
  
  // Carregar tema
  loadTheme();
  
  const oracaoSalva = localStorage.getItem('oracao-pessoal');
  const compromissoSalvo = localStorage.getItem('compromisso-pessoal');
  

  
  // Verificar se h√° dados antigos do localStorage
  const currentMeditations = localStorage.getItem('current_meditations');
  const currentCategory = localStorage.getItem('current_category');
  
  if (currentMeditations && currentCategory) {
    try {
      const data = JSON.parse(currentMeditations);
      console.log('‚úÖ Dados carregados:', data);
      
      // Verificar se h√° medita√ß√µes na categoria
      if (data.meditations && data.meditations.length > 0) {
        const meditation = data.meditations[0];
        console.log('üìñ Medita√ß√£o selecionada:', meditation);
        
        meditacaoData.titulo = meditation.title || data.category;
        meditacaoData.categoria = data.category;
        
        // Atualizar o header com os dados corretos
        const titleElement = document.getElementById('meditation-title');
        if (titleElement) {
          titleElement.textContent = meditation.title || data.category;
        }
        
        // Atualizar o t√≠tulo da p√°gina
        document.title = `Lectio Divina - ${meditation.title || data.category}`;
        
        // Usar a fun√ß√£o processMeditationContent j√° definida acima
        
        // Garantir que os passos existam
        if (!meditacaoData.passos) {
          meditacaoData.passos = {};
        }
        
        // Atualizar os passos com os dados da medita√ß√£o personalizada
        // LEITURA
        const leitura = meditation.reading || meditation.lectio || '';
        if (leitura) {
          const processedReading = processMeditationContent(leitura);
          meditacaoData.passos[1] = meditacaoData.passos[1] || {};
          meditacaoData.passos[1].conteudo = `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || data.category}</h2>
            <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedReading}</div>
            <div class="instruction">
              üëÅÔ∏è Leia este texto duas vezes, devagar, deixando as palavras penetrarem em seu cora√ß√£o.
            </div>
          `;
        }
        // MEDITA√á√ÉO
        const meditacao = meditation.meditation || meditation.meditatio || '';
        if (meditacao) {
          const processedMeditation = processMeditationContent(meditacao);
          meditacaoData.passos[2] = meditacaoData.passos[2] || {};
          meditacaoData.passos[2].conteudo = `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || data.category}</h2>
            <div class="reflection-box">
              <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedMeditation}</div>
            </div>
          `;
        }
        // ORA√á√ÉO
        const oracao = meditation.prayer || meditation.oratio || '';
        if (oracao) {
          const processedPrayer = processMeditationContent(oracao);
          meditacaoData.passos[3] = meditacaoData.passos[3] || {};
          meditacaoData.passos[3].conteudo = `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || data.category}</h2>
            <div class="prayer-box">
              <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedPrayer}</div>
              <div class="instruction">
                <strong>Ora√ß√£o Pessoal:</strong> Agora √© sua vez de falar com Deus. Use o espa√ßo abaixo para escrever sua pr√≥pria ora√ß√£o.
              </div>
              <textarea id="personal-prayer-text" placeholder="Escreva sua ora√ß√£o pessoal aqui..." style="width: 100%; min-height: 100px; background: #23243a; border: 1px solid #3a3b5a; border-radius: 8px; color: #f5f6fa; padding: 12px; font-family: inherit; resize: vertical; margin-top: 12px;"></textarea>
              <div style="margin-top: 12px; display: flex; gap: 8px;">
                <button onclick="salvarOracao()" style="background: #7ee787; color: #101223; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üíæ Salvar</button>
                <button onclick="limparOracao()" style="background: #23243a; color: #f5f6fa; border: 1px solid #3a3b5a; padding: 8px 16px; border-radius: 6px; cursor: pointer;">üóëÔ∏è Limpar</button>
              </div>
            </div>
          `;
        }
        // CONTEMPLA√á√ÉO
        const contemplacao = meditation.contemplation || meditation.contemplatio || '';
        if (contemplacao) {
          const processedContemplation = processMeditationContent(contemplacao);
          
          // Verificar se veio de minhas-meditacoes.html
          const urlParams = new URLSearchParams(window.location.search);
          const fromParam = urlParams.get('from');
          const isFromMinhasMeditacoes = fromParam === 'minhas-meditacoes';
          
          let completionButton = '';
          if (isFromMinhasMeditacoes) {
            completionButton = `
              <div style="margin-top: 24px; text-align: center;">
                <button class="completion-btn" onclick="concluirMeditacao()" style="
                  background: linear-gradient(135deg, #7ee787 0%, #10b981 100%);
                  color: white;
                  border: none;
                  padding: 12px 24px;
                  border-radius: 8px;
                  font-weight: 600;
                  cursor: pointer;
                  transition: all 0.3s ease;
                  font-size: 16px;
                  box-shadow: 0 4px 12px rgba(126, 231, 135, 0.3);
                ">
                  ‚úÖ Medita√ß√£o Conclu√≠da
                </button>
              </div>
            `;
          }
          
          meditacaoData.passos[4] = meditacaoData.passos[4] || {};
          meditacaoData.passos[4].conteudo = `
            <h2 style="text-align: center; color: #7ee787; margin-bottom: 20px; font-size: 1.5em;">${meditation.title || data.category}</h2>
            <div class="contemplation-box">
              <div class="content" style="text-align: justify; line-height: 1.8; font-size: 1.1em;">${processedContemplation}</div>
              <div class="instruction">
                <strong>Momento de Sil√™ncio:</strong> Agora, simplesmente fique em sil√™ncio na presen√ßa de Deus. Voc√™ pode usar um timer ou simplesmente contemplar.
              </div>
              ${completionButton}
            </div>
          `;
        }
        
        // Mostrar o container da medita√ß√£o
        const meditationContainer = document.getElementById('meditation-container');
        const meditationList = document.getElementById('meditation-list');
        
        if (meditationContainer) {
          meditationContainer.style.display = 'block';
          console.log('‚úÖ Container da medita√ß√£o mostrado');
        }
        
        if (meditationList) {
          meditationList.style.display = 'none';
          console.log('‚úÖ Lista de medita√ß√µes ocultada');
        }
        
        // Mostrar o primeiro passo
        console.log('üéØ Mostrando primeiro passo...');
        showStep(1);
        console.log('‚úÖ Medita√ß√£o carregada com sucesso');
        
        // Verificar se o conte√∫do foi exibido
        setTimeout(() => {
          const contentElement = document.getElementById('step-content');
          if (contentElement) {
            console.log('üìÑ Conte√∫do exibido:', contentElement.innerHTML.substring(0, 200) + '...');
          } else {
            console.error('‚ùå Elemento step-content n√£o encontrado');
          }
        }, 100);
      } else {
        console.error('‚ùå Nenhuma medita√ß√£o encontrada na categoria');
        alert('Erro: Nenhuma medita√ß√£o encontrada. Tente gerar novas medita√ß√µes.');
      }
    } catch (error) {
      console.error('‚ùå Erro ao carregar dados:', error);
      alert('Erro ao carregar dados da medita√ß√£o. Tente novamente.');
    }
  } else {
    console.log('üìù Nenhum dado de medita√ß√£o personalizada encontrado, usando dados padr√£o');
    // Usar dados padr√£o se n√£o houver medita√ß√£o personalizada
    showStep(1);
  }
  
  if (oracaoSalva) {
    const textarea = document.getElementById('personal-prayer-text');
    if (textarea) textarea.value = oracaoSalva;
  }
  
  if (compromissoSalvo) {
    const textarea = document.getElementById('personal-commitment');
    if (textarea) textarea.value = compromissoSalvo;
  }
  
  // Mostrar bot√£o de conclus√£o sempre que a p√°gina carrega
  showCompletionButton();
});

// Fun√ß√£o para mostrar o bot√£o de conclus√£o
function showCompletionButton() {
  const currentStep = parseInt(localStorage.getItem('currentStep') || '1');
  const completionBtn = document.getElementById('complete-meditation-btn');
  
  // Verificar se veio de minhas-meditacoes.html
  const urlParams = new URLSearchParams(window.location.search);
  const fromParam = urlParams.get('from');
  const isFromMinhasMeditacoes = fromParam === 'minhas-meditacoes';
  
  // Mostrar bot√£o sempre que a p√°gina carrega
  if (completionBtn) {
    completionBtn.style.display = 'inline-block';
    console.log('‚úÖ Bot√£o de conclus√£o sempre vis√≠vel no passo:', currentStep, 'Origem:', fromParam);
  }
  
  // Atualizar o currentStep no localStorage
  localStorage.setItem('currentStep', currentStep.toString());
}

// Fun√ß√£o para marcar medita√ß√£o como conclu√≠da
async function completeMeditation() {
  try {
    console.log('üéØ Iniciando conclus√£o da medita√ß√£o...');
    
    // Obter dados da medita√ß√£o atual
    const currentMeditation = JSON.parse(localStorage.getItem('meditacao-atual') || '{}');
    const personalizedMeditations = getPersonalizedMeditationsForCurrentUser();
    
    console.log('üìä Medita√ß√£o atual:', currentMeditation);
    console.log('üìä Medita√ß√µes personalizadas encontradas:', personalizedMeditations.length);
    
    // Marcar medita√ß√£o como conclu√≠da
    if (currentMeditation.id) {
      // Para medita√ß√µes personalizadas
      const meditationIndex = personalizedMeditations.findIndex(m => m.id === currentMeditation.id);
      if (meditationIndex !== -1) {
        personalizedMeditations[meditationIndex].status = 'completed';
        personalizedMeditations[meditationIndex].completedAt = new Date().toISOString();
        localStorage.setItem('personalized_meditations', JSON.stringify(personalizedMeditations));
        console.log('‚úÖ Medita√ß√£o personalizada marcada como conclu√≠da:', currentMeditation.title);
        
        // Sincronizar com Supabase se dispon√≠vel
        console.log('üîÑ Verificando Supabase Manager para atualiza√ß√£o...');
        if (window.supabaseManager) {
          try {
            console.log('üì§ Atualizando status da medita√ß√£o personalizada no Supabase...');
            
            // Buscar a medita√ß√£o no Supabase pelo meditation_id
            const supabaseMeditations = await window.supabaseManager.getPersonalizedMeditations();
            const supabaseMeditation = supabaseMeditations.find(med => 
              med.meditation_id === currentMeditation.id
            );
            
            if (supabaseMeditation) {
              const updateData = {
                status: 'completed',
                completed_at: new Date().toISOString(),
                last_updated: new Date().toISOString()
              };
              
              await window.supabaseManager.updatePersonalizedMeditation(supabaseMeditation.id, updateData);
              console.log('‚úÖ Status da medita√ß√£o personalizada atualizado no Supabase');
            } else {
              console.log('‚ö†Ô∏è Medita√ß√£o personalizada n√£o encontrada no Supabase');
            }
            
          } catch (supabaseError) {
            console.error('‚ö†Ô∏è Erro ao atualizar no Supabase:', supabaseError);
            console.log('‚ÑπÔ∏è Status atualizado apenas localmente');
          }
        } else {
          console.log('‚ÑπÔ∏è Supabase Manager n√£o dispon√≠vel - status atualizado apenas localmente');
        }
        
      } else {
        // Para medita√ß√µes admin
        const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
        const adminMeditationIndex = adminMeditations.findIndex(m => m.id === currentMeditation.id);
        if (adminMeditationIndex !== -1) {
          adminMeditations[adminMeditationIndex].status = 'completed';
          adminMeditations[adminMeditationIndex].completedAt = new Date().toISOString();
          localStorage.setItem('meditations', JSON.stringify(adminMeditations));
          console.log('‚úÖ Medita√ß√£o admin marcada como conclu√≠da:', currentMeditation.title);
        }
      }
    }
    
    // Atualizar estat√≠sticas do usu√°rio
    updateUserStats();
    
    // Atualizar estat√≠sticas espec√≠ficas para minhas-meditacoes
    updateMinhasMeditacoesStats();
    
    // Incrementar contador de medita√ß√µes conclu√≠das
    incrementCompletedMeditations();
    
    // Mostrar notifica√ß√£o de sucesso
    showNotification('Medita√ß√£o conclu√≠da com sucesso!', 'success');
    
    // Redirecionar para a p√°gina apropriada
    const urlParams = new URLSearchParams(window.location.search);
    const fromParam = urlParams.get('from');
    
    setTimeout(() => {
      if (fromParam === 'minhas-meditacoes') {
        window.location.href = 'minhas-meditacoes.html';
      } else {
        window.location.href = 'dashboard.html';
      }
    }, 2000);
    
  } catch (error) {
    console.error('‚ùå Erro ao concluir medita√ß√£o:', error);
    showNotification('Erro ao concluir medita√ß√£o', 'error');
  }
}

// Fun√ß√£o para atualizar estat√≠sticas do usu√°rio
function updateUserStats() {
  try {
    // Obter medita√ß√µes personalizadas do usu√°rio atual
    const personalizedMeditations = getPersonalizedMeditationsForCurrentUser();
    const personalizedCompleted = personalizedMeditations.filter(m => m.status === 'completed');
    const personalizedInProgress = personalizedMeditations.filter(m => 
      m.status !== 'completed' && m.lastViewed
    );
    
    // Obter medita√ß√µes admin
    const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
    const adminCompleted = adminMeditations.filter(m => m.status === 'completed');
    const adminInProgress = adminMeditations.filter(m => 
      m.status !== 'completed' && m.lastViewed
    );
    
    // Combinar estat√≠sticas
    const totalCompleted = personalizedCompleted.length + adminCompleted.length;
    const totalInProgress = personalizedInProgress.length + adminInProgress.length;
    
    // Salvar estat√≠sticas
    const stats = {
      totalCompleted: totalCompleted,
      totalInProgress: totalInProgress,
      personalizedCompleted: personalizedCompleted.length,
      adminCompleted: adminCompleted.length,
      lastUpdated: new Date().toISOString()
    };
    
    localStorage.setItem('user_meditation_stats', JSON.stringify(stats));
    
    console.log('‚úÖ Estat√≠sticas atualizadas:', stats);
    
  } catch (error) {
    console.error('Erro ao atualizar estat√≠sticas:', error);
  }
}

// Fun√ß√£o para atualizar estat√≠sticas espec√≠ficas de minhas-meditacoes
function updateMinhasMeditacoesStats() {
  try {
    console.log('üìä Atualizando estat√≠sticas de minhas-meditacoes...');
    
    // Obter medita√ß√µes personalizadas do usu√°rio atual
    const personalizedMeditations = getPersonalizedMeditationsForCurrentUser();
    const totalMeditations = personalizedMeditations.length;
    const completedMeditations = personalizedMeditations.filter(m => m.status === 'completed').length;
    
    // Salvar estat√≠sticas para minhas-meditacoes
    const stats = {
      totalMeditations: totalMeditations,
      completedMeditations: completedMeditations,
      lastUpdated: new Date().toISOString()
    };
    
    localStorage.setItem('minhas_meditacoes_stats', JSON.stringify(stats));
    console.log('‚úÖ Estat√≠sticas de minhas-meditacoes atualizadas:', stats);
    
  } catch (error) {
    console.error('‚ùå Erro ao atualizar estat√≠sticas de minhas-meditacoes:', error);
  }
}

// Fun√ß√£o para marcar medita√ß√£o como visualizada
function markMeditationAsViewed() {
  try {
    const currentMeditation = JSON.parse(localStorage.getItem('meditacao-atual') || '{}');
    
    if (currentMeditation.id) {
      // Verificar se √© uma medita√ß√£o personalizada
      const personalizedMeditations = getPersonalizedMeditationsForCurrentUser();
      const personalizedIndex = personalizedMeditations.findIndex(m => m.id === currentMeditation.id);
      if (personalizedIndex !== -1) {
        personalizedMeditations[personalizedIndex].lastViewed = new Date().toISOString();
        if (!personalizedMeditations[personalizedIndex].status) {
          personalizedMeditations[personalizedIndex].status = 'in_progress';
        }
        localStorage.setItem('personalized_meditations', JSON.stringify(personalizedMeditations));
        console.log('‚úÖ Medita√ß√£o personalizada marcada como visualizada:', currentMeditation.title);
      }
      
      // Verificar se √© uma medita√ß√£o admin
      const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
      const adminIndex = adminMeditations.findIndex(m => m.id === currentMeditation.id);
      if (adminIndex !== -1) {
        adminMeditations[adminIndex].lastViewed = new Date().toISOString();
        if (!adminMeditations[adminIndex].status) {
          adminMeditations[adminIndex].status = 'in_progress';
        }
        localStorage.setItem('meditations', JSON.stringify(adminMeditations));
        console.log('‚úÖ Medita√ß√£o admin marcada como visualizada:', currentMeditation.title);
      }
    }
  } catch (error) {
    console.error('Erro ao marcar medita√ß√£o como visualizada:', error);
  }
}

// Marcar como visualizada quando a p√°gina carrega
document.addEventListener('DOMContentLoaded', function() {
  markMeditationAsViewed();
});

// Adicionar novo script para concluir medita√ß√£o
function concluirMeditacao() {
  try {
    console.log('üéâ Iniciando conclus√£o da medita√ß√£o...');
    
    // Verificar se o usu√°rio est√° logado
    const currentUser = JSON.parse(localStorage.getItem('userData') || '{}');
    console.log('üë§ Usu√°rio atual:', currentUser);
    
    if (!currentUser.id || currentUser.id === 'anonymous') {
      console.warn('‚ö†Ô∏è Usu√°rio n√£o est√° logado. Fazendo login autom√°tico...');
      
      // Tentar fazer login autom√°tico com dados padr√£o
      const defaultUser = {
        id: 'user_' + Date.now(),
        name: 'Usu√°rio',
        email: 'user@example.com',
        userNumber: 1,
        createdAt: new Date().toISOString(),
        stats: {
          consecutiveDays: 0,
          completedMeditations: 0,
          totalTime: '0h 0min',
          totalMeditations: 0,
          inProgressMeditations: 0
        }
      };
      
      // Salvar usu√°rio padr√£o
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      users.push(defaultUser);
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('userData', JSON.stringify(defaultUser));
      
      console.log('‚úÖ Usu√°rio padr√£o criado:', defaultUser.name);
    }
    
    const currentMeditation = JSON.parse(localStorage.getItem('meditacao-atual') || '{}');
    const updatedUser = JSON.parse(localStorage.getItem('userData') || '{}');
    
    console.log('üìù Medita√ß√£o atual:', currentMeditation.title);
    console.log('üë§ Usu√°rio atual:', updatedUser.name);
    
    // Verificar se √© uma medita√ß√£o personalizada
    const personalizedMeditations = getPersonalizedMeditationsForCurrentUser();
    console.log('üìã Medita√ß√µes personalizadas encontradas:', personalizedMeditations.length);
    console.log('üîç ID da medita√ß√£o atual:', currentMeditation.id);
    
    if (currentMeditation.id) {
      const meditationIndex = personalizedMeditations.findIndex(m => m.id === currentMeditation.id);
      console.log('üîç √çndice da medita√ß√£o encontrado:', meditationIndex);
      
      if (meditationIndex !== -1) {
        console.log('üìù Medita√ß√£o antes da atualiza√ß√£o:', personalizedMeditations[meditationIndex]);
        personalizedMeditations[meditationIndex].status = 'completed';
        personalizedMeditations[meditationIndex].completedAt = new Date().toISOString();
        personalizedMeditations[meditationIndex].completionTime = new Date().toISOString();
        localStorage.setItem('personalized_meditations', JSON.stringify(personalizedMeditations));
        console.log('‚úÖ Medita√ß√£o personalizada marcada como conclu√≠da:', currentMeditation.title);
        console.log('üìù Medita√ß√£o ap√≥s atualiza√ß√£o:', personalizedMeditations[meditationIndex]);
      } else {
        console.log('‚ö†Ô∏è Medita√ß√£o n√£o encontrada nas personalizadas');
      }
    }
    
    // Verificar se √© uma medita√ß√£o admin (n√£o personalizada)
    const adminMeditations = JSON.parse(localStorage.getItem('meditations') || '[]');
    console.log('üìã Medita√ß√µes admin encontradas:', adminMeditations.length);
    
    if (currentMeditation.id) {
      const meditationIndex = adminMeditations.findIndex(m => m.id === currentMeditation.id);
      console.log('üîç √çndice da medita√ß√£o admin encontrado:', meditationIndex);
      
      if (meditationIndex !== -1) {
        console.log('üìù Medita√ß√£o admin antes da atualiza√ß√£o:', adminMeditations[meditationIndex]);
        adminMeditations[meditationIndex].status = 'completed';
        adminMeditations[meditationIndex].completedAt = new Date().toISOString();
        adminMeditations[meditationIndex].completionTime = new Date().toISOString();
        localStorage.setItem('meditations', JSON.stringify(adminMeditations));
        console.log('‚úÖ Medita√ß√£o admin marcada como conclu√≠da:', currentMeditation.title);
        console.log('üìù Medita√ß√£o admin ap√≥s atualiza√ß√£o:', adminMeditations[meditationIndex]);
      } else {
        console.log('‚ö†Ô∏è Medita√ß√£o n√£o encontrada nas admin');
      }
    }
    
    // Atualizar estat√≠sticas do usu√°rio
    updateUserStatistics(updatedUser.id, currentMeditation);
    
    // Atualizar estat√≠sticas gerais
    updateUserStats && updateUserStats();
    
    // Atualizar estat√≠sticas espec√≠ficas para minhas-meditacoes
    updateMinhasMeditacoesStats();
    
    // Mostrar feedback visual
    showCompletionFeedback();
    
    // Mostrar notifica√ß√£o
    showNotification && showNotification('üéâ Medita√ß√£o conclu√≠da com sucesso!', 'success');
    
    // Redirecionar ap√≥s 2 segundos
    setTimeout(() => { 
      window.location.href = 'dashboard.html'; 
    }, 2000);
    
  } catch (error) {
    console.error('‚ùå Erro ao concluir medita√ß√£o:', error);
    alert('Erro ao concluir medita√ß√£o. Tente novamente.');
  }
}

// Fun√ß√£o para atualizar estat√≠sticas do usu√°rio
function updateUserStatistics(userId, meditation) {
  try {
    console.log('üìä Atualizando estat√≠sticas do usu√°rio...');
    
    // Carregar dados do usu√°rio
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const userIndex = users.findIndex(u => u.id === userId);
    
    if (userIndex !== -1) {
      const user = users[userIndex];
      
      // Atualizar estat√≠sticas
      user.stats = user.stats || {};
      user.stats.completedMeditations = (user.stats.completedMeditations || 0) + 1;
      user.stats.totalMeditations = (user.stats.totalMeditations || 0) + 1;
      user.stats.lastCompletedAt = new Date().toISOString();
      
      // Calcular streak (dias consecutivos)
      const today = new Date().toDateString();
      const lastCompleted = user.stats.lastCompletedAt ? new Date(user.stats.lastCompletedAt).toDateString() : null;
      
      if (lastCompleted === today || !lastCompleted) {
        user.stats.consecutiveDays = (user.stats.consecutiveDays || 0) + 1;
      } else {
        user.stats.consecutiveDays = 1;
      }
      
      // Salvar dados atualizados
      users[userIndex] = user;
      localStorage.setItem('users', JSON.stringify(users));
      
      console.log('‚úÖ Estat√≠sticas atualizadas:', {
        completedMeditations: user.stats.completedMeditations,
        consecutiveDays: user.stats.consecutiveDays,
        lastCompletedAt: user.stats.lastCompletedAt
      });
    }
    
  } catch (error) {
    console.error('‚ùå Erro ao atualizar estat√≠sticas:', error);
  }
}

// Fun√ß√£o para mostrar feedback visual de conclus√£o
function showCompletionFeedback() {
  try {
    // Criar overlay de sucesso
    const overlay = document.createElement('div');
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(16, 18, 35, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.3s ease;
    `;
    
    const content = document.createElement('div');
    content.style.cssText = `
      text-align: center;
      color: #f5f6fa;
      animation: scaleIn 0.5s ease;
    `;
    
    content.innerHTML = `
      <div style="font-size: 4rem; margin-bottom: 1rem;">üéâ</div>
      <h2 style="color: #7ee787; margin-bottom: 1rem;">Medita√ß√£o Conclu√≠da!</h2>
      <p style="font-size: 1.2rem; margin-bottom: 2rem;">Parab√©ns! Voc√™ completou sua medita√ß√£o com sucesso.</p>
      <div style="background: #23243a; padding: 1rem; border-radius: 8px; margin-bottom: 2rem;">
        <p>üìä Suas estat√≠sticas foram atualizadas</p>
        <p>üî• Streak atual: ${getCurrentStreak()} dias consecutivos</p>
      </div>
      <p style="color: #9ca3af;">Redirecionando para o dashboard...</p>
    `;
    
    overlay.appendChild(content);
    document.body.appendChild(overlay);
    
    // Adicionar CSS para anima√ß√µes
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes scaleIn {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
    
  } catch (error) {
    console.error('‚ùå Erro ao mostrar feedback:', error);
  }
}

// Fun√ß√£o para incrementar contador de medita√ß√µes conclu√≠das
function incrementCompletedMeditations() {
  try {
    console.log('üìà Incrementando contador de medita√ß√µes conclu√≠das...');
    
    // Obter estat√≠sticas atuais
    const currentStats = JSON.parse(localStorage.getItem('minhas_meditacoes_stats') || '{}');
    const currentCompleted = currentStats.completedMeditations || 0;
    const newCompleted = currentCompleted + 1;
    
    console.log('üìä Contador atual de conclu√≠das:', currentCompleted, 'Novo contador:', newCompleted);
    
    // Atualizar estat√≠sticas
    const updatedStats = {
      ...currentStats,
      completedMeditations: newCompleted,
      lastUpdated: new Date().toISOString()
    };
    
    localStorage.setItem('minhas_meditacoes_stats', JSON.stringify(updatedStats));
    
    // Atualizar elemento DOM se estiver na p√°gina minhas-meditacoes
    const completedElement = document.getElementById('completedMeditations');
    if (completedElement) {
      completedElement.textContent = newCompleted;
      console.log('‚úÖ Elemento DOM de conclu√≠das atualizado:', newCompleted);
    }
    
    console.log('‚úÖ Contador de conclu√≠das incrementado com sucesso');
  } catch (error) {
    console.error('‚ùå Erro ao incrementar contador de conclu√≠das:', error);
  }
}

// Fun√ß√£o para obter streak atual
function getCurrentStreak() {
  try {
    const currentUser = JSON.parse(localStorage.getItem('userData') || '{}');
    const users = JSON.parse(localStorage.getItem('users') || '[]');
    const user = users.find(u => u.id === currentUser.id);
    
    return user && user.stats ? user.stats.consecutiveDays || 0 : 0;
  } catch (error) {
    return 0;
  }
}

// Fun√ß√£o para atualizar estat√≠sticas espec√≠ficas de minhas-meditacoes
function updateMinhasMeditacoesStats() {
  try {
    console.log('üìä Atualizando estat√≠sticas de minhas-meditacoes...');
    
    const currentUser = JSON.parse(localStorage.getItem('userData') || '{}');
    const personalizedMeditations = getPersonalizedMeditationsForCurrentUser();
    
    // Calcular estat√≠sticas
    const totalMeditations = personalizedMeditations.length;
    const completedMeditations = personalizedMeditations.filter(m => m.status === 'completed').length;
    const inProgressMeditations = personalizedMeditations.filter(m => m.status === 'in_progress').length;
    const pendingMeditations = personalizedMeditations.filter(m => !m.status || m.status === 'pending').length;
    
    console.log('üìä Estat√≠sticas calculadas:', {
      total: totalMeditations,
      completed: completedMeditations,
      inProgress: inProgressMeditations,
      pending: pendingMeditations
    });
    
    // Salvar estat√≠sticas no localStorage para uso na p√°gina minhas-meditacoes
    const stats = {
      totalMeditations,
      completedMeditations,
      inProgressMeditations,
      pendingMeditations,
      lastUpdated: new Date().toISOString()
    };
    
    localStorage.setItem('minhas_meditacoes_stats', JSON.stringify(stats));
    console.log('‚úÖ Estat√≠sticas de minhas-meditacoes salvas:', stats);
    
  } catch (error) {
    console.error('‚ùå Erro ao atualizar estat√≠sticas de minhas-meditacoes:', error);
  }
}

// Marcar como 'em andamento' ao entrar na contempla√ß√£o
// (adicione no showStep ou ao renderizar o passo 4)
if (currentStep === 4) {
  try {
    const currentMeditation = JSON.parse(localStorage.getItem('meditacao-atual') || '{}');
    const personalizedMeditations = getPersonalizedMeditationsForCurrentUser();
    if (currentMeditation.id) {
      const meditationIndex = personalizedMeditations.findIndex(m => m.id === currentMeditation.id);
      if (meditationIndex !== -1 && personalizedMeditations[meditationIndex].status !== 'completed') {
        personalizedMeditations[meditationIndex].status = 'in_progress';
        personalizedMeditations[meditationIndex].lastViewed = new Date().toISOString();
        localStorage.setItem('personalized_meditations', JSON.stringify(personalizedMeditations));
      }
    }
  } catch (error) { /* ignorar */ }
}

// Incluir Supabase Manager
</script>
        <script src="supabase-config.js"></script>
        <script src="sync-categories-supabase.js"></script>
</body>
</html> 