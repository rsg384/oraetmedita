<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Cria√ß√£o de Medita√ß√µes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        .btn-danger {
            background: #dc3545;
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
        }
        .form-group {
            margin: 10px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste - Cria√ß√£o de Medita√ß√µes</h1>
    
    <div class="test-section">
        <h2>üìã Status do Sistema</h2>
        <button class="btn" onclick="checkSystemStatus()">Verificar Status</button>
        <div id="systemStatus"></div>
    </div>

    <div class="test-section">
        <h2>üß™ Teste de Cria√ß√£o</h2>
        <form id="testForm">
            <div class="form-group">
                <label for="title">T√≠tulo:</label>
                <input type="text" id="title" value="Medita√ß√£o Teste" required>
            </div>
            <div class="form-group">
                <label for="categoryId">Categoria:</label>
                <select id="categoryId" required>
                    <option value="">Selecione uma categoria</option>
                </select>
            </div>
            <div class="form-group">
                <label for="duration">Dura√ß√£o (min):</label>
                <input type="number" id="duration" value="15" required>
            </div>
            <div class="form-group">
                <label for="status">Status:</label>
                <select id="status">
                    <option value="available">Dispon√≠vel</option>
                    <option value="draft">Rascunho</option>
                </select>
            </div>
            <div class="form-group">
                <label for="type">Tipo:</label>
                <select id="type">
                    <option value="free">Gratuito</option>
                    <option value="premium">Premium</option>
                </select>
            </div>
            <div class="form-group">
                <label for="icon">√çcone:</label>
                <input type="text" id="icon" value="üìñ">
            </div>
            <div class="form-group">
                <label for="lectio">Lectio:</label>
                <textarea id="lectio" rows="3">Conte√∫do da lectio de teste</textarea>
            </div>
            <div class="form-group">
                <label for="meditatio">Meditatio:</label>
                <textarea id="meditatio" rows="3">Conte√∫do da meditatio de teste</textarea>
            </div>
            <div class="form-group">
                <label for="oratio">Oratio:</label>
                <textarea id="oratio" rows="3">Conte√∫do da oratio de teste</textarea>
            </div>
            <div class="form-group">
                <label for="contemplatio">Contemplatio:</label>
                <textarea id="contemplatio" rows="3">Conte√∫do da contemplatio de teste</textarea>
            </div>
            <button type="button" class="btn btn-success" onclick="testCreateMeditation()">Criar Medita√ß√£o</button>
            <button type="button" class="btn btn-warning" onclick="testCreateMeditationDirect()">Criar Direto (Sem Sync)</button>
            <button type="button" class="btn btn-danger" onclick="clearTestData()">Limpar Dados de Teste</button>
        </form>
    </div>

    <div class="test-section">
        <h2>üìä Verifica√ß√£o de Dados</h2>
        <button class="btn" onclick="checkLocalMeditations()">Verificar Medita√ß√µes Locais</button>
        <button class="btn" onclick="checkSupabaseMeditations()">Verificar Medita√ß√µes Supabase</button>
        <button class="btn" onclick="checkCategories()">Verificar Categorias</button>
        <div id="dataStatus"></div>
    </div>

    <div class="test-section">
        <h2>üîÑ Teste de Sincroniza√ß√£o</h2>
        <button class="btn" onclick="testSyncToSupabase()">Sincronizar para Supabase</button>
        <button class="btn" onclick="testSyncFromSupabase()">Sincronizar do Supabase</button>
        <button class="btn" onclick="forceSync()">For√ßar Sincroniza√ß√£o</button>
        <div id="syncStatus"></div>
    </div>

    <div class="test-section">
        <h2>üìù Logs</h2>
        <button class="btn" onclick="clearLogs()">Limpar Logs</button>
        <div id="logs"></div>
    </div>

    <!-- Scripts necess√°rios -->
    <script src="session-manager.js"></script>
    <script src="api-config.js"></script>
    <script src="chatgpt-api.js"></script>
    <script src="supabase-config.js"></script>
    <script src="sync-categories-supabase.js"></script>
    <script src="admin-supabase-sync.js"></script>

    <script>
        function addLog(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(logDiv);
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '';
            
            const systems = [
                { name: 'sessionManager', obj: window.sessionManager },
                { name: 'supabaseManager', obj: window.supabaseManager },
                { name: 'adminSupabaseSync', obj: window.adminSupabaseSync }
            ];

            systems.forEach(({ name, obj }) => {
                const div = document.createElement('div');
                div.className = obj ? 'log success' : 'log error';
                div.textContent = `${obj ? '‚úÖ' : '‚ùå'} ${name}: ${obj ? 'dispon√≠vel' : 'n√£o encontrado'}`;
                statusDiv.appendChild(div);
            });

            // Carregar categorias no select
            loadCategories();
            
            addLog('üîç Status do sistema verificado');
        }

        function loadCategories() {
            const categories = JSON.parse(localStorage.getItem('categories') || '[]');
            const select = document.getElementById('categoryId');
            
            select.innerHTML = '<option value="">Selecione uma categoria</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = `${category.icon} ${category.name}`;
                select.appendChild(option);
            });
            
            addLog(`üìã ${categories.length} categorias carregadas no select`);
        }

        async function testCreateMeditation() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '';
            
            addLog('üß™ Testando cria√ß√£o de medita√ß√£o com sincroniza√ß√£o...');
            
            const formData = {
                title: document.getElementById('title').value,
                categoryId: document.getElementById('categoryId').value,
                duration: document.getElementById('duration').value,
                status: document.getElementById('status').value,
                type: document.getElementById('type').value,
                icon: document.getElementById('icon').value,
                lectio: document.getElementById('lectio').value,
                meditatio: document.getElementById('meditatio').value,
                oratio: document.getElementById('oratio').value,
                contemplatio: document.getElementById('contemplatio').value
            };
            
            if (!formData.title || !formData.categoryId) {
                statusDiv.innerHTML = '<div class="log error">‚ùå T√≠tulo e categoria s√£o obrigat√≥rios</div>';
                addLog('‚ùå T√≠tulo e categoria s√£o obrigat√≥rios', 'error');
                return;
            }
            
            try {
                // Criar medita√ß√£o local
                const meditations = JSON.parse(localStorage.getItem('meditations') || '[]');
                const newMeditation = {
                    id: 'med_' + Date.now(),
                    ...formData,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    total: 0,
                    completed: 0,
                    inProgress: 0,
                    locked: 0
                };
                
                meditations.push(newMeditation);
                localStorage.setItem('meditations', JSON.stringify(meditations));
                
                addLog('‚úÖ Medita√ß√£o criada localmente', 'success');
                
                // Sincronizar com Supabase
                if (window.adminSupabaseSync) {
                    try {
                        await window.adminSupabaseSync.syncMeditation(newMeditation, 'create');
                        statusDiv.innerHTML = '<div class="log success">‚úÖ Medita√ß√£o criada e sincronizada com Supabase</div>';
                        addLog('‚úÖ Medita√ß√£o sincronizada com Supabase', 'success');
                    } catch (syncError) {
                        statusDiv.innerHTML = `<div class="log warning">‚ö†Ô∏è Medita√ß√£o criada localmente, mas erro na sincroniza√ß√£o: ${syncError.message}</div>`;
                        addLog(`‚ö†Ô∏è Erro na sincroniza√ß√£o: ${syncError.message}`, 'warning');
                    }
                } else {
                    statusDiv.innerHTML = '<div class="log warning">‚ö†Ô∏è Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                    addLog('‚ö†Ô∏è Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'warning');
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="log error">‚ùå Erro ao criar medita√ß√£o: ${error.message}</div>`;
                addLog(`‚ùå Erro ao criar medita√ß√£o: ${error.message}`, 'error');
            }
        }

        async function testCreateMeditationDirect() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '';
            
            addLog('üß™ Testando cria√ß√£o de medita√ß√£o direta (sem sync)...');
            
            const formData = {
                title: document.getElementById('title').value + ' (Direto)',
                categoryId: document.getElementById('categoryId').value,
                duration: document.getElementById('duration').value,
                status: document.getElementById('status').value,
                type: document.getElementById('type').value,
                icon: document.getElementById('icon').value,
                lectio: document.getElementById('lectio').value,
                meditatio: document.getElementById('meditatio').value,
                oratio: document.getElementById('oratio').value,
                contemplatio: document.getElementById('contemplatio').value
            };
            
            if (!formData.title || !formData.categoryId) {
                statusDiv.innerHTML = '<div class="log error">‚ùå T√≠tulo e categoria s√£o obrigat√≥rios</div>';
                addLog('‚ùå T√≠tulo e categoria s√£o obrigat√≥rios', 'error');
                return;
            }
            
            try {
                // Criar medita√ß√£o local apenas
                const meditations = JSON.parse(localStorage.getItem('meditations') || '[]');
                const newMeditation = {
                    id: 'med_direct_' + Date.now(),
                    ...formData,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    total: 0,
                    completed: 0,
                    inProgress: 0,
                    locked: 0
                };
                
                meditations.push(newMeditation);
                localStorage.setItem('meditations', JSON.stringify(meditations));
                
                statusDiv.innerHTML = '<div class="log success">‚úÖ Medita√ß√£o criada localmente (sem sincroniza√ß√£o)</div>';
                addLog('‚úÖ Medita√ß√£o criada localmente', 'success');
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="log error">‚ùå Erro ao criar medita√ß√£o: ${error.message}</div>`;
                addLog(`‚ùå Erro ao criar medita√ß√£o: ${error.message}`, 'error');
            }
        }

        function clearTestData() {
            const meditations = JSON.parse(localStorage.getItem('meditations') || '[]');
            const filteredMeditations = meditations.filter(m => 
                !m.title.includes('Teste') && !m.title.includes('Direto')
            );
            
            localStorage.setItem('meditations', JSON.stringify(filteredMeditations));
            
            addLog('üßπ Dados de teste removidos', 'success');
            document.getElementById('syncStatus').innerHTML = '<div class="log success">‚úÖ Dados de teste removidos</div>';
        }

        function checkLocalMeditations() {
            const dataDiv = document.getElementById('dataStatus');
            dataDiv.innerHTML = '';
            
            const meditations = JSON.parse(localStorage.getItem('meditations') || '[]');
            
            const div = document.createElement('div');
            div.className = 'log success';
            div.textContent = `‚úÖ Medita√ß√µes locais: ${meditations.length} itens`;
            dataDiv.appendChild(div);
            
            if (meditations.length > 0) {
                meditations.slice(-5).forEach(med => {
                    const medDiv = document.createElement('div');
                    medDiv.className = 'log';
                    medDiv.textContent = `  - ${med.title} (ID: ${med.id})`;
                    dataDiv.appendChild(medDiv);
                });
            }
            
            addLog(`üìä Verificadas ${meditations.length} medita√ß√µes locais`);
        }

        async function checkSupabaseMeditations() {
            const dataDiv = document.getElementById('dataStatus');
            dataDiv.innerHTML = '';
            
            if (window.supabaseManager) {
                try {
                    const meditations = await window.supabaseManager.getMeditations();
                    
                    const div = document.createElement('div');
                    div.className = 'log success';
                    div.textContent = `‚úÖ Medita√ß√µes no Supabase: ${meditations.length} itens`;
                    dataDiv.appendChild(div);
                    
                    if (meditations.length > 0) {
                        meditations.slice(-5).forEach(med => {
                            const medDiv = document.createElement('div');
                            medDiv.className = 'log';
                            medDiv.textContent = `  - ${med.title} (ID: ${med.id})`;
                            dataDiv.appendChild(medDiv);
                        });
                    }
                    
                    addLog(`üåê Verificadas ${meditations.length} medita√ß√µes no Supabase`, 'success');
                } catch (error) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'log error';
                    errorDiv.textContent = `‚ùå Erro ao verificar Supabase: ${error.message}`;
                    dataDiv.appendChild(errorDiv);
                    
                    addLog(`‚ùå Erro ao verificar Supabase: ${error.message}`, 'error');
                }
            } else {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'log error';
                errorDiv.textContent = '‚ùå Supabase Manager n√£o dispon√≠vel';
                dataDiv.appendChild(errorDiv);
                
                addLog('‚ùå Supabase Manager n√£o dispon√≠vel', 'error');
            }
        }

        function checkCategories() {
            const dataDiv = document.getElementById('dataStatus');
            dataDiv.innerHTML = '';
            
            const categories = JSON.parse(localStorage.getItem('categories') || '[]');
            
            const div = document.createElement('div');
            div.className = 'log success';
            div.textContent = `‚úÖ Categorias locais: ${categories.length} itens`;
            dataDiv.appendChild(div);
            
            if (categories.length > 0) {
                categories.forEach(cat => {
                    const catDiv = document.createElement('div');
                    catDiv.className = 'log';
                    catDiv.textContent = `  - ${cat.icon} ${cat.name} (ID: ${cat.id})`;
                    dataDiv.appendChild(catDiv);
                });
            }
            
            addLog(`üìã Verificadas ${categories.length} categorias locais`);
        }

        async function testSyncToSupabase() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '';
            
            addLog('üîÑ Testando sincroniza√ß√£o para Supabase...');
            
            if (window.adminSupabaseSync) {
                try {
                    await window.adminSupabaseSync.checkAndSyncLocalChanges();
                    statusDiv.innerHTML = '<div class="log success">‚úÖ Sincroniza√ß√£o para Supabase conclu√≠da</div>';
                    addLog('‚úÖ Sincroniza√ß√£o para Supabase conclu√≠da', 'success');
                } catch (error) {
                    statusDiv.innerHTML = `<div class="log error">‚ùå Erro na sincroniza√ß√£o: ${error.message}</div>`;
                    addLog(`‚ùå Erro na sincroniza√ß√£o: ${error.message}`, 'error');
                }
            } else {
                statusDiv.innerHTML = '<div class="log error">‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                addLog('‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'error');
            }
        }

        async function testSyncFromSupabase() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '';
            
            addLog('üîÑ Testando sincroniza√ß√£o do Supabase...');
            
            if (window.adminSupabaseSync) {
                try {
                    await window.adminSupabaseSync.syncMeditationsFromSupabase();
                    statusDiv.innerHTML = '<div class="log success">‚úÖ Sincroniza√ß√£o do Supabase conclu√≠da</div>';
                    addLog('‚úÖ Sincroniza√ß√£o do Supabase conclu√≠da', 'success');
                } catch (error) {
                    statusDiv.innerHTML = `<div class="log error">‚ùå Erro na sincroniza√ß√£o: ${error.message}</div>`;
                    addLog(`‚ùå Erro na sincroniza√ß√£o: ${error.message}`, 'error');
                }
            } else {
                statusDiv.innerHTML = '<div class="log error">‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                addLog('‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'error');
            }
        }

        async function forceSync() {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.innerHTML = '';
            
            addLog('üîß For√ßando sincroniza√ß√£o manual...');
            
            if (window.adminSupabaseSync) {
                try {
                    await window.adminSupabaseSync.forceSync();
                    statusDiv.innerHTML = '<div class="log success">‚úÖ Sincroniza√ß√£o for√ßada conclu√≠da</div>';
                    addLog('‚úÖ Sincroniza√ß√£o for√ßada conclu√≠da', 'success');
                } catch (error) {
                    statusDiv.innerHTML = `<div class="log error">‚ùå Erro na sincroniza√ß√£o: ${error.message}</div>`;
                    addLog(`‚ùå Erro na sincroniza√ß√£o: ${error.message}`, 'error');
                }
            } else {
                statusDiv.innerHTML = '<div class="log error">‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel</div>';
                addLog('‚ùå Sistema de sincroniza√ß√£o n√£o dispon√≠vel', 'error');
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ P√°gina de teste carregada');
            checkSystemStatus();
        });
    </script>
</body>
</html> 